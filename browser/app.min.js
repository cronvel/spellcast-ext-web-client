(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var B,e,t;return function(){function u(s,o,a){function l(i,e){if(!o[i]){if(!s[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(c)return c(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var r=o[i]={exports:{}};s[i][0].call(r.exports,function(e){var t=s[i][1][e];return l(t||e)},r,r.exports,u,s,o,a)}return o[i].exports}for(var c="function"==typeof require&&require,e=0;e<a.length;e++)l(a[e]);return l}return u}()({1:[function(e,t,i){"use strict";const s=e("./GTransition.js");const o=e("seventh");function n(e){this.gScene=e;this.mode="firstPerson";this.position={x:0,y:0,z:10};this.target={x:0,y:0,z:0};this.rotation={x:0,y:0,z:0,w:1};this.yaw=0;this.pitch=0;this.roll=0;this.distance=10;this.fov=90;this.perspective=1;this.free=false;this.trackingMode=null}t.exports=n;n.prototype.update=function(t,e=false){var i=this.updateTransition(t,e);if(t.mode){this.mode=t.mode}if(t.position){this.position=t.position}if(t.target){this.target=t.target}if(t.rotation){this.rotation=t.rotation}if(t.yaw!==undefined){this.yaw=t.yaw||0}if(t.pitch!==undefined){this.pitch=t.pitch||0}if(t.roll!==undefined){this.roll=t.roll||0}if(t.distance!==undefined){this.distance=t.distance||0}if(t.fov!==undefined){this.fov=t.fov||90}if(t.perspective!==undefined){this.perspective=t.perspective||null;let e=Math.max(this.gScene.$gscene.offsetWidth,this.gScene.$gscene.offsetHeight);this.gScene.$gscene.style.perspective=this.perspective?Math.round(e*this.perspective)+"px":null}if(t.free!==undefined){this.free=!!t.free}if(t.trackingMode!==undefined){this.trackingMode=t.trackingMode||null}return e?i:o.resolved};n.prototype.updateTransition=function(e,t=false){console.warn("Camera.updateTransition()",e.transition,e);var i=o.resolved;if(!e.transition){this.gScene.$gscene.style.transition="none";return i}var n=new s(e.transition),r=[];if(e.perspective!==undefined){r.push(n.toString("transform"))}if(!r.length){this.gScene.$gscene.style.transition="none"}else{this.gScene.$gscene.style.transition=r.join(", ");if(t){i=new o;i.resolveTimeout(1e3*n.duration+20);this.gScene.$gscene.ontransitionend=()=>{this.gScene.$gscene.ontransitionend=null;i.resolve()}}}return i}},{"./GTransition.js":6,seventh:50}],2:[function(e,t,i){"use strict";const r=e("./GScene.js");const n=e("./Camera.js");const s=e("./TexturePack.js");const l=e("./GEntity.js");const o=e("./controller/gamepad/BrowserGamepadHub.js");const a=e("./controller/keyboard/BrowserKeyboard.js");const c=e("./controller/Controller.js");const u=e("./commonUtils.js");const h=e("./toolkit.js");const f=e("nextgen-events/lib/browser.js");const d=e("nextgen-events/lib/LeanEvents.js");const p=e("seventh");const m=e("dom-kit");const g=e("svg-kit");function y(){}function v(){this.$body=document.querySelector("body");this.$spellcast=document.querySelector("spellcast");this.$theme=document.querySelector("#theme");this.$gfx=document.querySelector("#gfx");this.$sceneImage=document.querySelector(".scene-image");this.$main=document.querySelector("main");this.$mainBuffer=document.querySelector("#main-buffer");this.$altBuffer=document.querySelector("#alt-buffer");this.$closeAltButton=document.querySelector("#button-close-alt");this.$dialogWrapper=document.querySelector("#dialog-wrapper");this.$hint=document.querySelector("#hint");this.$lobby=document.querySelector("#lobby");this.$clientStatus=this.$lobby.querySelector(".client-status");this.$status=document.querySelector("#status");this.$panel=document.querySelector("#panel");this.$music=document.querySelector("#music");this.$sound0=document.querySelector("#sound0");this.$sound1=document.querySelector("#sound1");this.$sound2=document.querySelector("#sound2");this.$sound3=document.querySelector("#sound3");this.controller=new c;this.gamepadHub=new o(this.controller);this.keyboard=new a(this.controller);this.choices=[];this.newSegmentNeeded=null;this.onSelect=null;this.onLeave=null;this.onEnter=null;this.toMainBuffer();this.nextSoundChannel=0;this.gScenes={};this.gSceneDispatch={message:null,choices:null,textInput:null};this.animations={};this.themeData=null;this.hintTimer=null;this.sceneImageOnTimer=null;this.onCommandSubmit=null;this.uiLoadingCount=0;this.initEvents()}t.exports=v;v.prototype=Object.create(f.prototype);v.prototype.constructor=v;const b=e("./engineLib.js");const x=e("./exm.js");v.cleanUrl=v.prototype.cleanUrl=function(e){if(e[0]==="/"){return window.location.pathname+e.slice(1)}return window.location.pathname+"script/"+e};v.prototype.addScript=function(e){console.log("Adding script: ",e);return m.addJsScript(e,this.$spellcast)};v.prototype.setTheme=function(e){this.$theme.setAttribute("href",this.cleanUrl(e.url));this.themeConfig=e};v.prototype.preload=function(){m.preload(["icons/plugged.svg","icons/plugging.svg","icons/unplugged.svg","icons/unreachable-plug.svg"])};v.prototype.initEvents=function(){this.$main.addEventListener("click",()=>this.emit("continue"),false);this.$gfx.addEventListener("click",e=>{if(e.target.classList.contains("scene-image")){this.toggleSceneImage()}},false);this.$dialogWrapper.addEventListener("click",()=>this.clearDialog(),false);this.$lobby.addEventListener("click",()=>{this.$lobby.classList.toggle("toggled")});this.$status.addEventListener("click",()=>{this.$status.classList.toggle("toggled")});this.$panel.addEventListener("click",()=>{this.$panel.classList.toggle("toggled")});this.gamepadHub.on("newGamepad",e=>e.poll())};v.prototype.toggleSceneImage=function(){if(this.$gfx.classList.contains("toggled")){this.sceneImageOff()}else{this.sceneImageOn()}};v.prototype.sceneImageOn=function(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.add("toggled");this.$spellcast.classList.add("gfx-toggled");this.sceneImageOnTimer=setTimeout(this.sceneImageOff.bind(this),8e3)};v.prototype.sceneImageOff=function(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.remove("toggled");this.$spellcast.classList.remove("gfx-toggled")};v.prototype.toMainBuffer=function(){if(this.$activeBuffer===this.$mainBuffer){return}if(this.$activeBuffer){this.clearChoices();this.clearMessages();this.clearHint();this.clearHistory()}this.$activeBuffer=this.$mainBuffer;this.$importantMessages=null;this.$mainBuffer.classList.remove("inactive");this.$altBuffer.classList.add("inactive");this.$closeAltButton.classList.add("inactive");this.getSwitchedElements();return true};v.prototype.toAltBuffer=function(){if(this.$activeBuffer===this.$altBuffer){return}this.$activeBuffer=this.$altBuffer;this.$importantMessages=this.$activeSegment;this.$mainBuffer.classList.add("inactive");this.$altBuffer.classList.remove("inactive");this.$closeAltButton.classList.remove("inactive");this.getSwitchedElements();return true};v.prototype.getSwitchedElements=function(){this.$history=this.$activeBuffer.querySelector(".messages.history");this.$activeMessages=this.$activeBuffer.querySelector(".messages.active");this.$choices=this.$activeBuffer.querySelector(".choices");this.$chat=this.$activeBuffer.querySelector(".chat");this.$chatForm=this.$chat.querySelector(".chat-form");this.$chatInput=this.$chatForm.querySelector(".chat-input");this.$activeSegment=this.$activeMessages.querySelector("segment:last-child");if(!this.$activeSegment){this.newSegment()}else{this.newSegmentOnContent()}};v.prototype.clientStatus=function(e){this.$clientStatus.setAttribute("data-status",e);this.$clientStatus.setAttribute("title",e)};v.prototype.setMultiplayer=function(e,t){t=t||y;if(e||e===undefined){this.$spellcast.classList.add("multiplayer")}else{this.$spellcast.classList.remove("multiplayer")}t()};v.prototype.clear=function(e){e=e||y;m.empty(this.$hint);m.empty(this.$dialogWrapper);m.empty(this.$activeMessages);m.empty(this.$choices);e()};v.prototype.clearMessages=function(e){e=e||y;m.empty(this.$activeMessages);e()};v.prototype.clearHistory=function(e){e=e||y;m.empty(this.$history);e()};v.prototype.newSegment=function(e){var t,i=e==="inter-segment";this.newSegmentNeeded=null;if(i){if(this.$activeSegment&&this.$activeSegment.tagName.toLowerCase()==="inter-segment"){return}t=document.createElement("inter-segment")}else{t=document.createElement("segment")}if(this.$activeSegment&&!this.$activeSegment.children.length){this.$activeSegment.remove()}this.$activeSegment=t;this.$activeMessages.appendChild(t);if(!i){this.moveToHistory()}};v.prototype.moveToHistory=function(){var e,t,i,n;i=Array.from(this.$activeMessages.children);t=i.length-2;while(t>=0&&i[t].tagName.toLowerCase()==="inter-segment"){t--}if(t<0){return}for(e=0;e<=t;e++){n=i[e].querySelector(".replay-button");if(n){m.remove(n)}this.$history.appendChild(i[e])}i[t].scrollIntoView(false)};v.prototype.newSegmentOnContent=function(e){e=e||"segment";this.newSegmentNeeded=e};v.prototype.addSelectedChoice=function(e){var t=document.createElement("p");t.classList.add("chosen");t.textContent=e;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(t)};v.prototype.addMessage=function(e,t,i){if(this.gSceneDispatch.message?.addMessage){this.gSceneDispatch.message.addMessage(e,t).then(i);return}var n=false;i=i||y;e=h.markup(e);var r=()=>{if(n){return}n=true;if(t.next){s.scrollIntoView(false);this.messageNext(t.next,i);return}i()};var s=document.createElement("p");s.classList.add("text");if(t.next){s.classList.add("continue")}if(t.class){m.class(s,u.toClassObject(t.class),"s-")}if(t.style){m.css(s,t.style)}s.innerHTML=e;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(s);if(t.important&&this.$importantMessages){this.$importantMessages.appendChild(s.cloneNode(true))}r()};v.prototype.messageNext=function(e,t){var i=false;var n=()=>{if(i){return}i=true;this.$spellcast.classList.remove("continue");t()};this.$spellcast.classList.add("continue");this.once("continue",n);if(typeof e==="number"&&isFinite(e)&&e>0){setTimeout(n,e*1e3)}};v.prototype.addSpeech=function(e,t,i){var n;e=h.stripMarkup(e);if(t.speechReplay){if(t.speechOnly&&this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}n=document.createElement("button");n.classList.add("replay-button");n.setAttribute("disabled",true);n.textContent="▶";this.$activeSegment.appendChild(n)}this.speech(e,t,()=>{if(t.speechReplay){n.removeAttribute("disabled");n.addEventListener("click",()=>{this.speech(e,t)})}i()})};v.prototype.speech=function(e,t,i){if(t.useService){this.restServiceSpeech(e,t,i)}else{this.nativeBrowserSpeech(e,t,i)}};v.prototype.restServiceSpeech=function(e,t,i){var n=/speech/;n+="?text="+encodeURIComponent(e);n+="&lang="+encodeURIComponent(t.speechLang||"en");n+="&volume="+encodeURIComponent(t.speechVolume!==undefined?t.speechVolume:1);n+="&rate="+encodeURIComponent(t.speechRate!==undefined?t.speechRate:1);n+="&pitch="+encodeURIComponent(t.speechPitch!==undefined?t.speechPitch:1);this.sound({url:n},i)};v.prototype.nativeBrowserSpeech=function(e,t,i){var n=window.speechSynthesis,r,s;if(!n){i();return}r=new SpeechSynthesisUtterance(e);r.lang=t.speechLang||"en-US";r.volume=t.speechVolume!==undefined?t.speechVolume:1;r.rate=t.speechRate!==undefined?t.speechRate:1;r.pitch=t.speechPitch!==undefined?t.speechPitch:1;if(t.speechVoice){r.voiceURI=t.speechVoice}r.onend=e=>{console.log("Speech: finished in "+e.elapsedTime+" seconds.");i()};n.speak(r)};v.prototype.addIndicators=function(e,t,i){i=i||y;if(t){m.empty(this.$status);if(e.length){this.$status.classList.remove("empty")}else{this.$status.classList.add("empty");i();return}}var a=document.createElement("indicator-list");e.forEach(e=>{var t,i,n,r,s,o;t=document.createElement("indicator");i=document.createElement("label");i.classList.add("label");if(e.image){t.classList.add("has-image");n=document.createElement("img");n.classList.add("image");n.setAttribute("src",this.cleanUrl(e.image));if(e.label){n.setAttribute("alt",e.label);n.setAttribute("title",e.label)}i.appendChild(n)}else{i.textContent=e.label}t.appendChild(i);r=document.createElement("widget");r.classList.add("widget");r.classList.add(e.type);r.setAttribute("data-value",e.value);switch(e.type){case"hbar":o=document.createElement("outer-bar");r.appendChild(o);s=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){s.style.backgroundColor=e.color}s.style.width=""+e.value+"%";o.appendChild(s);break;case"vbar":o=document.createElement("outer-bar");r.appendChild(o);s=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){s.style.backgroundColor=e.color}s.style.height=""+e.value+"%";o.appendChild(s);break;case"text":default:r.textContent=e.value}t.appendChild(r);a.appendChild(t)});if(t){this.$status.appendChild(a)}else{if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(a)}i()};v.prototype.addPanel=function(e,t,i){i=i||y;if(t){m.empty(this.$panel);if(e.length){this.$panel.classList.remove("empty")}else{this.$panel.classList.add("empty");i();return}}else if(e.length){this.$panel.classList.remove("empty")}e.forEach(e=>{var t,i,n="button-"+e.id;if(document.getElementById(n)){return}t=document.createElement("item");t.classList.add("button");t.classList.add("disabled");t.setAttribute("id",n);if(e.image){t.classList.add("has-image");if(e.image.endsWith(".svg")){i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.classList.add("svg");g.load(this.cleanUrl(e.image),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,colorClass:true,as:i})}else{i=document.createElement("img");i.setAttribute("src",this.cleanUrl(e.image))}i.classList.add("icon");i.classList.add("image");if(e.label){i.setAttribute("alt",e.label);i.setAttribute("title",e.label)}t.appendChild(i)}else{t.textContent=e.label}this.$panel.appendChild(t)});i()};v.prototype.setChoices=async function(e,t,i,n={}){await this.clearChoices();await this.addChoices(e,t,i,n);return};v.prototype.updateChoices=v.prototype.setChoices;v.prototype.clearChoices=function(){if(this.gSceneDispatch.choices?.clearChoices){return this.gSceneDispatch.choices.clearChoices()}var i;this.choices.forEach(e=>{if(!e.button){return}var t="button-"+e.button;i=document.getElementById(t);if(i){i.removeAttribute("data-select-index");i.classList.add("disabled");i.removeEventListener("click",this.onSelect);i.removeEventListener("mouseleave",this.onLeave);i.removeEventListener("mouseenter",this.onEnter)}});m.empty(this.$choices);this.choices.length=0;this.onSelect=null;this.onLeave=null;this.onEnter=null};v.prototype.addChoices=async function(e,t,i,n={}){if(this.gSceneDispatch.choices?.addChoices){return this.gSceneDispatch.choices.addChoices(e,t,i,n)}if(this.uiLoadingCount){await this.waitFor("uiLoaded")}switch(n.nextStyle){case"inline":case"smallInline":case"list":case"smallList":this.$choices.setAttribute("data-choice-style",n.nextStyle);break;case"table":this.$choices.setAttribute("data-choice-style",n.nextStyle);this.$choices.classList.add("columns-"+this.getChoiceColumnsCount(e));break;default:this.$choices.setAttribute("data-choice-style","list")}var o=false;var a=document.createDocumentFragment();var l=document.createElement("group");this.createChoiceEventHandlers(i);e.forEach(e=>{var t;this.choices.push(e);if(e.button&&(t=document.getElementById("button-"+e.button))&&!t.getAttribute("data-select-index")&&!t.classList.contains("inactive")){if(e.groupBreak){o=true}t.setAttribute("data-select-index",e.index);t.classList.remove("disabled");t.addEventListener("click",this.onSelect);if(e.label){t.setAttribute("data-button-hint",e.label);t.addEventListener("mouseleave",this.onLeave);t.addEventListener("mouseenter",this.onEnter)}return}var i=document.createElement("choice");i.classList.add("choice",e.type);i.setAttribute("data-select-index",e.index);i.classList.remove("disabled");if(e.class){m.class(i,u.toClassObject(e.class),"s-")}if(e.style){m.css(i,e.style)}if(e.image){i.classList.add("has-image");var n=document.createElement("img");n.classList.add("image");n.setAttribute("src",this.cleanUrl(e.image));i.appendChild(n)}var r=document.createElement("span");r.classList.add("label");r.textContent=e.label;i.appendChild(r);if(e.selectedBy&&e.selectedBy.length){var s=document.createElement("span");s.classList.add("italic","brightBlack");s.textContent=" "+e.selectedBy.join(", ");i.appendChild(s)}i.addEventListener("click",this.onSelect);if(e.groupBreak||o){o=false;a.appendChild(l);l=document.createElement("group")}l.appendChild(i)});a.appendChild(l);this.$choices.appendChild(a);if(t&&t.length){var r=document.createElement("p");r.classList.add("unassigned-users");r.textContent=t.join(", ");this.$choices.appendChild(r)}if(typeof n.timeout==="number"){this.choiceTimeout(n.timeout)}};v.prototype.getChoiceColumnsCount=function(e){var t=0,i=0;e.forEach(e=>{if(e.groupBreak){if(t>i){i=t}t=0}t++});if(t>i){i=t}return i};v.prototype.choiceTimeout=function(e){var t=Date.now(),i,n;i=document.createElement("p");i.classList.add("timer");i.textContent=Math.round(e/1e3);this.$choices.appendChild(i);n=setInterval(()=>{if(!i.parentNode){clearInterval(n);return}i.textContent=Math.round((e+t-Date.now())/1e3)},1e3)};v.prototype.createChoiceEventHandlers=function(n){this.onSelect=e=>{var t=e.currentTarget;var i=t.getAttribute("data-select-index");if(!i){return}i=parseInt(i,10);n(i)};this.onLeave=e=>{this.clearHint()};this.onEnter=e=>{var t=e.currentTarget;var i=t.getAttribute("data-button-hint");if(!i){return}this.setHint(i,{active:true})}};v.prototype.textInputDisabled=function(e){if(this.gSceneDispatch.textInput?.textInputDisabled){this.gSceneDispatch.textInput.textInputDisabled(e);return}var t=document.createElement("form"),i=document.createElement("label"),n=document.createElement("input");i.textContent=e.label;n.setAttribute("placeholder",e.placeholder);n.setAttribute("disabled",true);n.setAttribute("type","text");n.classList.add("text-input");t.appendChild(i);t.appendChild(n);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(t)};v.prototype.textInput=function(e,t){if(this.gSceneDispatch.textInput?.textInput){this.gSceneDispatch.textInput.textInput(e).then(t);return}var i=document.createElement("form"),n=document.createElement("label"),r=document.createElement("input");n.classList.add("text");n.textContent=e.label;r.setAttribute("type","text");r.classList.add("text-input");i.appendChild(n);i.appendChild(r);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(i);r.focus();var s=function(e){e.preventDefault();i.removeEventListener("submit",s);r.setAttribute("disabled",true);t(r.value)};i.addEventListener("submit",s)};v.prototype.enableCommand=function(t){if(!this.onCommandSubmit){this.onCommandSubmit=e=>{e.preventDefault();t(this.$chatInput.value);this.$chatInput.value=""};this.$chatForm.addEventListener("submit",this.onCommandSubmit);this.$mainBuffer.classList.remove("chat-hidden");this.$chat.classList.remove("hidden");this.$chatInput.removeAttribute("disabled")}};v.prototype.disableCommand=function(){this.$chatForm.removeEventListener("submit",this.onCommandSubmit);this.onCommandSubmit=null;this.$mainBuffer.classList.add("chat-hidden");this.$chat.classList.add("hidden");this.$chatInput.setAttribute("disabled",true)};v.prototype.clearHint=function(){if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}this.$hint.classList.add("empty");this.hintTimer=setTimeout(()=>{m.empty(this.$hint)},3e3)};v.prototype.setHint=function(e,t){if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}if(this.$hint.textContent){this.$hint.classList.add("empty");this.hintTimer=setTimeout(()=>{m.empty(this.$hint);this.setHint(e,t)},300);return}this.$hint.textContent=e;this.$hint.classList.remove("empty");m.class(this.$hint,{passive:!!t.passive,active:!!t.active});this.hintTimer=setTimeout(this.clearHint.bind(this),3e3)};v.prototype.setBigHint=function(e,t){var i=document.createElement("h2");i.textContent=e;if(t){m.class(i,t)}m.empty(this.$hint);this.$hint.appendChild(i)};v.prototype.clearDialog=function(){this.$dialogWrapper.classList.add("empty");this.$dialogWrapper.classList.remove("modal");var e=false;var t=()=>{this.$dialogWrapper.removeEventListener("transitionstart",t);if(e){return}e=true;this.$dialogWrapper.addEventListener("transitionend",i)};var i=()=>{this.$dialogWrapper.removeEventListener("transitionend",i);m.empty(this.$dialogWrapper)};this.$dialogWrapper.addEventListener("transitionstart",t);setTimeout(()=>{if(e){return}e=true;m.empty(this.$dialogWrapper)},10)};v.prototype.setDialog=function(e,t,i){t=t||{};i=i||y;if(t.contentDelay&&!this.newSegmentNeeded){delete t.contentDelay;var n=this.$activeSegment.innerHTML.replace(/<[^>]+>|&[a-z]+;/g,"").length;var r=Math.min(n*10,5e3);console.warn("contentLength/delay",n,r);setTimeout(this.setDialog.bind(this,e,t,i),r);return}var s=document.createElement("div");s.classList.add("dialog");if(t.title){var o=document.createElement("h2");o.classList.add("title");o.textContent=t.title;s.appendChild(o)}var a=document.createElement("div");a.classList.add("message");a.textContent=e;s.appendChild(a);if(t.slow){this.$dialogWrapper.classList.add("slow")}else{this.$dialogWrapper.classList.remove("slow")}if(t.big){s.classList.add("big")}if(t.fun){s.classList.add("fun")}if(t.alert){s.classList.add("alert")}if(t.modal){s.classList.add("modal");this.$dialogWrapper.classList.add("modal")}else{this.$dialogWrapper.classList.remove("modal")}m.empty(this.$dialogWrapper);this.$dialogWrapper.appendChild(s);this.$dialogWrapper.classList.remove("empty");i()};v.prototype.setSceneImage=function(e){var t=false;var i=this.$sceneImage;this.$sceneImage=document.createElement("div");this.$sceneImage.classList.add("scene-image");if(e.url){this.$sceneImage.style.backgroundImage='url("'+this.cleanUrl(e.url)+'")'}if(e.origin&&typeof e.origin==="string"){this.$sceneImage.style.backgroundPosition=e.origin}var n=()=>{if(t){return}t=true;i.remove()};if(i){i.addEventListener("transitionend",n,false);this.$gfx.insertBefore(this.$sceneImage,i);i.classList.add("hidden");setTimeout(n,2e3)}else{this.$gfx.insertBefore(this.$sceneImage,this.$gfx.firstChild||null)}switch(e.position){case"left":this.$spellcast.setAttribute("data-image-position","left");break;case"right":default:this.$spellcast.setAttribute("data-image-position","right");break}};v.prototype.createGScene=function(e,t){if(this.gScenes[e]){this.clearGScene(e)}console.warn("createGScene:",t.engineId,b.lib,b.lib[t.engineId]&&b.lib[t.engineId].GScene);var i=b.lib[t.engineId]&&b.lib[t.engineId].GScene||r;var n=this.gScenes[e]=new i(this,t);if(t.catch){this.updateGSceneDispatch(n,t.catch)}return n.update(t,false,true)};v.prototype.updateGScene=function(e,t,i){var n=this.gScenes[e];if(!n){console.warn("Unknown GScene id: ",e);return p.resolved}if(t.catch){this.updateGSceneDispatch(n,t.catch)}return n.update(t,i)};v.prototype.clearGScene=function(e){var t=this.gScenes[e];if(!t){console.warn("Unknown GScene id: ",e);return}this.removeGSceneDispatch(t);t.$gscene.remove();delete this.gScenes[e]};v.prototype.updateGSceneDispatch=function(t,i){if(!i||typeof i!=="object"){return}for(let e in i){if(this.gSceneDispatch[e]===undefined){continue}this.gSceneDispatch[e]=i[e]?t:null}};v.prototype.removeGSceneDispatch=function(t){for(let e in this.gSceneDispatch){if(this.gSceneDispatch[e]===t){this.gSceneDispatch[e]=null}}};v.prototype.updateCamera=function(e,t,i=false){var n=this.gScenes[e];if(!n){console.warn("Unknown GScene id: ",e);return p.resolved}return n.globalCamera.update(t,i)};v.prototype.defineTexturePack=function(e,t,i){var n=this.gScenes[e];if(!n){console.warn("Unknown GScene id: ",e);return p.resolved}n.texturePacks[t]=new s(i);console.warn("All texture packs so far for gScene:",e,n.texturePacks)};v.prototype.createGEntity=function(e,t,i,n=false){var r,s,o,a=this.gScenes[e];if(!a){console.warn("Unknown GScene id: ",e);return p.resolved}if(a.hasGEntity(t)){a.removeGEntity(t)}i.id=t;console.warn("createGEntity:",a.engineId,b.lib,b.lib[a.engineId]&&b.lib[a.engineId].GEntity);s=b.lib[a.engineId];if(s){r=s.perUsageGEntity&&s.perUsageGEntity[i.usage]||s.GEntity||l}else{r=l}o=new r(this,a,i);return o.update(i,n,true)};v.prototype.updateGEntity=function(e,t,i,n=false){var r=this.gScenes[e];if(!r){console.warn("Unknown GScene id: ",e);return p.resolved}var s=r.getGEntity(t);if(!s){console.warn("Unknown GEntity id: ",t);return p.resolved}return s.update(i,n)};v.prototype.clearGEntity=function(e,t){var i=this.gScenes[e];if(!i){console.warn("Unknown GScene id: ",e);return p.resolved}i.removeGEntity(t)};v.prototype.animateGEntity=async function(e,t){var i,n=0;e.animation=t.id;if(!Array.isArray(t.frames)||!t.frames.length){return}for(i of t.frames){await this.updateGEntity(e,i);await p.resolveTimeout(i.duration*1e3)}e.animation=null};v.prototype.defineAnimation=function(e,t){t.id=e;this.animations[e]=t};v.prototype.diceRollerDisabled=function(e){};v.prototype.diceRoller=async function(e){var t,i,n,r=e.gScene||"default",s=this.gScenes[r];console.warn("DOM diceRoller()",e,s,b.lib[s?.engineId]);if(!s){return{unsupported:true}}i=b.lib[s.engineId];if(!i||!i.DiceRoller){return{unsupported:true}}try{n=new i.DiceRoller(s,e);n.init();t=await n.roll()}catch(e){console.warn("DOM diceRoller() error:",e);return{unsupported:true}}return t};v.prototype.sound=function(e,t){var i,n=this["$sound"+this.nextSoundChannel];console.warn("$sound"+this.nextSoundChannel,e,n);this.nextSoundChannel=(this.nextSoundChannel+1)%4;n.setAttribute("src",this.cleanUrl(e.url));n.play();if(t){i=()=>{n.removeEventListener("ended",i);t()};n.addEventListener("ended",i)}};v.prototype.music=function(e){var t=this.$music.getAttribute("src");if(e.url){e.url=this.cleanUrl(e.url);if(t){if(t!==e.url){k(this.$music,()=>{this.$music.setAttribute("src",e.url);this.$music.play();S(this.$music)})}else if(this.$music.ended){this.$music.play()}}else{this.$music.volume=0;this.$music.setAttribute("src",e.url);this.$music.play();S(this.$music)}}else if(t){k(this.$music,()=>{this.$music.removeAttribute("src")})}};var w=10;var _=.01;function S(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume>=1){if(t){t()}return}e.volume=Math.min(1,e.volume+_);e.__fadeTimer=setTimeout(S.bind(undefined,e,t),w)}function k(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume<=0){if(t){t()}return}e.volume=Math.max(0,e.volume-_);e.__fadeTimer=setTimeout(k.bind(undefined,e,t),w)}},{"./Camera.js":1,"./GEntity.js":4,"./GScene.js":5,"./TexturePack.js":7,"./commonUtils.js":9,"./controller/Controller.js":10,"./controller/gamepad/BrowserGamepadHub.js":12,"./controller/keyboard/BrowserKeyboard.js":16,"./engineLib.js":18,"./exm.js":19,"./toolkit.js":22,"dom-kit":24,"nextgen-events/lib/LeanEvents.js":32,"nextgen-events/lib/browser.js":35,seventh:50,"svg-kit":69}],3:[function(e,t,i){"use strict";const n=e("./Dom.js");const r=e("seventh");const s=e("nextgen-events/lib/browser.js");function o(e,t){console.log(Array.from(arguments));this.bus=e;this.client=t;this.user=null;this.users=null;this.roles=null;this.roleId=null;this.config=null;this.inGame=false;this.nexts=null;this.afterNext=false;this.afterNextTriggered=false;this.afterLeave=false;this.hasNewContent=false;this.dom=new n;this.ended=false;this.client.once("connecting",o.clientConnecting.bind(this));this.client.once("open",o.clientOpen.bind(this));this.client.once("close",o.clientClose.bind(this));this.client.on("error",o.clientError.bind(this));this.commandConfig({enabled:true});this.dom.preload()}t.exports=o;o.prototype=Object.create(s.prototype);o.prototype.constructor=o;const a=e("./exm.js");function l(t){return this.find(e=>{return e.id===t})}o.prototype.initBus=function(){this.bus.on("clientConfig",o.clientConfig.bind(this),{async:true});this.bus.on("user",o.user.bind(this));this.bus.on("userList",o.userList.bind(this));this.bus.on("roleList",o.roleList.bind(this));this.bus.on("extOutput",o.extOutput.bind(this));this.bus.on("extErrorOutput",o.extErrorOutput.bind(this));this.bus.on("message",o.message.bind(this),{async:true});this.bus.on("indicators",o.indicators.bind(this));this.bus.on("status",o.status.bind(this));this.bus.on("panel",o.panel.bind(this));this.bus.on("theme",o.theme.bind(this));this.bus.on("image",o.image.bind(this));this.bus.on("sound",o.sound.bind(this));this.bus.on("music",o.music.bind(this));this.bus.on("createGScene",o.createGScene.bind(this));this.bus.on("updateGScene",o.updateGScene.bind(this),{async:true});this.bus.on("clearGScene",o.clearGScene.bind(this));this.bus.on("camera",o.camera.bind(this),{async:true});this.bus.on("texturePack",o.texturePack.bind(this),{async:true});this.bus.on("createGEntity",o.createGEntity.bind(this),{async:true});this.bus.on("updateGEntity",o.updateGEntity.bind(this),{async:true});this.bus.on("clearGEntity",o.clearGEntity.bind(this));this.bus.on("animateGEntity",o.animateGEntity.bind(this),{async:true});this.bus.on("defineAnimation",o.defineAnimation.bind(this));this.bus.on("enterScene",o.enterScene.bind(this));this.bus.on("leaveScene",o.leaveScene.bind(this));this.bus.on("nextList",o.nextList.bind(this));this.bus.on("nextTriggered",o.nextTriggered.bind(this));this.bus.on("textInput",o.textInput.bind(this));this.bus.on("commandConfig",o.prototype.commandConfig.bind(this));this.bus.on("rejoinRoles",o.rejoinRoles.bind(this));this.bus.on("pause",o.pause.bind(this));this.bus.on("unpause",o.unpause.bind(this));this.bus.on("wait",o.wait.bind(this));this.bus.on("end",o.end.bind(this),{async:true});this.bus.on("diceRoller",o.diceRoller.bind(this));this.bus.on("custom",o.custom.bind(this));this.bus.on("exit",o.exit.bind(this),{async:true});this.bus.emit("ready");this.defineStates("end")};o.clientConnecting=function(){console.log("Connecting!");this.dom.clientStatus("connecting")};o.clientOpen=function(){console.log("Connected!");this.dom.clientStatus("connected");this.initBus()};o.clientClose=function(){console.log("Closed!");this.dom.clientStatus("closed")};o.clientError=function(e){switch(e){case"unreachable":this.dom.clientStatus("unreachable");break}};o.clientConfig=async function(e,t){this.config=e;console.warn("Client config received: ",e);if(this.config.theme){this.dom.setTheme(this.config.theme)}if(this.config.clientExtensions){for(let e of this.config.clientExtensions){await a.requireExtension(e)}}t()};o.user=function(e){console.log("User received: ",e);this.user=e};o.userList=function(e){console.log("User-list received: ",e);e.get=l;this.users=e};o.roleList=function(t,e,i){var n=[],r;if(!this.roles&&t.length>1){this.dom.setMultiplayer(true)}t.get=l;this.roles=t;if(this.inGame){return}if(i&&t.length<=1){this.roleId=t[0].id;return}t.forEach((e,t)=>{var i=e.clientId&&this.users.get(e.clientId).name;n.push({index:t,label:e.name,type:"role",selectedBy:i&&[i]})});if(e.length){r=e.map(e=>{return this.users.get(e).name})}var s=e=>{if(t[e].clientId===this.user.id){this.bus.emit("selectRole",null)}else if(t[e].clientId!==null){return}else{this.bus.emit("selectRole",t[e].id)}};this.dom.setChoices(n,r,s);if(i){t.find(e=>{if(e.clientId===this.user.id){this.roleId=e.id;return true}return false});this.afterLeave=true;return}};o.message=function(i,n,r){this.hasNewContent=true;if(!n){n={}}if(n.speech){if(!n.speechLang){n.speechLang=this.config.defaultLocale}n.useService=this.config.hasSpeechService;if(n.speechOnly){this.dom.addSpeech(i,n,r)}else{let e=false,t=false;this.dom.addMessage(i,n,()=>{e=true;if(t){r()}});this.dom.addSpeech(i,n,()=>{t=true;if(e){r()}})}}else{this.dom.addMessage(i,n,r)}};o.indicators=function(e){this.dom.addIndicators(e)};o.status=function(e){this.dom.addIndicators(e,true)};o.panel=function(e,t){this.dom.addPanel(e,t)};o.enterScene=function(e,t){var i;this.inGame=true;if(t){i=this.dom.toAltBuffer()}if(!e&&!i){this.dom.newSegmentOnContent()}this.afterNext=this.afterLeave=this.afterNextTriggered=false};o.leaveScene=function(e,t){if(t){this.dom.toMainBuffer()}this.afterNext=this.afterNextTriggered=false;this.afterLeave=true};o.nextTriggered=function(t){var e=this.nexts.find(e=>e.id===t);this.dom.newSegmentOnContent("inter-segment");if(e&&e.label&&!e.button){this.dom.addSelectedChoice(e.label)}this.dom.clearChoices();this.afterNextTriggered=true;this.hasNewContent=false};o.nextList=function(t,e,i,n){var r=[],s,o=0;this.nexts=t;this.afterNext=true;if(n&&this.roles.length===1){return}t.forEach((e,t)=>{var i=e.roleIds.map(e=>{return this.roles.get(e).name});if(e.label){o+=e.label.length}r.push({index:t,label:e.label||"Next",style:e.style,class:e.class,image:e.image,button:e.button,groupBreak:!!e.groupBreak,type:"next",selectedBy:i})});if(!i.nextStyle||i.nextStyle==="auto"){if(this.roles.length<=1&&r.length<=3&&o<20){i.nextStyle="inline"}else if(r.length>8){i.nextStyle="smallList"}else{i.nextStyle="list"}}if(e.length&&this.roles.length){s=e.map(e=>{return this.roles.get(e).name})}var a=e=>{if(t[e].roleIds.indexOf(this.roleId)!==-1){this.bus.emit("selectNext",null)}else{this.bus.emit("selectNext",t[e].id)}};this.dom.setChoices(r,s,a,{timeout:i.timeout,nextStyle:i.nextStyle})};o.extOutput=function(e){alert("not coded ATM!")};o.extErrorOutput=function(e){alert("not coded ATM!")};o.textInput=function(e,t){var i={label:e};if(t.indexOf(this.roleId)===-1){i.placeholder="YOU CAN'T RESPOND - WAIT...";this.dom.textInputDisabled(i)}else{this.dom.textInput(i,e=>{this.bus.emit("textSubmit",e)})}};o.prototype.commandConfig=function(e){console.warn("Received command config:",e);if(e.enabled===true){this.dom.enableCommand(e=>{this.bus.emit(this.inGame?"command":"chat",e)})}else if(e.enabled===false){this.dom.disableCommand()}};o.pause=function(e){console.log("Received a pause event for",e,"seconds")};o.unpause=function(){console.log("Received an unpause event")};o.rejoinRoles=function(){};o.wait=function(e){switch(e){case"otherBranches":this.dom.setBigHint("WAITING FOR OTHER BRANCHES TO FINISH...",{wait:true,"pulse-animation":true});this.bus.once("rejoinRoles",()=>this.dom.clearHint());break;default:this.dom.setBigHint("WAITING FOR "+e,{wait:true,"pulse-animation":true})}};o.theme=function(e){if(!e.url){if(this.config.theme){this.dom.setTheme(this.config.theme)}return}this.dom.setTheme(e)};o.image=function(e){this.dom.setSceneImage(e)};o.createGScene=function(e,t){console.warn("createGScene",e,t);this.dom.createGScene(e,t)};o.updateGScene=function(e,t,i,n){console.warn("updateGScene",e,t);this.dom.updateGScene(e,t,i).then(n)};o.clearGScene=function(e){console.warn("clearGScene",e);this.dom.clearGScene(e)};o.camera=function(e,t,i,n){console.warn("camera",e,t);if(i){this.dom.updateCamera(e,t,true).then(n)}else{this.dom.updateCamera(e,t,false);n()}};o.texturePack=function(e,t,i,n){console.warn("texturePack",e,t,i);this.dom.defineTexturePack(e,t,i);n()};o.createGEntity=function(e,t,i,n,r){this.dom.createGEntity(e,t,i,n).then(r)};o.updateGEntity=function(e,t,i,n,r){if(n){this.dom.updateGEntity(e,t,i,true).then(r)}else{this.dom.updateGEntity(e,t,i,false);r()}};o.clearGEntity=function(e,t){this.dom.clearGEntity(e,t)};o.animateGEntity=function(e,t,i,n,r){this.dom.animateGEntity(e,t,i,n).then(r)};o.defineAnimation=function(e,t){this.dom.defineAnimation(e,t)};o.sound=function(e){this.dom.sound(e)};o.music=function(e){this.dom.music(e)};o.end=function(e,t,i){var n={modal:true,big:true,fun:true,contentDelay:this.hasNewContent,slow:true};var r=()=>{if(this.ended){return}this.ended=true;console.log("finished!");this.emit("end");i()};switch(e){case"end":this.dom.setDialog("The End.",n,r);break;case"win":this.dom.setDialog("You Win!",n,r);break;case"lost":this.dom.setDialog("You Lose...",n,r);break;case"draw":this.dom.setDialog("Draw.",n,r);break}};o.diceRoller=function(e,t){if(e.indexOf(this.roleId)===-1){this.dom.diceRollerDisabled(t)}else{this.dom.diceRoller(t).then(e=>{this.bus.emit("diceRollerSubmit",e)})}};o.custom=function(e,t){console.log("Received a custom event",e,t)};o.exit=function(e,t,i){console.log("exit cb",i);this.once("end",()=>{setTimeout(200,i)})}},{"./Dom.js":2,"./exm.js":19,"nextgen-events/lib/browser.js":35,seventh:50}],4:[function(e,t,i){"use strict";const s=e("./GTransition.js");const n=e("./commonUtils.js");const o=e("./sizeModes.js");const a=e("./positionModes.js");const r=e("nextgen-events/lib/browser.js");const k=e("seventh");const E=e("dom-kit");const f=e("svg-kit");function l(e,t,i){this.id=i.id||null;this.gScene=t;this.gScene.registerGEntity(this.id,this);this.dom=e;this.usage=i.usage||"sprite";this.parent=undefined;this.parentMode=undefined;this.transient=i.transient||undefined;this.destroyed=false;this.show=false;this.persistent=true;this.button=null;this.theme=null;this.texturePack=null;this.variant="default";this.location=null;this.position={x:0,y:0,z:0};this.positionMode="default";this.size={x:1,y:1,z:1};this.sizeMode="default";this.rotation={x:0,y:0,z:0};this.rotationMode="default";this.rotation={x:0,y:0,z:1};this.direction={x:1,y:0,z:0};this.facing=0;this.billboard=null;this.opacity=1;this.special={};this.meta={};this.engine={};this.firstUpdate=true;this.$wrapper=null;this.$image=null;this.$backImage=null;this.$mask=null;this.$locationSlot=null;this.$front=null;this._transform={};if(this.usage!=="marker"){this.$wrapper=document.createElement("div");this.$wrapper.style.visibility="hidden";this.$wrapper.style.transition="none";this.$wrapper.classList.add("g-entity-wrapper","g-entity-"+this.usage+"-wrapper");this.gScene.$gscene.append(this.$wrapper)}this.defineStates("loaded","loading")}l.prototype=Object.create(r.prototype);l.prototype.constructor=l;t.exports=l;l.prototype.destroy=function(){if(this.destroyed){return}if(this.$locationSlot){this.$locationSlot.remove()}this.$wrapper.remove();this.gScene.unregisterGEntity(this.id);this.destroyed=true};l.prototype.update=async function(e,t=false,i=false){var n=k.resolved;console.warn("GEntity.update()",e);if(e.delay){await k.resolveTimeout(e.delay*1e3)}if(this.firstUpdate){if(typeof this.transient==="number"){setTimeout(()=>this.destroy(),this.transient*1e3)}this.firstUpdate=false}if(e.texturePack!==undefined||e.variant!==undefined||e.theme!==undefined){await this.updateTexture(e.texturePack,e.variant,e.theme)}if(e.special){if(e.special.vgUrl){await this.updateVgImage(e.special.vgUrl)}else if(e.special.vgObject){this.updateVgObject(e.special.vgObject)}else if(e.special.vgMorph){this.updateVgMorph(e.special.vgMorph)}if(e.special.area){this.updateVgArea(e.special.area)}}if(this.usage==="marker"&&(e.location||e.special&&e.special.inVg)){this.updateMarkerLocation(e.special&&e.special.inVg,e.location)}if(e.button!==undefined){this.updateButton(e.button)}if(!i&&this.usage!=="marker"){n=this.updateTransition(e,t)}if(e.location!==undefined&&this.usage!=="marker"){await this.moveToLocation(e.location)}if(e.direction!==undefined){this.direction=e.direction}if(e.facing!==undefined){this.facing=e.facing}if(e.billboard!==undefined){this.billboard=e.billboard}if(e.opacity!==undefined){this.opacity=e.opacity}if(e.position!==undefined||e.positionMode!==undefined||e.size!==undefined||e.sizeMode!==undefined||e.rotation!==undefined||e.rotationMode!==undefined){this.updateTransform(e)}if(e.meta){this.updateMeta(e.meta)}if(i&&this.usage!=="marker"){this.$wrapper.style.visibility="visible"}return t?n:null};l.prototype.updateTexture=function(e,t,i){var n,r;if(e!==undefined){this.texturePack=e||null}if(t!==undefined){this.variant=t||null}if(i!==undefined){this.theme=i||null}console.warn("GEntity.updateTexture()",e,t,i);n=this.gScene.texturePacks[this.texturePack+"/"+(this.theme||this.gScene.theme)];if(!n){console.warn("Texture pack",this.texturePack+"/"+(this.theme||this.gScene.theme),"not found");n=this.gScene.texturePacks[this.texturePack+"/default"];if(!n){console.warn("Texture pack fallback",this.texturePack+"/default","not found");return k.resolved}}r=n.variants[this.variant]||n.variants.default;if(!r){console.warn("Texture pack variant",this.variant,"not found, and default variant missing too");return k.resolved}return this.updateImage(r.frames[0].url)};l.prototype.updateImage=function(e){if(this.usage==="card"){this.$image.style.backgroundImage='url("'+this.dom.cleanUrl(e)+'")';return k.resolved}if(e.endsWith(".svg")){return this.updateVgImage(e)}var t=new k,i=!this.$image;if(this.$image&&this.$image.tagName.toLowerCase()!=="img"){this.$image.remove();this.$image=null}if(!this.$image){i=true;this.$image=document.createElement("img");this.$image.classList.add(this.usage)}this.$image.setAttribute("src",this.dom.cleanUrl(e));this.$image.onload=()=>t.resolve();if(i&&this.usage!=="marker"){this.$wrapper.append(this.$image)}return t};l.prototype.updateVgImage=function(e){console.warn(".updateVgImage()");if(!e.endsWith(".svg")){console.warn(".updateVgImage(): not a .svg file");return k.resolved}var t=new k;if(this.$image){this.$image.remove()}if(this.usage==="marker"){this.$image=document.createElementNS("http://www.w3.org/2000/svg","g")}else{this.$image=document.createElementNS("http://www.w3.org/2000/svg","svg");this.$image.classList.add("svg")}switch(this.usage){case"vg":this.onClick=e=>{e.stopPropagation()};this.$image.addEventListener("click",this.onClick);this.$image.classList.add("vg");this.dom.uiLoadingCount++;break;case"sprite":this.$image.classList.add("sprite");break;case"marker":this.$image.classList.add("marker");break}f.load(this.dom.cleanUrl(e),{removeSvgStyle:true,removeComments:true,removeExoticNamespaces:true,as:this.$image}).then(()=>{console.warn("loaded!");if(this.usage==="vg"){this.setVgButtons(this.$image);this.setVgPassiveHints(this.$image);this.emit("loaded");if(--this.dom.uiLoadingCount<=0){this.emit("uiLoaded")}}else{this.emit("loaded")}t.resolve()});console.warn("Aft load");this.emit("loading");if(this.usage!=="marker"){this.$wrapper.append(this.$image)}return t};l.prototype.updateTransform=function(e){var t,i,n,r;if(e.position){this.position=e.position}if(e.size){this.size=e.size}if(e.rotation){this.rotation=e.rotation}if(e.positionMode){this.positionMode=e.positionMode||"default"}if(e.sizeMode){this.sizeMode=e.sizeMode||"default"}if(e.rotationMode){this.rotationMode=e.rotationMode||"default"}if(!this.$wrapper||!this.$image){return}t=this.gScene.$gscene.offsetWidth;i=this.gScene.$gscene.offsetHeight;if(this.$image.tagName.toLowerCase()==="svg"){n=this.$wrapper.offsetWidth;r=this.$wrapper.offsetHeight}else{n=this.$image.offsetWidth;r=this.$image.offsetHeight}console.log("dbg img:",{areaWidth:t,areaHeight:i,imageWidth:n,imageHeight:r});(o[this.sizeMode]||o.default)(this._transform,this.size,t,i,n,r);console.log("._transform after size computing",this._transform);(a[this.positionMode]||a.default)(this._transform,this.position,t,i,n,r);console.log("._transform after position computing",this._transform);this._transform.eulerOrder=this.rotationMode==="default"?null:this.rotationMode;this._transform.rotateX=-this.rotation.x;this._transform.rotateY=this.rotation.y;this._transform.rotateZ=-this.rotation.z;console.log("._transform after rotation computing",this._transform);E.transform(this.$wrapper,this._transform)};l.prototype.updateTransition=function(e,t=false){console.warn("GEntity.updateTransition()",e.transition,e);var i=k.resolved;if(!e.transition){this.$wrapper.style.transition="none";return i}var n=new s(e.transition),r=[];if(e.position!==undefined||e.positionMode!==undefined||e.size!==undefined||e.sizeMode!==undefined||e.rotation!==undefined||e.rotationMode!==undefined){r.push(n.toString("transform"))}if(!r.length){this.$wrapper.style.transition="none"}else{this.$wrapper.style.transition=r.join(", ");if(t){i=new k;i.resolveTimeout(1e3*n.duration+20);this.$wrapper.ontransitionend=()=>{this.$wrapper.ontransitionend=null;i.resolve()}}}return i};l.prototype.updateButton=function(e){var t=this.$mask||this.$wrapper;t.setAttribute("id","button-"+e);t.classList.add("button");t.classList.add("disabled")};l.prototype.updateMeta=function(e){var t,i;for(i in e){t=e[i];if(t){this.$wrapper.classList.add("meta-"+i);if(typeof t==="number"||typeof t==="string"){this.$wrapper.setAttribute("meta-"+i,t)}}else{this.$wrapper.classList.remove("meta-"+i);if(this.$wrapper.hasAttribute("meta-"+i)){this.$wrapper.removeAttribute("meta-"+i)}}}};l.prototype.moveToLocation=function(t){if(this.location===t){return k.resolved}var e=new k;var i,n,r,s,o,a,l,c,u,h,f,d,p;var m=10;r=this.location;n=r?this.gScene.gEntityLocations[r]:this.gScene.$gscene;o=this.$locationSlot||this.gScene.$gscene;this.location=t;i=t?this.gScene.gEntityLocations[t]:this.gScene.$gscene;if(!i){i=this.gScene.gEntityLocations[t]=document.createElement("div");i.classList.add("g-entity-location");i.classList.add("g-entity-location-"+t);this.gScene.$gscene.append(i)}var g=window.getComputedStyle(this.$wrapper);var y=window.getComputedStyle(i);var v=parseFloat(g.width);var b=parseFloat(g.height);if(i===this.gScene.$gscene){s=this.gScene.$gscene}else{s=this.$locationSlot=document.createElement("div");s.classList.add("g-entity-slot");s.style.order=this.order}c=[...Object.values(this.gScene.gEntities)].filter(e=>e!==this&&e.usage!=="marker"&&e.location&&(e.location===t||e.location===r));u=c.map(e=>e.$locationSlot.getBoundingClientRect());if(s!==this.gScene.$gscene){if(i.lastChild&&parseFloat(i.lastChild.style.order)>this.order){i.prepend(s)}else{i.append(s)}}p=o.getBoundingClientRect();if(o!==this.gScene.$gscene){o.remove()}h=c.map(e=>e.$locationSlot.getBoundingClientRect());c.forEach((e,t)=>{var i=u[t],n=h[t];var r=e.$wrapper.style.transition;var s=e.$wrapper.style.transform;var o=Object.assign({},e.localTransform);o.translateX+=i.left-n.left;o.translateY+=i.top-i.top;e.$wrapper.style.transition="none";e.$wrapper.style.transform=E.stringifyTransform(o);setTimeout(()=>{e.$wrapper.style.transition=r;e.$wrapper.style.transform=s},m)});var x={translateX:0,translateY:0};switch(y.flexDirection){case"row":case"row-reverse":f=parseFloat(y.height);x.scaleX=x.scaleY=f/b;break;case"column":case"column-reverse":f=parseFloat(y.width);x.scaleX=x.scaleY=f/v;break;default:f=parseFloat(y.height);x.scaleX=x.scaleY=f/b;console.warn("flex-direction",y.flexDirection)}x.translateX-=(v-v*x.scaleX)/2;x.translateY-=(b-b*x.scaleY)/2;var w=this.localTransform;this.localTransform=x;if(o===this.gScene.$gscene){this.$wrapper.style.transform=E.stringifyTransform(x);s.append(this.$wrapper);e.resolve();return e}var _=window.getComputedStyle(n);switch(_.flexDirection){case"column":case"column-reverse":l="column";break;default:l="row"}d=s.getBoundingClientRect();var S={translateX:p.left+w.translateX-d.left,translateY:p.top+w.translateY-d.top,scaleX:w.scaleX,scaleY:w.scaleY};this.$wrapper.style.transform=E.stringifyTransform(S);s.append(this.$wrapper);setTimeout(()=>{this.$wrapper.style.transform=E.stringifyTransform(x);e.resolve()},m);return e};l.prototype.updateVgObject=function(e){if(!(e instanceof f.VG)){e=f.objectToVG(e);if(!(e instanceof f.VG)){return}}this.special.vgObject=e;if(this.$image){this.$image.remove()}if(this.usage==="marker"){this.$image=e.renderDom({overrideTag:"g"})}else{this.$image=e.renderDom();this.$image.classList.add("svg");this.$image.classList.add("vg-object")}switch(this.usage){case"vg":this.onClick=e=>{e.stopPropagation()};this.$image.addEventListener("click",this.onClick);this.$image.classList.add("vg");this.setVgButtons(this.$image);this.setVgPassiveHints(this.$image);break;case"sprite":this.$image.classList.add("sprite");break;case"marker":this.$image.classList.add("marker");break}if(this.usage!=="marker"){this.$wrapper.append(this.$image)}return};l.prototype.updateVgMorph=function(e){var t=this.special.vgObject;if(!t){console.warn("Has no VG object, abort...");return}t.importMorphLog(e);t.morphDom();return};l.prototype.updateVgArea=function(i){var n;if(this.usage!=="vg"){return}if(!this.hasState("loaded")){this.once("loaded",this.updateVgArea.bind(this,i));return}if(!this.special.area){this.special.area={}}for(n in i){if(!this.special.area[n]){this.special.area[n]={}}if(!this.special.area[n].meta){this.special.area[n].meta={}}if(i[n].hint!==undefined){this.special.area[n].hint=i[n].hint||null}if(i[n].meta){Object.assign(this.special.area[n].meta,i[n].meta)}Array.from(this.$image.querySelectorAll("[area="+n+"]")).forEach(e=>{var t;if(i[n].hint!==undefined){if(i[n].hint){e.setAttribute("data-passive-hint",i[n].hint);e.classList.add("passive-hint")}else{e.removeAttribute("data-passive-hint");e.classList.remove("passive-hint")}}if(i[n].meta){for(t in i[n].meta){if(i[n].meta[t]){e.classList.add("meta-"+t)}else{e.classList.remove("meta-"+t)}}}})}};l.prototype.setVgButtons=function(e){Array.from(e.querySelectorAll("[button]")).forEach(e=>{var t=e.getAttribute("button");e.setAttribute("id","button-"+t);if(!e.getAttribute("area")){e.setAttribute("area",t)}e.classList.add("button");e.classList.add("disabled")})};l.prototype.setVgPassiveHints=function(e){Array.from(e.querySelectorAll("[hint]")).forEach(e=>{var t=e.getAttribute("hint");e.setAttribute("data-passive-hint",t);e.classList.add("passive-hint");e.addEventListener("mouseleave",e=>{this.dom.clearHint()});e.addEventListener("mouseenter",e=>{var t=e.currentTarget;var i=t.getAttribute("data-passive-hint");if(!i){return}this.dom.setHint(i,{passive:true})})})};l.prototype.updateMarkerLocation=function(e,t){var i,n,r,s,o,a,l,c,u,h;if(!this.hasState("loaded")){this.once("loaded",this.updateMarkerLocation.bind(this,e,t));return}if(!e){e=this.special.inVg}if(!t){t=this.location}if(!this.gScene.gEntities[e]){console.warn("Unknown VG id: ",e);return}i=this.gScene.gEntities[e];if(!i.usage==="vg"){console.warn("This gEntity is not a VG, id: ",e);return}if(!i.hasState("loaded")){i.once("loaded",this.updateMarkerLocation.bind(this,e,t));return}n=i.$image.querySelector("[area="+t+"]");if(!n){console.warn("VG "+e+": area not found",t);return}this.special.inVg=e;this.location=t;r=n.getBBox();u=r.x+r.width/2;h=r.y+r.height/2;s=f.getViewBox(this.$image);o=parseFloat(this.$image.getAttribute("width"))||s.width;a=parseFloat(this.$image.getAttribute("height"))||s.height;if(!isNaN(l=parseFloat(this.$image.getAttribute("originX")))){u-=(l-s.x)/s.width*o}if(!isNaN(c=parseFloat(this.$image.getAttribute("originY")))){h-=(c-s.y)/s.height*a}this.$image.style.transform="translate("+u+"px , "+h+"px )"+"scale("+o/s.width+" , "+a/s.height+")";if(this.$image.ownerSVGElement!==i.$image){i.$image.append(this.$image)}};l.prototype.update_serverside=function(e,t=false){var i;if(e.show!==undefined){this.show=!!e.show}if(e.persistent!==undefined){this.persistent=!!e.persistent}if(e.engine&&typeof e.engine==="object"){Object.assign(this.engine,e.engine)}return this};l.prototype.update_=async function(e,t,i=false){if(t.backUrl){await this.updateBackImage(t)}if(t.maskUrl){await this.updateMask(t)}if(t.content){this.updateContent(t)}if(t.pose!==undefined){this.updatePose(t)}if(t.style&&this.$wrapper){delete t.style.position;Object.assign(this.style,t.style);E.css(this.$wrapper,t.style)}if(t.imageStyle&&this.$image){delete t.imageStyle.position;Object.assign(this.imageStyle,t.imageStyle);E.css(this.$image,t.imageStyle)}if(t.backImageStyle&&this.$backImage){delete t.backImageStyle.position;Object.assign(this.backImageStyle,t.backImageStyle);E.css(this.$backImage,t.backImageStyle)}if(t.maskStyle&&this.$mask){delete t.maskStyle.position;Object.assign(this.maskStyle,t.maskStyle);E.css(this.$mask,t.maskStyle)}if(t.class){t.class=n.toClassObject(t.class);Object.assign(this.class,t.class);E.class(this.$wrapper||this.$image,t.class,"s-")}};l.prototype.updateBackImage=function(e){if(this.usage==="card"){this.$backImage.style.backgroundImage='url("'+this.dom.cleanUrl(e.backUrl)+'")'}return k.resolved};l.prototype.updateMask=function(e){var t=new k;if(e.maskUrl.endsWith(".svg")&&this.usage==="sprite"){console.warn("has mask!");if(this.$mask){this.$mask.remove()}this.$mask=document.createElementNS("http://www.w3.org/2000/svg","svg");this.$mask.classList.add("sprite-mask");f.load(this.dom.cleanUrl(e.maskUrl),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,as:this.$mask}).then(()=>t.resolve());this.$wrapper.append(this.$mask);this.$wrapper.classList.add("has-mask")}else if(this.$mask){this.$mask.remove();this.$wrapper.classList.remove("has-mask");t.resolve()}return t};l.prototype.updateContent=function(t){var i,n;if(this.usage!=="card"){return}for(let e in t.content){i=t.content[e];n=this.contents[e];if(!n){n=this.contents[e]=document.createElement("div");n.classList.add("content-"+e);this.$front.append(n)}n.textContent=i;n.setAttribute("content",i)}};l.prototype.updatePose=function(e){if(typeof e.pose==="string"){this.$wrapper.setAttribute("pose",e.pose);this.pose=e.pose}else{this.$wrapper.removeAttribute("pose");this.pose=null}};l.prototype.createGEntityLocation=function(e){var t;if(this.gScene.gEntityLocations[e]){return}t=this.gScene.gEntityLocations[e]=document.createElement("div");t.classList.add("g-entity-location");t.classList.add("g-entity-location-"+e);this.gScene.$gscene.append(t)};l.prototype.createCardMarkup=function(e){e.$card=document.createElement("div");e.$card.classList.add("card");e.$wrapper.append(e.$card);e.$front=document.createElement("div");e.$front.classList.add("front");e.$card.append(e.$front);e.$image=document.createElement("div");e.$image.classList.add("card-image");e.$front.append(e.$image);e.$back=document.createElement("div");e.$back.classList.add("back");e.$card.append(e.$back);e.$backImage=document.createElement("div");e.$backImage.classList.add("card-image");e.$back.append(e.$backImage)}},{"./GTransition.js":6,"./commonUtils.js":9,"./positionModes.js":20,"./sizeModes.js":21,"dom-kit":24,"nextgen-events/lib/browser.js":35,seventh:50,"svg-kit":69}],5:[function(e,t,i){"use strict";const n=e("./Camera.js");const r=e("nextgen-events/lib/browser.js");const s=e("seventh");function o(e,t){this.dom=e;this.engineId=t.engineId;this.rightHanded=t.rightHanded!==undefined?!!t.rightHanded:true;this.active=false;this.paused=false;this.persistent=false;this.theme="default";this.special={};this.engine={};this.texturePacks={};this.gEntities={};this.gEntityLocations={};this.globalCamera=new n(this);this.roleCamera=null;this.$gscene=document.createElement("gscene");this.$gscene.classList.add("gscene");this.$gscene.style.visibility="hidden";this.dom.$gfx.append(this.$gscene)}o.prototype=Object.create(r.prototype);o.prototype.constructor=o;t.exports=o;o.prototype.update=function(t,e=false,i=false){var n=s.resolved;if(t.active!==undefined){this.active=!!t.active;this.$gscene.style.visibility=this.active?"visible":"hidden"}if(t.paused!==undefined){this.paused=!!t.paused}if(t.persistent!==undefined){this.persistent=!!t.persistent}if(t.theme!==undefined){this.theme=t.theme||"default"}if(t.special&&typeof t.special==="object"){for(let e in t.special){if(this.special[e]&&typeof this.special[e]==="object"){Object.assign(this.special[e],t.special[e])}else{this.special[e]=t.special[e]}}}if(t.engine&&typeof t.engine==="object"){Object.assign(this.engine,t.engine)}if(t.globalCamera!==undefined){this.globalCamera.update(t.globalCamera)}return e?n:s.resolved};o.prototype.hasGEntity=function(e){return e in this.gEntities};o.prototype.getGEntity=function(e){return this.gEntities[e]};o.prototype.registerGEntity=function(e,t){if(this.gEntities[e]){throw new Error("Entity '"+e+"' already exists for this gScene")}this.gEntities[e]=t};o.prototype.unregisterGEntity=function(e){delete this.gEntities[e]};o.prototype.removeGEntity=function(e){var t=this.gEntities[e];if(!t){return false}t.destroy();return true}},{"./Camera.js":1,"nextgen-events/lib/browser.js":35,seventh:50}],6:[function(e,t,i){"use strict";function n(e){this.duration=.2;this.easing="linear";if(e){this.update(e)}}t.exports=n;n.prototype.update=function(e){if(!e||typeof e!=="object"){return}if(e.duration!==undefined){this.duration=+e.duration||0}if(e.easing!==undefined){this.easing=e.easing||"linear"}return this};n.prototype.toString=function(e){return e+" "+this.duration+"s"+(" "+this.easing||"")}},{}],7:[function(e,t,i){"use strict";function n(t){this.theme=t.theme||"default";this.id=t.id;this.engine={};if(t.engine&&typeof t.engine==="object"){Object.assign(this.engine,t.engine)}this.usage=t.usage||"default";this.pixelDensity=t.pixelDensity;this.variants={};for(let e in t.variants){this.variants[e]=new r(t.variants[e])}}t.exports=n;function r(e={}){this.animation=e.animation||null;this.engine=e.engine||null;this.frames=e.frames.map(e=>new s(e))}n.Variant=r;function s(e={}){this.url=e.url;this.maps=e.maps||null;this.maskUrl=e.maskUrl||null;this.origin=e.origin||null;this.duration=+e.duration||250;this.xFlip=!!e.xFlip;this.yFlip=!!e.yFlip;this.origin=e.origin;this.zOffset=e.zOffset;this.relSize=e.relSize;this.engine=e.engine||null}n.Frame=s},{}],8:[function(e,t,i){"use strict";const n=e("nextgen-events/lib/browser.js");const r=e("./EventDispatcher.js");const s=e("dom-kit");const o=e("url");function a(e){this.domain=e.domain||"localhost";this.port=e.port||80;this.path=e.path||"/";this.token=e.token||"";this.userName=e.name||"unknown_"+Math.floor(Math.random()*1e4);this.ws=null;this.proxy=null}t.exports=a;a.prototype=Object.create(n.prototype);a.prototype.constructor=a;a.autoCreate=function(){var e={port:window.location.port,domain:window.location.hostname,path:window.location.pathname};Object.assign(e,o.parse(window.location.href,true).query);window.spellcastClient=new a(e);return window.spellcastClient};a.prototype.run=function(e){var t=false;this.proxy=new n.Proxy;this.proxy.addRemoteService("bus");new r(this.proxy.remoteServices.bus,this);var i="ws://"+this.domain+(this.port?":"+this.port:"")+this.path+(this.token||"");console.log("Websocket URL:",i);this.ws=new WebSocket(i);this.emit("connecting");this.ws.onerror=()=>{if(!t){console.log("Can't open Websocket (error)...");this.emit("error","unreachable");return}};this.ws.onopen=()=>{t=true;console.log("Websocket opened!");this.emit("open");this.proxy.remoteServices.bus.emit("authenticate",{name:this.userName});if(typeof e==="function"){e()}};this.ws.onclose=()=>{if(!t){console.log("Can't open Websocket (close)...");this.emit("error","unreachable");return}t=false;this.proxy.destroy();console.log("Websocket closed!");this.emit("close")};this.ws.onmessage=e=>{var t;try{t=JSON.parse(e.data)}catch(e){return}console.log("Message received: ",t);this.proxy.receive(t)};this.proxy.send=e=>{this.ws.send(JSON.stringify(e))}};a.autoCreate();s.ready(()=>{window.spellcastClient.run();document.body.onkeypress=e=>{if(e.keyCode!==120){return}var t,i=document.querySelectorAll("link[rel=stylesheet]");for(var n=0;n<i.length;n++){t=i[n].getAttribute("href").split("?")[0]+"?"+Math.random();i[n].setAttribute("href",t)}}})},{"./EventDispatcher.js":3,"dom-kit":24,"nextgen-events/lib/browser.js":35,url:75}],9:[function(e,t,i){"use strict";i.toClassObject=function e(t){var i={};if(!t){return i}if(typeof t==="string"){i[t]=true;return i}if(typeof t==="object"){if(Array.isArray(t)){t.forEach(e=>i[e]=true);return i}return t}return i}},{}],10:[function(e,t,i){"use strict";const n=e("nextgen-events/lib/LeanEvents.js");function r(){this.keyPressedList=[];this.keyReleasedList=[];this.gaugeList=[];this.gauge2dList=[];this.keyBindings={};this.gaugeBindings={};this.gauge2dBindings={};this.init()}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.init=function(){this.addKeyBinding("KB_SPACE","confirm");this.addKeyBinding("KB_RETURN","confirm");this.addKeyBinding("GP1_BOTTOM_BUTTON","confirm");this.addKeyBinding("GP1_RIGHT_SPECIAL_BUTTON","confirm");this.addKeyBinding("GP1_DPAD_UP","up");this.addKeyBinding("KB_UP","up");this.addKeyBinding("KB_Z","up");this.addKeyBinding("GP1_DPAD_DOWN","down");this.addKeyBinding("KB_DOWN","down");this.addKeyBinding("KB_S","down");this.addKeyBinding("GP1_DPAD_LEFT","left");this.addKeyBinding("KB_LEFT","left");this.addKeyBinding("KB_Q","left");this.addKeyBinding("GP1_DPAD_RIGHT","right");this.addKeyBinding("KB_RIGHT","right");this.addKeyBinding("KB_D","right");this.on("key",e=>{console.warn("Key:",e)});this.on("gauge",(e,t)=>{console.warn("Gauge:",e,t)});this.on("gauge2d",(e,t,i)=>{console.warn("Gauge 2d:",e,t,i)});this.on("command",e=>{console.warn("Command:",e)})};r.prototype.addKeyBinding=function(e,t){if(!this.keyBindings[e]){this.keyBindings[e]=[t]}else if(!this.keyBindings[e].includes(t)){this.keyBindings[e].push("command")}};r.prototype.addKeyPressed=function(e,t){if(e.prefix){t=e.prefix+t}this.keyPressedList.push([t,e])};r.prototype.addKeyReleased=function(e,t){if(e.prefix){t=e.prefix+t}this.keyReleasedList.push([t+":RELEASED",e])};r.prototype.addGauge=function(e,t,i){if(e.prefix){t=e.prefix+t}this.gaugeList.push([t,i,e])};r.prototype.addGauge2d=function(e,t,i,n){if(e.prefix){t=e.prefix+t}this.gauge2dList.push([t,i,n,e])};r.prototype.addKeyAndGauge=function(e,t,i,n){if(!i){this.addKeyReleased(e,t)}else if(!n){this.addKeyPressed(e,t)}this.addGauge(e,t,i)};r.prototype.flushEvents=function(){var e,t,i,n;for([t,i]of this.keyReleasedList){this.emit("key",t,i);if(this.keyBindings[t]){for(n of this.keyBindings[t]){this.emit("command",n)}}}for([t,i]of this.keyPressedList){this.emit("key",t,i);if(this.keyBindings[t]){for(n of this.keyBindings[t]){this.emit("command",n)}}}for(e of this.gaugeList){this.emit("gauge",...e)}for(e of this.gauge2dList){this.emit("gauge2d",...e)}this.keyPressedList.length=this.keyReleasedList.length=this.gaugeList.length=this.gauge2dList.length=0}},{"nextgen-events/lib/LeanEvents.js":32}],11:[function(e,t,i){"use strict";const n=e("./Gamepad.js");function r(e,t){n.call(this,e,t.index,t.id);this.domGamepad=t;this.lastDomGamepadTimestamp=0;this.pollingTimer=null;this.doPolling=this.doPolling.bind(this);this.initMapping();console.warn("New Gamepad #%d: %s (%d buttons, %d axes)",this.domGamepad.index,this.domGamepad.id,this.domGamepad.buttons.length,this.domGamepad.axes.length,this)}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.destroy=function(){console.warn("Gamepad #%d destroyed: %s",this.domGamepad.index,this.domGamepad.id);if(this.pollingTimer){this.pollingTimer=null;cancelAnimationFrame(this.pollingTimer)}};r.prototype.startPolling=function(){this.doPolling()};r.prototype.doPolling=function(){if(this.pollingTimer){this.pollingTimer=null;cancelAnimationFrame(this.pollingTimer)}if(this.lastDomGamepadTimestamp<this.domGamepad.timestamp){var e=this.lastState;this.lastState=this.state;this.state=e;this.map();this.lastDomGamepadTimestamp=this.domGamepad.timestamp;this.postProcess()}this.pollingTimer=requestAnimationFrame(this.doPolling)};r.prototype.initMapping=function(){if(this.domGamepad.mapping){console.warn("The browser supports the Gamepad '%d' with this mapping: %s:",this.domGamepad.id,this.domGamepad.mapping);return}if(s[this.domGamepad.id]){console.warn("Found driver for Gamepad:",this.domGamepad.id);this.map=s[this.domGamepad.id]}else{console.warn("Driver NOT FOUND for Gamepad ID:",this.domGamepad.id)}};r.prototype.map=function(){var e=this.state;e.button.bottom=this.domGamepad.buttons[0]?.value||0;e.button.right=this.domGamepad.buttons[1]?.value||0;e.button.left=this.domGamepad.buttons[2]?.value||0;e.button.top=this.domGamepad.buttons[3]?.value||0;e.shoulderButton.left=this.domGamepad.buttons[4]?.value||0;e.shoulderButton.right=this.domGamepad.buttons[5]?.value||0;e.shoulderButton.leftTrigger=this.domGamepad.buttons[6]?.value||0;e.shoulderButton.rightTrigger=this.domGamepad.buttons[7]?.value||0;e.specialButton.left=this.domGamepad.buttons[8]?.value||0;e.specialButton.right=this.domGamepad.buttons[9]?.value||0;e.specialButton.leftStick=this.domGamepad.buttons[10]?.value||0;e.specialButton.rightStick=this.domGamepad.buttons[11]?.value||0;e.dPad.top=this.domGamepad.buttons[12]?.value||0;e.dPad.bottom=this.domGamepad.buttons[13]?.value||0;e.dPad.left=this.domGamepad.buttons[14]?.value||0;e.dPad.right=this.domGamepad.buttons[15]?.value||0;e.specialButton.center=this.domGamepad.buttons[16]?.value||0;e.leftStick.x=this.domGamepad.axes[0]||0;e.leftStick.y=this.domGamepad.axes[1]||0;e.rightStick.x=this.domGamepad.axes[2]||0;e.rightStick.y=this.domGamepad.axes[3]||0};const s={};s["046d-c21d-Logitech Gamepad F310"]=function(){var e=this.state;e.button.bottom=this.domGamepad.buttons[0].value;e.button.right=this.domGamepad.buttons[1].value;e.button.left=this.domGamepad.buttons[2].value;e.button.top=this.domGamepad.buttons[3].value;e.shoulderButton.left=this.domGamepad.buttons[4].value;e.shoulderButton.right=this.domGamepad.buttons[5].value;e.specialButton.left=this.domGamepad.buttons[6].value;e.specialButton.right=this.domGamepad.buttons[7].value;e.specialButton.center=this.domGamepad.buttons[8].value;e.specialButton.leftStick=this.domGamepad.buttons[9].value;e.specialButton.rightStick=this.domGamepad.buttons[10].value;e.leftStick.x=this.domGamepad.axes[0];e.leftStick.y=this.domGamepad.axes[1];e.shoulderButton.leftTrigger=this.domGamepad.axes[2]*.5+.5;e.rightStick.x=this.domGamepad.axes[3];e.rightStick.y=this.domGamepad.axes[4];e.shoulderButton.rightTrigger=this.domGamepad.axes[5]*.5+.5;e.dPad.left=+(this.domGamepad.axes[6]<0);e.dPad.right=+(this.domGamepad.axes[6]>0);e.dPad.up=+(this.domGamepad.axes[7]<0);e.dPad.down=+(this.domGamepad.axes[7]>0)}},{"./Gamepad.js":13}],12:[function(e,t,i){"use strict";const n=e("./GamepadHub.js");const r=e("./BrowserGamepad.js");function s(e){n.call(this,e);this.init()}t.exports=s;s.prototype=Object.create(n.prototype);s.prototype.constructor=s;s.prototype.init=function(){navigator.getGamepads().forEach((e,t)=>{if(!e){return}console.warn("Gamepad #%d pre-connected: %s",e.index,e.id);this.addGamepad(new r(this,e))});window.addEventListener("gamepadconnected",e=>{console.warn("Gamepad #%d connected: %s",e.gamepad.index,e.gamepad.id);this.addGamepad(new r(this,e.gamepad))});window.addEventListener("gamepaddisconnected",e=>{console.warn("Gamepad #%d disconnected: %s",e.gamepad.index,e.gamepad.id);this.removeGamepadByIndex(e.gamepad.index)})}},{"./BrowserGamepad.js":11,"./GamepadHub.js":14}],13:[function(e,t,i){"use strict";const n=e("./GamepadState.js");const r=e("nextgen-events/lib/LeanEvents.js");function s(e,t,i){this.gamepadHub=e;this.index=t;this.prefix="GP"+(t+1)+"_";this.id=i;this.isPolling=false;this.state=new n;this.lastState=new n;this.dispatchEmit=this.dispatchEmit.bind(this)}t.exports=s;s.prototype=Object.create(r.prototype);s.prototype.constructor=s;s.prototype.destroy=function(){};s.prototype.poll=function(e=true){e=!!e;if(this.isPolling===e){return}if(e){this.startPolling()}else{this.stopPolling()}};s.prototype.postProcess=function(){this.state.emitFromDiff(this.gamepadHub.controller,this.lastState,this)};s.prototype.dispatchEmit=function(e,t,i,n){this.gamepadHub.controller.emit(e,this.prefix+t,this,t,i,n)}},{"./GamepadState.js":15,"nextgen-events/lib/LeanEvents.js":32}],14:[function(e,t,i){"use strict";const n=e("nextgen-events/lib/LeanEvents.js");function r(e){this.gamepads=[];this.controller=e}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.addGamepad=function(e){if(this.gamepads[e.index]){this.gamepads[e.index].destroy()}this.gamepads[e.index]=e;this.emit("newGamepad",e)};r.prototype.removeGamepad=function(e){this.removeGamepadByIndex(e.index)};r.prototype.removeGamepadByIndex=function(t){if(this.gamepads[t]){let e=this.gamepads[t];e.destroy();delete this.gamepads[t];this.emit("removedGamepad",e)}}},{"nextgen-events/lib/LeanEvents.js":32}],15:[function(e,t,i){"use strict";function n(){this.dPad={up:0,down:0,left:0,right:0};this.leftStick={x:0,y:0};this.rightStick={x:0,y:0};this.button={top:0,bottom:0,left:0,right:0};this.shoulderButton={left:0,right:0,leftTrigger:0,rightTrigger:0};this.specialButton={left:0,right:0,center:0,leftStick:0,rightStick:0}}t.exports=n;n.prototype.emitFromDiff=function(e,t,i){if(this.dPad.up!==t.dPad.up){e.addKeyAndGauge(i,"DPAD_UP",this.dPad.up,t.dPad.up)}if(this.dPad.down!==t.dPad.down){e.addKeyAndGauge(i,"DPAD_DOWN",this.dPad.down,t.dPad.down)}if(this.dPad.left!==t.dPad.left){e.addKeyAndGauge(i,"DPAD_LEFT",this.dPad.left,t.dPad.left)}if(this.dPad.right!==t.dPad.right){e.addKeyAndGauge(i,"DPAD_RIGHT",this.dPad.right,t.dPad.right)}if(this.leftStick.x!==t.leftStick.x||this.leftStick.y!==t.leftStick.y){e.addGauge2d(i,"LEFT_STICK",this.leftStick.x,this.leftStick.y)}if(this.rightStick.x!==t.rightStick.x||this.rightStick.y!==t.rightStick.y){e.addGauge2d(i,"RIGHT_STICK",this.rightStick.x,this.rightStick.y)}if(this.button.top!==t.button.top){e.addKeyAndGauge(i,"TOP_BUTTON",this.button.top,t.button.top)}if(this.button.bottom!==t.button.bottom){e.addKeyAndGauge(i,"BOTTOM_BUTTON",this.button.bottom,t.button.bottom)}if(this.button.left!==t.button.left){e.addKeyAndGauge(i,"LEFT_BUTTON",this.button.left,t.button.left)}if(this.button.right!==t.button.right){e.addKeyAndGauge(i,"RIGHT_BUTTON",this.button.right,t.button.right)}if(this.shoulderButton.left!==t.shoulderButton.left){e.addKeyAndGauge(i,"LEFT_SHOULDER",this.shoulderButton.left,t.shoulderButton.left)}if(this.shoulderButton.right!==t.shoulderButton.right){e.addKeyAndGauge(i,"RIGHT_SHOULDER",this.shoulderButton.right,t.shoulderButton.right)}if(this.shoulderButton.leftTrigger!==t.shoulderButton.leftTrigger){e.addKeyAndGauge(i,"LEFT_TRIGGER",this.shoulderButton.leftTrigger,t.shoulderButton.leftTrigger)}if(this.shoulderButton.rightTrigger!==t.shoulderButton.rightTrigger){e.addKeyAndGauge(i,"RIGHT_TRIGGER",this.shoulderButton.rightTrigger,t.shoulderButton.rightTrigger)}if(this.specialButton.left!==t.specialButton.left){e.addKeyAndGauge(i,"LEFT_SPECIAL_BUTTON",this.specialButton.left,t.specialButton.left)}if(this.specialButton.right!==t.specialButton.right){e.addKeyAndGauge(i,"RIGHT_SPECIAL_BUTTON",this.specialButton.right,t.specialButton.right)}if(this.specialButton.center!==t.specialButton.center){e.addKeyAndGauge(i,"CENTER_SPECIAL_BUTTON",this.specialButton.center,t.specialButton.center)}if(this.specialButton.leftStick!==t.specialButton.leftStick){e.addKeyAndGauge(i,"LEFT_STICK_BUTTON",this.specialButton.leftStick,t.specialButton.leftStick)}if(this.specialButton.rightStick!==t.specialButton.rightStick){e.addKeyAndGauge(i,"RIGHT_STICK_BUTTON",this.specialButton.rightStick,t.specialButton.rightStick)}e.flushEvents()}},{}],16:[function(e,t,i){"use strict";const n=e("./Keyboard.js");function r(e){n.call(this,e);this.codeToKey={};this.initEvents()}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.initEvents=function(){document.addEventListener("keydown",e=>{switch(e.key){case"'":case"/":case"x":case"Tab":case"Alt":e.preventDefault();break}console.warn("keydown event",e.key,e.code,e.location,e);var t=this.codeToKey[e.code];if(!t){t=this.getKey(e)}if(this.state[t]){return}this.state[t]=true;this.controller.addKeyPressed(this,t);this.controller.flushEvents()});document.addEventListener("keyup",e=>{var t=this.codeToKey[e.code];if(!t){t=this.getKey(e)}if(!this.state[t]){return}this.state[t]=false;this.controller.addKeyReleased(this,t);this.controller.flushEvents()})};const s={",":"COMMA",";":"SEMICOLON",":":"COLON","!":"EXCLAMATION","Ù":"PERCENT","*":"MULTIPLY","^":"CARET",$:"DOLLAR","<":"LESSER_THAN",")":"LEFT_PARENTHESIS"};for(let t=65;t<=90;t++){let e=String.fromCharCode(t);s[e]=e}r.prototype.getKey=function(e){var t,i,n;if(!e.metaKey&&!e.shiftKey&&!e.ctrlKey&&!e.altKey){i=e.key.toUpperCase();n=s[i];if(n){t=this.codeToKey[e.code]=n}else{t=this.codeToKey[e.code]=this.getKeyByCode(e.code)}}else{t=this.getKeyByCode(e.code)}return t};const o={ArrowUp:"UP",ArrowDown:"DOWN",ArrowLeft:"LEFT",ArrowRight:"RIGHT",PageUp:"PAGE_UP",PageDown:"PAGE_DOWN",AltLeft:"ALT",AltRight:"ALT_GR",ShiftLeft:"LEFT_SHIFT",ShiftRight:"RIGHT_SHIFT",ControlLeft:"LEFT_CONTROL",ControlRight:"RIGHT_CONTROL"};const a=["","LEFT_","RIGHT_","KP_"];r.prototype.getKeyByCode=function(e){var t;if(t=o[e]){return t}else if(e.startsWith("Key")){t=e.slice(3)}else if(e.startsWith("Digit")){t=e.slice(5)}else{t=e.toUpperCase()}return t}},{"./Keyboard.js":17}],17:[function(e,t,i){"use strict";const n=e("nextgen-events/lib/LeanEvents.js");function r(e){this.controller=e;this.prefix="KB_";this.state={}}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r},{"nextgen-events/lib/LeanEvents.js":32}],18:[function(e,t,i){"use strict";i.lib={};i.get=e=>i.lib[e];i.add=(e,t)=>{if(!e||typeof e!=="string"){throw new Error("Can't add an engine: the 'name' argument must be a string.")}if(!t||typeof t!=="object"){throw new Error("Can't add engine '"+e+"': the 'engine' argument must be an object.")}if(i.lib[e]){throw new Error("Can't add an engine: '"+e+"' already exists.")}console.warn("Add new engine:",e,t);i.lib[e]=t}},{}],19:[function(e,t,i){"use strict";const n=e("exm/lib/BrowserExm.js");const r=e("./Dom.js");const s=e("./engineLib.js");t.exports=n.registerNs({ns:"spellcast.web-client",extensionPath:"/ext",exports:{EventDispatcher:e("./EventDispatcher.js"),Dom:r,toolkit:e("./toolkit.js"),Camera:e("./Camera.js"),GEntity:e("./GEntity.js"),GScene:e("./GScene.js"),GTransition:e("./GTransition.js"),TexturePack:e("./TexturePack.js"),op:e("kung-fig-expression/lib/fnOperators.js"),xop:e("spellcast-shared/lib/operators.js")},api:{getEngine:s.get,addEngine:s.add,cleanUrl:r.cleanUrl}})},{"./Camera.js":1,"./Dom.js":2,"./EventDispatcher.js":3,"./GEntity.js":4,"./GScene.js":5,"./GTransition.js":6,"./TexturePack.js":7,"./engineLib.js":18,"./toolkit.js":22,"exm/lib/BrowserExm.js":25,"kung-fig-expression/lib/fnOperators.js":29,"spellcast-shared/lib/operators.js":52}],20:[function(e,t,i){"use strict";i.default=i.area=i.contain=(e,t,i,n,r,s)=>{var o,a,l,c,u;l=i-e.scaleX*r;c=n-e.scaleY*s;u=Math.max(i,n);o=-.5*r*(1-e.scaleX);a=-.5*s*(1-e.scaleY);console.log("dbg:",{xMinOffset:o,xFactor:l,yFactor:c});e.translateX=o+(.5+t.x/2)*l;e.translateY=a+(.5-t.y/2)*c;e.translateZ=t.z*u};i.origin=(e,t,i,n,r,s)=>{var o,a,l,c,u;l=i;c=n;u=Math.max(i,n);o=-.5*r;a=-.5*s;console.log("dbg:",{xMinOffset:o,xFactor:l,yFactor:c});e.translateX=o+(.5+t.x/2)*l;e.translateY=a+(.5-t.y/2)*c;e.translateZ=t.z*u};i.areaInSpriteOut=(e,t,i,n,r,s)=>{var o,a,l,c,u;l=i-e.scaleX*r;c=n-e.scaleY*s;u=Math.max(i,n);o=-.5*r*(1-e.scaleX);a=-.5*s*(1-e.scaleY);console.log("dbg:",{xMinOffset:o,xFactor:l,yFactor:c});if(t.x<-1){e.translateX=o+(t.x+1)*r*e.scaleX}else if(t.x>1){e.translateX=o+l+(t.x-1)*r*e.scaleX}else{e.translateX=o+(.5+t.x/2)*l}if(t.y<-1){e.translateY=a+c-(t.y+1)*s*e.scaleY}else if(t.y>1){e.translateY=a-(t.y-1)*s*e.scaleY}else{e.translateY=a+(.5-t.y/2)*c}e.translateZ=t.z*u}},{}],21:[function(e,t,i){"use strict";i.default=i.contain=(e,t,i,n,r,s)=>{if(r/i>s/n){e.scaleX=t.x*i/r;e.scaleY=t.y*i/r}else{e.scaleX=t.x*n/s;e.scaleY=t.y*n/s}};i.cover=(e,t,i,n,r,s)=>{if(r/i>s/n){e.scaleX=t.x*n/s;e.scaleY=t.y*n/s}else{e.scaleX=t.x*i/r;e.scaleY=t.y*i/r}};i.relativeWidth=i.areaWidth=(e,t,i,n,r,s)=>{e.scaleX=t.x*i/r;e.scaleY=t.y*i/r};i.relativeHeight=i.areaHeight=(e,t,i,n,r,s)=>{e.scaleX=t.x*n/s;e.scaleY=t.y*n/s};i.relative=i.area=(e,t,i,n,r,s)=>{e.scaleX=t.x*i/r;e.scaleY=t.y*n/s};i.relativeMax=i.areaMax=(e,t,i,n,r,s)=>{var o=Math.max(i,n);e.scaleX=t.x*o/r;e.scaleY=t.y*o/s};i.relativeMin=i.areaMin=(e,t,i,n,r,s)=>{var o=Math.min(i,n);e.scaleX=t.x*o/r;e.scaleY=t.y*o/s}},{}],22:[function(e,t,i){"use strict";const n={};t.exports=n;const r=e("string-kit/lib/format.js");const s=r.markupMethod;const o=e("string-kit/lib/escape.js").html;const a={endingMarkupReset:true,markupReset:e=>{var t="</span>".repeat(e.length);e.length=0;return t},markup:{":":e=>{var t="</span>".repeat(e.length);e.length=0;return t}," ":e=>{var t="</span>".repeat(e.length);e.length=0;return t+" "},"-":'<span class="dim">',"+":'<span class="bold">',_:'<span class="underline">',"/":'<span class="italic">',"!":'<span class="inverse">',b:'<span class="blue">',B:'<span class="bright blue">',c:'<span class="cyan">',C:'<span class="bright cyan">',g:'<span class="green">',G:'<span class="bright green">',k:'<span class="black">',K:'<span class="grey">',m:'<span class="magenta">',M:'<span class="bright magenta">',r:'<span class="red">',R:'<span class="bright red">',w:'<span class="white">',W:'<span class="bright white">',y:'<span class="yellow">',Y:'<span class="bright yellow">'}};const l={defaultColor:["color","default"],black:["color","black"],red:["color","red"],green:["color","green"],yellow:["color","yellow"],blue:["color","blue"],magenta:["color","magenta"],cyan:["color","cyan"],white:["color","white"],grey:["color","grey"],gray:["color","gray"],brightBlack:["color","brightBlack"],brightRed:["color","brightRed"],brightGreen:["color","brightGreen"],brightYellow:["color","brightYellow"],brightBlue:["color","brightBlue"],brightMagenta:["color","brightMagenta"],brightCyan:["color","brightCyan"],brightWhite:["color","brightWhite"],defaultBgColor:["bgColor","default"],bgBlack:["bgColor","black"],bgRed:["bgColor","red"],bgGreen:["bgColor","green"],bgYellow:["bgColor","yellow"],bgBlue:["bgColor","blue"],bgMagenta:["bgColor","magenta"],bgCyan:["bgColor","cyan"],bgWhite:["bgColor","white"],bgGrey:["bgColor","grey"],bgGray:["bgColor","gray"],bgBrightBlack:["bgColor","brightBlack"],bgBrightRed:["bgColor","brightRed"],bgBrightGreen:["bgColor","brightGreen"],bgBrightYellow:["bgColor","brightYellow"],bgBrightBlue:["bgColor","brightBlue"],bgBrightMagenta:["bgColor","brightMagenta"],bgBrightCyan:["bgColor","brightCyan"],bgBrightWhite:["bgColor","brightWhite"],dim:["dim",true],bold:["bold",true],underline:["underline",true],italic:["italic",true],inverse:["inverse",true],strike:["strike",true]};const c={parse:true,markupReset:e=>{e.length=0},markup:{":":null," ":e=>{e.length=0;return[null," "]},"-":{dim:true},"+":{bold:true},_:{underline:true},"/":{italic:true},"!":{inverse:true},"~":{strike:true},b:{color:"blue"},B:{color:"brightBlue"},c:{color:"cyan"},C:{color:"brightCyan"},g:{color:"green"},G:{color:"brightGreen"},k:{color:"black"},K:{color:"grey"},m:{color:"magenta"},M:{color:"brightMagenta"},r:{color:"red"},R:{color:"brightRed"},w:{color:"white"},W:{color:"brightWhite"},y:{color:"yellow"},Y:{color:"brightYellow"}},shiftedMarkup:{background:{":":null," ":e=>{e.length=0;return[null," "]},b:{bgColor:"blue"},B:{bgColor:"brightBlue"},c:{bgColor:"cyan"},C:{bgColor:"brightCyan"},g:{bgColor:"green"},G:{bgColor:"brightGreen"},k:{bgColor:"black"},K:{bgColor:"grey"},m:{bgColor:"magenta"},M:{bgColor:"brightMagenta"},r:{bgColor:"red"},R:{bgColor:"brightRed"},w:{bgColor:"white"},W:{bgColor:"brightWhite"},y:{bgColor:"yellow"},Y:{bgColor:"brightYellow"}}},dataMarkup:{color:"color",fgColor:"color",fg:"color",c:"color",bgColor:"bgColor",bg:"bgColor",fx:"fx"},markupCatchAll:(e,t,i)=>{var n={};if(i===undefined){if(t[0]==="#"){n.color=t}else if(l[t]){n[l[t][0]]=l[t][1]}else{n.color=t}}e.push(n);return n||{}}};n.markup=(...e)=>{e[0]=o(e[0]).replace(/\n/,"<br />");return s.apply(a,e)};n.parseMarkup=(...e)=>{return s.apply(c,e)};n.stripMarkup=r.stripMarkup;n.hexToRgba=e=>{if(e[0]==="#"){e=e.slice(1)}if(e.length===3){e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}return{r:parseInt(e.slice(0,2),16)||0,g:parseInt(e.slice(2,4),16)||0,b:parseInt(e.slice(4,6),16)||0,a:e.length>6?parseInt(e.slice(6,8),16)||0:255}};n.hexToRgb=e=>{if(e[0]==="#"){e=e.slice(1)}if(e.length===3){e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}return{r:parseInt(e.slice(0,2),16)||0,g:parseInt(e.slice(2,4),16)||0,b:parseInt(e.slice(4,6),16)||0}};function u(e){if(!e||e<0){return"00"}if(e<16){return"0"+e.toString(16)}return e.toString(16)}n.rgbToHex=n.rgbaToHex=(e,t,i,n=null)=>{if(e&&typeof e==="object"){return typeof e.a!=="number"?"#"+u(e.r)+u(e.g)+u(e.b):"#"+u(e.r)+u(e.g)+u(e.b)+u(e.a)}return n===null?"#"+u(e)+u(t)+u(i):"#"+u(e)+u(t)+u(i)+u(n)}},{"string-kit/lib/escape.js":55,"string-kit/lib/format.js":56}],23:[function(e,t,i){},{}],24:[function(r,o,e){(function(n){(function(){"use strict";var t,i;if(n.browser){t=new DOMParser;i=new XMLSerializer}else{var e=r("@cronvel/xmldom");t=new e.DOMParser;i=new e.XMLSerializer}const a={};o.exports=a;a.ready=t=>{document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,false);t()},false)};a.fromXml=e=>t.parseFromString(e,"application/xml");a.toXml=e=>i.serializeToString(e);a.fromHtml=e=>{var t,i,n;n=document.createDocumentFragment();i=document.createElement("div");i.insertAdjacentHTML("beforeend",e);for(t=0;t<i.children.length;t++){n.appendChild(i.children[t])}return n};a.addJsScript=(n,r=document.body)=>{return new Promise((e,t)=>{var i=document.createElement("script");i.src=n;i.async=true;i.onload=e;i.onerror=t;r.appendChild(i)})};a.batch=(e,t,...i)=>{var n;if(t instanceof Element){e(t,...i)}else if(Array.isArray(t)){for(n=0;n<t.length;n++){e(t[n],...i)}}else if(t instanceof NodeList||t instanceof NamedNodeMap){for(n=0;n<t.length;n++){e(t[n],...i)}}};a.css=(e,t)=>{var i;for(i in t){e.style[i]=t[i]}};a.attr=(e,t,i)=>{var n;i=i||"";for(n in t){if(t[n]===null){e.removeAttribute(i+n)}else{e.setAttribute(i+n,t[n])}}};a.class=(e,t,i)=>{var n;i=i||"";for(n in t){if(t[n]){e.classList.add(i+n)}else{e.classList.remove(i+n)}}};a.remove=e=>e.parentNode.removeChild(e);a.empty=e=>{while(e.firstChild){e.removeChild(e.firstChild)}};a.cloneInto=(e,t)=>{a.empty(t);t.appendChild(e.cloneNode(true))};a.insertInto=(e,t)=>{a.empty(t);t.appendChild(e)};a.moveChildrenInto=(e,t)=>{a.empty(t);while(e.firstChild){t.appendChild(e.firstChild)}};a.moveAttributes=(n,r)=>{Array.from(n.attributes).forEach(e=>{var t=e.name;var i=e.value;n.removeAttribute(t);if(t!=="xmlns"&&t.indexOf(":")===-1&&i){r.setAttribute(t,i)}})};a.styleToAttribute=(e,t,i)=>{if(e.style[t]&&(!i||i.indexOf(e.style[t])===-1)){e.setAttribute(t,e.style[t]);e.style[t]=null}};a.prefixIds=(e,t)=>{var i,n={};i=e.querySelectorAll("*");a.batch(a.prefixIds.idAttributePass,i,t,n);a.batch(a.prefixIds.otherAttributesPass,i,n)};a.prefixIds.idAttributePass=(e,t,i)=>{i[e.id]=t+"."+e.id;e.id=i[e.id]};a.prefixIds.otherAttributesPass=(e,t)=>{a.batch(a.prefixIds.oneAttributeSubPass,e.attributes,t)};a.prefixIds.oneAttributeSubPass=(e,i)=>{e.value=e.value.replace(/url\(#([^)]+)\)/g,(e,t)=>{if(!i[t]){return e}return"url(#"+i[t]+")"})};a.removeAllTags=(e,t,i)=>{Array.from(e.getElementsByTagName(t)).forEach(e=>{if(!i||!e.firstChild){e.parentNode.removeChild(e)}})};a.removeAllAttributes=(e,t)=>{e.removeAttribute(t);Array.from(e.querySelectorAll("["+t+"]")).forEach(e=>{e.removeAttribute(t)})};a.preload=e=>{if(!Array.isArray(e)){e=[e]}e.forEach(e=>{if(a.preload.preloaded[e]){return}a.preload.preloaded[e]=new Image;a.preload.preloaded[e].src=e})};a.preload.preloaded={};a.filterByNamespace=(e,t)=>{var i,n,r,s,o;if(!t||typeof t!=="object"){return}a.filterAttributesByNamespace(e,t);for(i=e.childNodes.length-1;i>=0;i--){n=e.childNodes[i];if(n.nodeType===1){if(n.tagName.indexOf(":")!==-1){o=n.tagName.split(":");r=o[0];s=o[1];if(r===t.primary){n.tagName=s;a.filterByNamespace(n,t)}else if(t.whitelist){if(t.whitelist.indexOf(r)!==-1){a.filterByNamespace(n,t)}else{e.removeChild(n)}}else if(t.blacklist){if(t.blacklist.indexOf(r)!==-1){e.removeChild(n)}else{a.filterByNamespace(n,t)}}else{a.filterByNamespace(n,t)}}else{a.filterByNamespace(n,t)}}}};a.filterAttributesByNamespace=(e,t)=>{var i,n,r,s,o,a;if(!t||typeof t!=="object"){return}for(i=e.attributes.length-1;i>=0;i--){n=e.attributes[i];if(n.name.indexOf(":")!==-1){a=n.name.split(":");r=a[0];s=a[1];o=n.value;if(r===t.primary){e.removeAttributeNode(n);e.setAttribute(s,o)}else if(t.whitelist){if(t.whitelist.indexOf(r)===-1){e.removeAttributeNode(n)}}else if(t.blacklist){if(t.blacklist.indexOf(r)!==-1){e.removeAttributeNode(n)}}}}};a.removeComments=e=>{var t,i;for(t=e.childNodes.length-1;t>=0;t--){i=e.childNodes[t];if(i.nodeType===8){e.removeChild(i)}else if(i.nodeType===1){a.removeComments(i)}}};a.removeWhiteSpaces=(e,t)=>{var i,n,r=null;for(i=e.childNodes.length-1;i>=0;i--){n=e.childNodes[i];if(n.nodeType===3){if(t){if(r){r.nodeValue=(n.nodeValue+r.nodeValue).replace(/^\s*(\n[\t ]*)$/,"$1");e.removeChild(n)}else{n.nodeValue=n.nodeValue.replace(/^\s*(\n[\t ]*)$/,"$1");r=n}}else if(!/\S/.test(n.nodeValue)){e.removeChild(n)}}else if(n.nodeType===1){r=null;a.removeWhiteSpaces(n,t)}else{r=null}}};a.parseMatrix=e=>{var t=e.match(/(matrix|matrix3d)\(([0-9., -]+)\)/);if(!t){return null}return t[2].trim().split(/ ?, ?/).map(e=>{return parseFloat(e)})};a.decomposeMatrix=e=>{if(e.length===6){return a.decomposeMatrix2d(e)}if(e.length===16){return a.decomposeMatrix3d(e)}return null};a.decomposeMatrix2d=e=>{var t=Math.atan2(e[1],e[0]),i=e[0]*e[0]+e[1]*e[1],n=Math.sqrt(i),r=(e[0]*e[3]-e[2]*e[1])/n,s=Math.atan2(e[0]*e[2]+e[1]*e[3],i);return{rotate:180*t/Math.PI,scaleX:n,scaleY:r,skewX:180*s/Math.PI,skewY:0,translateX:e[4],translateY:e[5]}};a.decomposeMatrix3d=e=>{var t=Math.PI/180;var i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=Math.sqrt(e[4]*e[4]+e[5]*e[5]+e[6]*e[6]),r=Math.sqrt(e[8]*e[8]+e[9]*e[9]+e[10]*e[10]);var s=Math.atan2(-e[9]/r,e[10]/r)/t,o=Math.asin(e[8]/r)/t,a=Math.atan2(-e[4]/n,e[0]/i)/t;if(e[4]===1||e[4]===-1){s=0;o=e[4]*-Math.PI/2;a=e[4]*Math.atan2(e[6]/n,e[5]/n)/t}var l=e[12]/i,c=e[13]/i,u=e[14]/i;return{translateX:l,translateY:c,translateZ:u,rotateX:s,rotateY:o,rotateZ:a,scaleX:i,scaleY:n,scaleZ:r}};const s={x:"rotateX",X:"rotateX",y:"rotateY",Y:"rotateY",z:"rotateZ",Z:"rotateZ"};a.stringifyTransform=e=>{var t=[],i,n,r;if(e.translateX){t.push("translateX("+e.translateX+"px)")}if(e.translateY){t.push("translateY("+e.translateY+"px)")}if(e.translateZ){t.push("translateZ("+e.translateZ+"px)")}if(e.rotate){t.push("rotate("+e.rotate+"deg)")}else{i=e.eulerOrder||"zyx";for(n=0;n<3;n++){r=s[i[n]];if(e[r]){t.push(r+"("+e[r]+"deg)")}}}if(e.scale){t.push("scale("+e.scale+")")}else{if(e.scaleX){t.push("scaleX("+e.scaleX+")")}if(e.scaleY){t.push("scaleY("+e.scaleY+")")}if(e.scaleZ){t.push("scaleZ("+e.scaleZ+")")}}if(e.skewX){t.push("skewX("+e.skewX+"deg)")}if(e.skewY){t.push("skewY("+e.skewY+"deg)")}return t.join(" ")};a.transform=(e,t)=>e.style.transform=a.stringifyTransform(t);a.id=(e,t)=>e.id=t;a.text=(e,t)=>e.textContent=t;a.html=(e,t)=>e.innerHTML=t}).call(this)}).call(this,r("_process"))},{"@cronvel/xmldom":23,_process:37}],25:[function(e,t,i){(function(s){(function(){"use strict";function i(e={}){if(!e.ns){throw new Error("EXM: namespace ('ns') is required!")}this.ns=e.ns;this.extensionPath=e.extensionPath||"/ext";this.suffix=e.suffix||"/extension.js";this.api=e.api||{};this.exports=e.exports||{};this.extensions=new Map}t.exports=i;i.prototype.__prototypeUID__="exm/browser/Exm";i.prototype.__prototypeVersion__="0.5";i.registerNs=function(e={}){if(!e.ns||typeof e.ns!=="string"){throw new Error("EXM: namespace ('ns' property) is required!")}if(s.EXM.ns[e.ns]){throw new Error("EXM: namespace '"+e.ns+"' is already registered!")}var t=new i(e);s.EXM.ns[e.ns]=t;return t};i.prototype.requireExtension=async function(i){if(this.extensions.has(i)){return this.extensions.get(i)}var e,t=this.ns+"."+i,n=this.extensionPath+"/"+t,r=n+this.suffix;try{console.warn("Trying EXM extension: ",r);e=await import(r)}catch(e){throw new Error("Required extension '"+i+"' not found.")}if(!e||typeof e!=="object"){throw new Error("EXM: this is not an EXM Extension (not an object)")}if(e.extension){e=e.extension}else{e=s.EXM.extensions[t];if(!e||typeof e!=="object"){throw new Error("EXM: this is not an EXM Extension (not an ES6 module extension and not registered)")}}if(e.__prototypeUID__!=="exm/Extension"&&e.__prototypeUID__!=="exm/browser/Extension"){throw new Error("EXM: this is not an EXM Extension (no prototype UID found)")}if(e.id!==i){throw new Error("EXM: Extension ID mismatch (wanted '"+i+"' but got "+e.id+"'.")}try{await e.init(this,r,n);console.log("Extension '"+e.id+"'"+(e.version?" (v"+e.version+") ":"")+"is loaded.")}catch(e){let t=new Error("EXM: Failed to init extension '"+i+"': "+e);t.from=e;throw e}this.extensions.set(i,e);return e};i.Extension=function(e={}){this.isInit=false;this.id=e.id;this.ns=e.ns;this.uid=e.ns+"."+e.id;this.version=e.version||null;this.host=null;this.path=null;this.dirPath=null;this.fromModule=e.module;this.hooks=e.hooks||{};this.api=e.api||{};this.exports=e.exports||{}};i.Extension.prototype.__prototypeUID__="exm/browser/Extension";i.Extension.prototype.__prototypeVersion__=i.prototype.__prototypeVersion__;i.registerExtension=i.Extension.register=function(e={}){if(!e.id||typeof e.id!=="string"){throw new Error("EXM Extension: ID ('id' property) is required!")}if(!e.ns||typeof e.ns!=="string"){throw new Error("EXM Extension: namespace ('ns' property) is required!")}var t=new i.Extension(e);if(s.EXM.extensions[t.uid]){throw new Error("EXM Extension: ID '"+t.id+"' is already registered for namespace '"+t.ns+"'!")}s.EXM.extensions[t.uid]=t;return t};i.Extension.prototype.init=async function(e,t,i){if(this.isInit){return}if(e.ns!==this.ns){throw new Error("EXM Extension's namespace mismatches the Host!")}if(t){this.path=t}if(i){this.dirPath=i}this.host=e;if(typeof this.hooks.init==="function"){await this.hooks.init()}this.isInit=true};if(!s.EXM){s.EXM={master:null,ns:{},extensions:{}}}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],26:[function(e,t,i){t.exports=function(e){return e!=null&&(n(e)||r(e)||!!e._isBuffer)};function n(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function r(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&n(e.slice(0,0))}},{}],27:[function(e,t,i){"use strict";class n extends Array{constructor(...e){super(...e)}getFinalValue(t){return this.map(e=>e&&typeof e==="object"&&e.__isDynamic__?e.getFinalValue(t):e)}}t.exports=n;n.prototype.__isDynamic__=true;n.serializerFnId="Expression.ObjectEntry";n.serializer=function(e){return{args:e.args,overideKeys:["__isDynamic__","__isApplicable__"]}};n.unserializer=function(...e){return new n(...e)}},{}],28:[function(e,t,i){"use strict";class n extends Array{constructor(...e){if(e.length===1){super();this[0]=e[0]}else{super(...e)}}static get[Symbol.species](){return Array}}t.exports=n},{}],29:[function(e,t,r){"use strict";const n=e("./mode.js");const i=[];const s=e("./Stack.js");const o=e("./ObjectEntry.js");function a(e){return e.replace(/^([A-Z])|([A-Z])/g,(e,t,i)=>{if(t){return t.toLowerCase()}return"-"+i.toLowerCase()})}function l(i,e,t){t.forEach(t=>{r[t]=(...e)=>i[t](...e);r[t].mode=n.FN;r[t].nativeJsFn=e+"."+t})}function c(t,n,e){e.forEach(i=>{var e=n?a(i):i;r[e]=(e,...t)=>(""+e)[i](...t);r[e].mode=t;r[e].nativeJsMethod=i;r[e].nativeJsMethodCast="string"})}r.add=r["+"]=(...e)=>{var t=0;e.forEach(e=>t+=+e);return t};r["+"].mode=n.MULTI_OP;r["+"].jsOp="+";r.sub=r["-"]=(...e)=>{if(e.length===1){return-e[0]}var t=1,i=e.length,n;n=+e[0];for(;t<i;t++){n-=+e[t]}return n};r["-"].mode=n.MULTI_OP;r["-"].jsOp="-";r.mul=r["*"]=(...e)=>{var t=1;e.forEach(e=>t*=+e);return t};r["*"].mode=n.MULTI_OP;r["*"].jsOp="*";r.div=r["/"]=(...e)=>{var t=1,i=e.length,n=+e[0];for(;t<i;t++){n/=+e[t]}return n};r["/"].mode=n.MULTI_OP;r["/"].jsOp="/";r.intdiv=r["\\"]=(...e)=>{var t=1,i=e.length,n=+e[0];for(;t<i;t++){n=Math.trunc(n/+e[t])}return n};r["\\"].mode=n.MULTI_OP;r["\\"].jsFn="intdiv";r.modulo=r["%"]=(...e)=>{var t=1,i=e.length,n=+e[0];for(;t<i;t++){n=n%+e[t]}return n};r["%"].mode=n.MULTI_OP;r["%"].jsOp="%";r.floordiv=r["\\\\"]=(...e)=>{var t=1,i=e.length,n=+e[0];for(;t<i;t++){n=Math.floor(n/+e[t])}return n};r["\\\\"].mode=n.MULTI_OP;r["\\"].jsFn="floordiv";r.positiveModulo=r["%+"]=(...e)=>{var t=1,i=e.length,n=+e[0];for(;t<i;t++){n=n%+e[t];if(n<0){n+=+e[t]}}return n};r["%+"].mode=n.MULTI_OP;r["%+"].jsFn="positiveModulo";r[">"]=(...e)=>{var t=0,i=e.length-1;for(;t<i;t++){if(!(e[t]>e[t+1])){return false}}return true};r[">"].mode=n.MULTI_OP;r[">"].jsOp=">";r["≥"]=r[">="]=(...e)=>{var t=0,i=e.length-1;for(;t<i;t++){if(!(e[t]>=e[t+1])){return false}}return true};r[">="].mode=n.MULTI_OP;r[">="].jsOp=">=";r["<"]=(...e)=>{var t=0,i=e.length-1;for(;t<i;t++){if(!(e[t]<e[t+1])){return false}}return true};r["<"].mode=n.MULTI_OP;r["<"].jsOp="<";r["≤"]=r["<="]=(...e)=>{var t=0,i=e.length-1;for(;t<i;t++){if(!(e[t]<=e[t+1])){return false}}return true};r["<="].mode=n.MULTI_OP;r["<="].jsOp="<=";r["==="]=r["=="]=r["="]=(...e)=>{var t=0,i=e.length-1;for(;t<i;t++){if(e[t]!==e[t+1]){return false}}return true};r["="].mode=n.MULTI_OP;r["="].jsOp="===";r["≠"]=r["!=="]=r["!="]=(...e)=>{var t=0,i=e.length-1;for(;t<i;t++){if(e[t]===e[t+1]){return false}}return true};r["!="].mode=n.MULTI_OP;r["!="].jsOp="!==";r.around=r["≈"]=r["%="]=(e,t,i)=>{if(e===t){return true}if(typeof e!=="number"||typeof t!=="number"||typeof i!=="number"||!(e*t>0)){return false}if(i<1){i=1/i}var n=e/t;if(n<1){n=1/n}return n<=i};r["%="].mode=n.SINGLE_OP_AFTER;r["%="].jsFn="around";r["is-one-of"]=(...e)=>{var t,i=e.length;for(t=1;t<i;t++){if(e[0]===e[t]){return true}}return false};r["is-one-of"].mode=n.SINGLE_OP_AFTER;r.not=r["!"]=e=>!e;r["!"].mode=n.SINGLE_OP_BEFORE;r["!"].jsOp="!";r.and=(...e)=>{var t=1,i=e.length,n=e[0];for(;n&&t<i;t++){n=n&&e[t]}return!!n};r.and.mode=n.MULTI_OP;r.or=(...e)=>{var t=1,i=e.length,n=e[0];for(;!n&&t<i;t++){n=n||e[t]}return!!n};r.or.mode=n.MULTI_OP;r.xor=(...e)=>{var t=0,i=e.length,n=0;for(;n<=1&&t<i;t++){n+=e[t]&&1||0}return n===1};r.xor.mode=n.MULTI_OP;r.guard=r["&&"]=(...e)=>{var t=1,i=e.length,n=e[0];for(;n&&t<i;t++){n=n&&e[t]}return n};r["&&"].mode=n.MULTI_OP;r["&&"].jsOp="&&";r.default=r["||"]=(...e)=>{var t=1,i=e.length,n=e[0];for(;!n&&t<i;t++){n=n||e[t]}return n};r["||"].mode=n.MULTI_OP;r["||"].jsOp="||";r["?"]=(e,t=true,...i)=>{if(e){return t}var n,r;for(n=0,r=i.length;n<r-1;n+=2){if(i[n]){return i[n+1]}}if(n<r){return i[n]}return false};r["?"].mode=n.SINGLE_OP_AFTER;r["?"].jsSpecial="ternary";r["??"]=(e,t=false)=>e!=null?e:t;r["??"].mode=n.SINGLE_OP_AFTER;r["??"].jsOp="??";r.threeWay=r["???"]=(e,t,i,n)=>{if(e<0){return t}else if(e>0){return n}return i};r["???"].mode=n.SINGLE_OP_AFTER;r["???"].jsFn="threeWay";r.int=e=>{e=Math.round(+e);if(isFinite(e)){return e}return NaN};r.int.mode=n.SINGLE_OP_BEFORE;r.float=e=>+e;r.float.mode=n.SINGLE_OP_BEFORE;r.string=e=>""+e;r.string.mode=n.SINGLE_OP_BEFORE;r.round=(e,t=1)=>{if(t===1){return Math.round(e)}return t*Math.round(e*(1/t))};r.round.mode=n.FN;r.floor=(e,t=1)=>{if(t===1){return Math.floor(e)}return t*Math.floor(e*(1/t))};r.floor.mode=n.FN;r.ceil=(e,t=1)=>{if(t===1){return Math.ceil(e)}return t*Math.ceil(e*(1/t))};r.ceil.mode=n.FN;r.trunc=(e,t=1)=>{if(t===1){return Math.trunc(e)}return t*Math.trunc(e*(1/t))};r.trunc.mode=n.FN;l(Math,"Math",["sign","abs","max","min","pow","exp","sqrt","cbrt","log","log2","log10","cos","sin","tan","acos","asin","atan","atan2","cosh","sinh","tanh","acosh","asinh","atanh","hypot"]);r["^"]=r.pow;r.clamp=(e,t,i)=>t<=i?e<t?t:e>i?i:e:e<i?i:e>t?t:e;r.clamp.mode=n.FN;r.avg=(...e)=>e.reduce((e,t)=>e+t,0)/e.length;r.avg.mode=n.FN;r.lerp=(e,t,i)=>e+i*(t-e);r.lerp.mode=n.FN;r.fourier=(e,t,...i)=>{var n,r,s=0,o=0,a,l=2*Math.PI/t;for(n=0,r=i.length;n<r;n++){if(Array.isArray(i[n])){a=i[n][0];if(i[n][1]!==undefined){o=i[n][1]}}else{a=i[n]}s+=a*Math.cos((n+1)*l*e+o)}return s};r.fourier.mode=n.FN;r.strcat=r[".."]=(...e)=>e.join("");r[".."].mode=n.MULTI_OP;r[".."].jsOp="+";c(n.SINGLE_OP_AFTER,true,["startsWith","endsWith","includes"]);c(n.SINGLE_OP,true,["indexOf","lastIndexOf","padStart","padEnd","slice"]);c(n.FN,true,["trim","trimStart","trimEnd","toLowerCase","toUpperCase"]);r.ltrim=r["trim-start"];r.rtrim=r["trim-end"];r.itrim=e=>(""+e).trim().replace(/  +/g," ");r.itrim.mode=n.FN;r.array=(...e)=>e;r.array.mode=n.LIST;r.concat=(...e)=>Array.prototype.concat.call(i,...e);r.concat.mode=n.FN;r.join=(e,t)=>{if(!Array.isArray(e)){return e}return e.join(typeof t==="string"?t:"")};r.join.mode=n.FN;r.object=(...e)=>Object.fromEntries(e);r.object.mode=n.KV;r.merge=(...e)=>Object.assign({},...e);r.merge.mode=n.FN;r["is-set?"]=(e,t=true,i=false)=>e!==undefined?t:i;r["is-set?"].mode=n.SINGLE_OP_AFTER;r["is-boolean?"]=(e,t=true,i=false)=>typeof e==="boolean"?t:i;r["is-boolean?"].mode=n.SINGLE_OP_AFTER;r["is-number?"]=(e,t=true,i=false)=>typeof e==="number"?t:i;r["is-number?"].mode=n.SINGLE_OP_AFTER;r["is-string?"]=(e,t=true,i=false)=>typeof e==="string"?t:i;r["is-string?"].mode=n.SINGLE_OP_AFTER;r["is-array?"]=(e,t=true,i=false)=>Array.isArray(e)?t:i;r["is-array?"].mode=n.SINGLE_OP_AFTER;r["is-object?"]=(e,t=true,i=false)=>e&&typeof e==="object"&&!Array.isArray(e)?t:i;r["is-object?"].mode=n.SINGLE_OP_AFTER;r["is-real?"]=(e,t=true,i=false)=>typeof e==="number"&&!Number.isNaN(e)&&e!==Infinity&&e!==-Infinity?t:i;r["is-real?"].mode=n.SINGLE_OP_AFTER;r["is-empty?"]=(e,t=true,i=false)=>{var n;return!e?t:typeof e!=="object"?i:e.length===0?t:e.size===0?t:(n=Object.getPrototypeOf(e))===Object.prototype&&Object.keys(e).length===0?t:n===null&&Object.keys(e).length===0?t:i};r["is-empty?"].mode=n.SINGLE_OP_AFTER;r["is-not-empty?"]=(e,t=true,i=false)=>{var n;return!e?i:typeof e!=="object"?t:e.length===0?i:e.size===0?i:(n=Object.getPrototypeOf(e))===Object.prototype&&Object.keys(e).length===0?i:n===null&&Object.keys(e).length===0?i:t};r["is-not-empty?"].mode=n.SINGLE_OP_AFTER;r.has=(e,t)=>{if(!e||typeof e!=="object"){return false}else if(Array.isArray(e)){return e.includes(t)}else if(typeof e.has==="function"){return!!e.has(t)}return false};r.has.mode=n.SINGLE_OP_AFTER;r["."]=(i,...n)=>{for(let e=0,t=n.length;e<t;e++){if(!i||typeof i!=="object"){return undefined}i=i[n[e]]}return i};r["."].mode=n.MULTI_OP;r["."].jsSpecial="navigation";r["..."]=e=>{if(Array.isArray(e)){return new s(...e)}if(e&&typeof e==="object"){return new s(...Object.entries(e).map(e=>new o(...e)))}return e};r["..."].mode=n.SINGLE_OP_BEFORE;r["..."].jsSpecial="spread";r["->"]=(e,...t)=>{if(typeof e!=="function"){throw new SyntaxError("The apply operator needs a function as its left-hand-side operand")}return e(...t)};r["->"].boundFirst=true;r["->"].mode=n.SINGLE_OP_AFTER;r["->"].jsSpecial="call";const u={};u.deg=u.degree=u["°"]=e=>e/180*Math.PI;u.celsius=u["°C"]=e=>e+273.15;for(let e in u){r[e]=u[e];r[e].mode=n.SINGLE_OP_AFTER;r[e].jsFn=e}for(let e in r){if(!r[e].id){r[e].id=e}}},{"./ObjectEntry.js":27,"./Stack.js":28,"./mode.js":31}],30:[function(e,t,i){"use strict";const o=e("./ObjectEntry.js");t.exports=(i,n,r={})=>{var s=null;i.forEach((e,t)=>{if(e instanceof o){if(s===null){s=t}r[e[0]]=e[1]}});if(s!==null){i.length=s}if(n){for(let e=0,t=Math.min(i.length,n.length);e<t;e++){r[n[e]]=i[e]}i.length=0}return r}},{"./ObjectEntry.js":27}],31:[function(e,t,i){"use strict";i.FN=0;i.SINGLE_OP=1;i.MULTI_OP=2;i.SINGLE_OP_BEFORE=3;i.SINGLE_OP_AFTER=4;i.LIST=5;i.KV=6},{}],32:[function(e,t,i){"use strict";function n(){}t.exports=n;n.prototype.__prototypeUID__="nextgen-events/LeanEvents";n.prototype.__prototypeVersion__=e("../package.json").version;n.prototype.on=n.prototype.addListener=function(e,t,i,n){if(!this.__listeners){this.__listeners={}}if(!this.__listeners[e]){this.__listeners[e]=[]}var r=this.__states&&this.__states[e];if(r&&n){t(...r);return}var s={id:i??t,fn:t,once:!!n};var o=this.__listeners[e];o[o.length]=s;if(r){t(...r)}};n.prototype.once=function(e,t,i){return this.addListener(e,t,i,true)};n.prototype.waitFor=function(e){return new Promise(t=>{this.addListener(e,e=>t(e),undefined,true)})};n.prototype.waitForAll=function(e){return new Promise(t=>{this.addListener(e,(...e)=>t(e),undefined,true)})};n.prototype.off=n.prototype.removeListener=function(e,t){if(!this.__listeners||!this.__listeners[e]||!this.__listeners[e].length){return}this.__listeners[e]=this.__listeners[e].filter(e=>e.id!==t);return this};n.prototype.removeAllListeners=function(e){if(!this.__listeners){return}if(e){delete this.__listeners[e]}else{this.__listeners={}}return this};n.prototype.emit=function(e,...t){var i,n,r,s,o,a;if(this.__states&&(o=this.__states[e])!==undefined){if(o&&t.length===o.length&&(!t.length||t.every((e,t)=>e===o[t]))){return}a=this.__stateGroups[e];for(i=0,n=a.length;i<n;i++){this.__states[a[i]]=null}this.__states[e]=t}if(!this.__listeners){return}r=this.__listeners[e];if(!r||!r.length){return}for(i=0,n=r.length;i<n;i++){s=r[i];if(s.once){this.removeListener(e,s.id)}s.fn(...t)}return this};n.prototype.listeners=function(e){if(!this.__listeners||!this.__listeners[e]){return[]}return this.__listeners[e].slice()};n.prototype.listenerCount=function(e){if(!this.__listeners||!this.__listeners[e]){return 0}return this.__listeners[e].length};n.prototype.defineStates=function(...t){if(!this.__states){this.__states={};this.__stateGroups={}}t.forEach(e=>{this.__states[e]=null;this.__stateGroups[e]=t})};n.prototype.hasState=function(e){if(!this.__states){return false}return!!this.__states[e]};n.prototype.getAllStates=function(){if(!this.__states){return[]}return Object.keys(this.__states).filter(e=>this.__states[e])}},{"../package.json":36}],33:[function(n,r,e){(function(s,e,t){(function(){"use strict";const i=s.browser?window.setImmediate:s.nextTick;if(!e.__NEXTGEN_EVENTS__){e.__NEXTGEN_EVENTS__={recursions:0}}var c=e.__NEXTGEN_EVENTS__;function u(){}r.exports=u;u.prototype.__prototypeUID__="nextgen-events/NextGenEvents";u.prototype.__prototypeVersion__=n("../package.json").version;u.SYNC=-Infinity;u.DESYNC=-1;u.defaultMaxListeners=Infinity;u.init=function(){Object.defineProperty(this,"__ngev",{configurable:true,value:new u.Internal})};u.Internal=function(i){this.nice=u.SYNC;this.interruptible=false;this.contexts={};this.desync=t;this.depth=0;this.states={};this.stateGroups={};this.listeners={error:[],interrupt:[],newListener:[],removeListener:[]};this.hasListenerPriority=false;this.maxListeners=u.defaultMaxListeners;if(i){this.nice=i.nice;this.interruptible=i.interruptible;Object.assign(this.states,i.states),Object.assign(this.stateGroups,i.stateGroups),Object.keys(i.listeners).forEach(e=>{this.listeners[e]=i.listeners[e].slice()});Object.keys(i.contexts).forEach(e=>{var t=i.contexts[e];this.contexts[e]={nice:t.nice,ready:true,status:t.status,serial:t.serial,scopes:{}}})}};u.initFrom=function(e){if(!e.__ngev){u.init.call(e)}Object.defineProperty(this,"__ngev",{configurable:true,value:new u.Internal(e.__ngev)})};u.mergeListeners=function(s){if(!this.__ngev){u.init.call(this)}var e=this.__ngev.listeners;this.__ngev.listeners={};Object.keys(e).forEach(e=>{this.__ngev.listeners[e]=[]});s.forEach(e=>{if(!e.__ngev){u.init.call(e)}Object.keys(e.__ngev.listeners).forEach(e=>{if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}})});Object.keys(this.__ngev.listeners).forEach(t=>{var i,n,r=[];if(e[t]){e[t].forEach(e=>{for(i=0,n=s.length;i<n;i++){if(!s[i].__ngev.listeners[t]||s[i].__ngev.listeners[t].indexOf(e)===-1){r.push(e);break}}})}s.forEach(e=>{e.__ngev.listeners[t].forEach(e=>{if(this.__ngev.listeners[t].indexOf(e)===-1&&r.indexOf(e)===-1){this.__ngev.listeners[t].push(e)}})})})};u.filterOutCallback=function(e,t){return e!==t};u.prototype.addListener=function(e,t,i){var n,r;if(!this.__ngev){u.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}if(!e||typeof e!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof t==="function"){n={};if(!i||typeof i!=="object"){i={}}}else if(i===true&&t&&typeof t==="object"){i=n=t;t=undefined}else{i=t;if(!i||typeof i!=="object"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}t=undefined;n={}}n.fn=t||i.fn;n.id=i.id!==undefined?i.id:n.fn;if(i.unique){if(this.__ngev.listeners[e].find(e=>e.id===n.id)){return}}n.once=!!i.once;n.async=!!i.async;n.eventObject=!!i.eventObject;n.nice=i.nice!==undefined?Math.floor(i.nice):u.SYNC;n.priority=+i.priority||0;n.context=i.context&&(typeof i.context==="string"||typeof i.context==="object")?i.context:null;if(typeof n.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(typeof n.context==="string"){n.context=this.__ngev.contexts[n.context]||this.addListenerContext(n.context)}n.event=e;if(this.__ngev.listeners.newListener.length){r=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[e].push(n);u.emitEvent({emitter:this,name:"newListener",args:[[n]],listeners:r});if(this.__ngev.states[e]){u.emitToOneListener(this.__ngev.states[e],n)}return this}this.__ngev.listeners[e].push(n);if(this.__ngev.hasListenerPriority){this.__ngev.listeners[e].sort((e,t)=>t.priority-e.priority)}if(this.__ngev.listeners[e].length===this.__ngev.maxListeners+1){s.emitWarning("Possible NextGenEvents memory leak detected. "+this.__ngev.listeners[e].length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit",{type:"MaxListenersExceededWarning"})}if(this.__ngev.states[e]){u.emitToOneListener(this.__ngev.states[e],n)}return this};u.prototype.on=u.prototype.addListener;u.prototype.once=function(e,t,i){if(t&&typeof t==="object"){t.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.addListener(e,t,i)};u.prototype.waitFor=function(e){return new Promise(t=>{this.addListener(e,e=>t(e),{once:true})})};u.prototype.waitForAll=function(e){return new Promise(t=>{this.addListener(e,(...e)=>t(e),{once:true})})};u.prototype.removeListener=function(e,t){if(!e||typeof e!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){u.init.call(this)}var i=this.__ngev.listeners[e];if(!i||!i.length){return this}var n,r,s=0,o=i.length,a=this.__ngev.listeners.removeListener.length;if(a){r=[]}for(n=0;n<o;n++){if(i[n].id===t){s++;if(a){r.push(i[n])}}else if(s){i[n-s]=i[n]}}if(s){i.length-=s}if(a&&r.length){this.emit("removeListener",r)}return this};u.prototype.off=u.prototype.removeListener;u.prototype.removeAllListeners=function(e){var t;if(!this.__ngev){u.init.call(this)}if(e){if(!e||typeof e!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}t=this.__ngev.listeners[e];this.__ngev.listeners[e]=[];if(t.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",t)}}else{this.__ngev.listeners={error:[],interrupt:[],newListener:[],removeListener:[]}}return this};u.listenerWrapper=function(e,t,i,n,r){var s,o,a=t.master||t,l=!!t.master||t.emitter.__ngev.interruptible;if(a.interrupt){return}if(e.async){if(i){i.ready=!n}if(r<0){if(c.recursions>=-r){t.emitter.__ngev.desync(u.listenerWrapper.bind(undefined,e,t,i,n,u.SYNC));return}}else{setTimeout(u.listenerWrapper.bind(undefined,e,t,i,n,u.SYNC),r);return}o=e=>{a.listenersDone++;if(e&&l&&!a.interrupt&&t.name!=="interrupt"){a.interrupt=e;if(a.callback){u.emitCallback(t)}t.emitter.emit("interrupt",a.interrupt)}else if(a.listenersDone>=a.listeners.length&&a.callback){u.emitCallback(t)}if(n){u.processScopeQueue(i,true,true)}};if(e.eventObject){e.fn(t,o)}else{s=e.fn(...t.args,o)}}else{if(r<0){if(c.recursions>=-r){t.emitter.__ngev.desync(u.listenerWrapper.bind(undefined,e,t,i,n,u.SYNC));return}}else{setTimeout(u.listenerWrapper.bind(undefined,e,t,i,n,u.SYNC),r);return}if(e.eventObject){e.fn(t)}else{s=e.fn(...t.args)}a.listenersDone++}if(s&&l&&!a.interrupt&&t.name!=="interrupt"){a.interrupt=s;if(a.callback){u.emitCallback(t)}t.emitter.emit("interrupt",a.interrupt)}else if(a.listenersDone>=a.listeners.length&&a.callback){u.emitCallback(t)}};var h=0;u.prototype.emit=function(...e){var t=u.createEvent(this,...e);return u.emitEvent(t)};u.prototype.emitIfListener=function(...e){var t=typeof e[0]==="number"?e[1]:e[0];if(!this.__ngev||!this.__ngev.listeners[t]||!this.__ngev.listeners[t].length){return null}var i=u.createEvent(this,...e);return u.emitEvent(i)};u.prototype.waitForEmit=function(...e){return new Promise(t=>{this.emit(...e,e=>t(e))})};u.createEvent=function(e,...t){var i={emitter:e,interrupt:null,master:null,sync:true};if(typeof t[0]==="number"){i.nice=Math.floor(t[0]);i.name=t[1];if(!i.name||typeof i.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof t[t.length-1]==="function"){i.callback=t[t.length-1];i.args=t.slice(2,-1)}else{i.args=t.slice(2)}}else{i.name=t[0];if(!i.name||typeof i.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}if(typeof t[t.length-1]==="function"){i.callback=t[t.length-1];i.args=t.slice(1,-1)}else{i.args=t.slice(1)}}return i};u.emitEvent=function(e){var t=e.emitter,i,n,r=0,s,o;if(!t.__ngev){u.init.call(t)}s=t.__ngev.states[e.name];if(s!==undefined){if(s&&e.args.length===s.args.length&&e.args.every((e,t)=>e===s.args[t])){return}t.__ngev.stateGroups[e.name].forEach(e=>{t.__ngev.states[e]=null});t.__ngev.states[e.name]=e}if(!t.__ngev.listeners[e.name]){t.__ngev.listeners[e.name]=[]}e.id=h++;e.listenersDone=0;if(e.nice===undefined||e.nice===null){e.nice=t.__ngev.nice}if(!e.listeners){e.listeners=t.__ngev.listeners[e.name].slice()}c.recursions++;e.depth=t.__ngev.depth++;o=[];try{for(i=0,n=e.listeners.length;i<n;i++){r++;u.emitToOneListener(e,e.listeners[i],o)}}catch(e){c.recursions--;t.__ngev.depth--;throw e}c.recursions--;if(!e.callback){t.__ngev.depth--}if(o.length&&t.__ngev.listeners.removeListener.length){t.emit("removeListener",o)}if(!r){if(e.name==="error"){if(e.args[0]){throw e.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(e.callback){u.emitCallback(e)}}e.sync=false;return e};u.emitIntricatedEvents=function(e,t){var i,n,r=0,s;if(!Array.isArray(e)){throw new TypeError(".emitCorrelatedEvents() argument should be an array")}var o=[],a={nice:u.DESYNC,ready:true,status:u.CONTEXT_ENABLED,serial:true,scopes:{}},l={sync:false,nice:u.DESYNC,context:a,interrupt:null,listeners:o,listenersDone:0,depth:0,callback:t};e.forEach(e=>{var t=u.createEvent(...e);t.master=l;if(!t.emitter.__ngev){u.init.call(t.emitter)}if(!t.emitter.__ngev.listeners[t.name]){t.emitter.__ngev.listeners[t.name]=[]}t.listeners=t.emitter.__ngev.listeners[t.name].slice();t.id=h++;t.listeners.forEach(e=>o.push({event:t,listener:e}))});o.sort((e,t)=>t.listener.priority-e.listener.priority);c.recursions++;s=[];try{for(i=0,n=o.length;i<n;i++){r++;u.emitToOneListener(o[i].event,o[i].listener,s)}}catch(e){c.recursions--;throw e}c.recursions--;if(!r&&l.callback){u.emitCallback(event)}l.sync=false};u.emitToOneListener=function(e,t,i){var n=e.emitter,r=e.master||e,s=e.master?e.master.context:t.context,o,a,l,c=false;if(s){if(s.status===u.CONTEXT_DISABLED){return}l=Math.max(r.nice,t.nice,s.nice);a=s.serial;o=u.getContextScope(s,r.depth)}else{l=Math.max(r.nice,t.nice)}if(t.once){n.__ngev.listeners[e.name]=n.__ngev.listeners[e.name].filter(u.filterOutCallback.bind(undefined,t));if(i){i.push(t)}else{c=true}}if(s&&(s.status===u.CONTEXT_QUEUED||!o.ready)){o.queue.push({event:e,listener:t,nice:l})}else{u.listenerWrapper(t,e,o,a,l)}if(c&&n.__ngev.listeners.removeListener.length){n.emit("removeListener",[t])}};u.emitCallback=function(e){var t;if(e.master){t=e.master.callback;delete e.master.callback;if(e.master.sync){i(()=>t(e.master.interrupt,e))}else{t(e.master.interrupt,e)}return}t=e.callback;delete e.callback;if(e.sync&&e.emitter.__ngev.nice!==u.SYNC){e.emitter.__ngev.desync(()=>{e.emitter.__ngev.depth--;t(e.interrupt,e)})}else{e.emitter.__ngev.depth--;t(e.interrupt,e)}};u.prototype.listeners=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){u.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].slice()};u.listenerCount=function(e,t){if(!e||!(e instanceof u)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};u.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev||!this.__ngev.listeners[e]){return 0}return this.__ngev.listeners[e].length};u.prototype.setNice=function(e){if(!this.__ngev){u.init.call(this)}this.__ngev.nice=Math.floor(+e||0)};u.prototype.desyncUseNextTick=function(e){if(!this.__ngev){u.init.call(this)}this.__ngev.desync=e?i:t};u.prototype.setInterruptible=function(e){if(!this.__ngev){u.init.call(this)}this.__ngev.interruptible=!!e};u.prototype.setListenerPriority=function(e){if(!this.__ngev){u.init.call(this)}this.__ngev.hasListenerPriority=!!e};u.share=function(e,t){if(!(e instanceof u)||!(t instanceof u)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){u.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};u.reset=function(e){Object.defineProperty(e,"__ngev",{configurable:true,value:null})};u.prototype.getMaxListeners=function(){if(!this.__ngev){u.init.call(this)}return this.__ngev.maxListeners};u.prototype.setMaxListeners=function(e){if(!this.__ngev){u.init.call(this)}this.__ngev.maxListeners=typeof e==="number"&&!Number.isNaN(e)?Math.floor(e):u.defaultMaxListeners;return this};u.noop=()=>undefined;u.prototype.defineStates=function(...t){if(!this.__ngev){u.init.call(this)}t.forEach(e=>{this.__ngev.states[e]=null;this.__ngev.stateGroups[e]=t})};u.prototype.hasState=function(e){if(!this.__ngev){u.init.call(this)}return!!this.__ngev.states[e]};u.prototype.getAllStates=function(){if(!this.__ngev){u.init.call(this)}return Object.keys(this.__ngev.states).filter(e=>this.__ngev.states[e])};u.groupAddListener=function(e,t,i,n){if(typeof i!=="function"){n=i;i=undefined}if(!n||typeof n!=="object"){n={}}i=i||n.fn;delete n.fn;n.id=n.id||i;e.forEach(e=>{e.addListener(t,i.bind(undefined,e),n)})};u.groupOn=u.groupAddListener;u.groupOnce=function(e,t,i,n){if(i&&typeof i==="object"){i.once=true}else if(n&&typeof n==="object"){n.once=true}else{n={once:true}}return this.groupAddListener(e,t,i,n)};u.groupWaitFor=function(e,t){return Promise.all(e.map(e=>e.waitFor(t)))};u.groupWaitForAll=function(e,t){return Promise.all(e.map(e=>e.waitForAll(t)))};u.groupOnceFirst=function(t,i,n,r){var s,o=false;if(typeof n!=="function"){r=n;n=undefined}if(!r||typeof r!=="object"){r={}}n=n||r.fn;delete r.fn;r.id=r.id||n;s=(...e)=>{if(o){return}o=true;u.groupRemoveListener(t,i,r.id);n(...e)};t.forEach(e=>{e.once(i,s.bind(undefined,e),r)})};u.groupWaitForFirst=function(e,i){return new Promise(t=>{u.groupOnceFirst(e,i,e=>t(e))})};u.groupWaitForFirstAll=function(e,i){return new Promise(t=>{u.groupOnceFirst(e,i,(...e)=>t(e))})};u.groupOnceLast=function(e,t,i,n){var r,s=false,o=e.length;if(typeof i!=="function"){n=i;i=undefined}if(!n||typeof n!=="object"){n={}}i=i||n.fn;delete n.fn;n.id=n.id||i;r=(...e)=>{if(s){return}if(--o){return}s=true;i(...e)};e.forEach(e=>{e.once(t,r.bind(undefined,e),n)})};u.groupWaitForLast=function(e,i){return new Promise(t=>{u.groupOnceLast(e,i,e=>t(e))})};u.groupWaitForLastAll=function(e,i){return new Promise(t=>{u.groupOnceLast(e,i,(...e)=>t(e))})};u.groupRemoveListener=function(e,t,i){e.forEach(e=>{e.removeListener(t,i)})};u.groupOff=u.groupRemoveListener;u.groupRemoveAllListeners=function(e,t){e.forEach(e=>{e.removeAllListeners(t)})};u.groupEmit=function(e,...t){var i,n,r=1,s,o=e.length,a,l,c=false;if(typeof t[t.length-1]==="function"){s=-1;a=t[t.length-1];l=e=>{if(c){return}if(e){c=true;a(e)}else if(!--o){c=true;a()}}}if(typeof t[0]==="number"){r=2;n=typeof t[0]}i=t[r-1];t=t.slice(r,s);e.forEach(e=>{u.emitEvent({emitter:e,name:i,args:t,nice:n,callback:l})})};u.groupWaitForEmit=function(e,...i){return new Promise(t=>{u.groupEmit(e,...i,e=>t(e))})};u.groupDefineStates=function(e,...t){e.forEach(e=>{e.defineStates(...t)})};u.groupGlobalOnce=u.groupOnceFirst;u.groupGlobalOnceAll=u.groupOnceLast;u.CONTEXT_ENABLED=0;u.CONTEXT_DISABLED=1;u.CONTEXT_QUEUED=2;u.prototype.addListenerContext=function(e,t){if(!this.__ngev){u.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!t||typeof t!=="object"){t={}}var i=this.__ngev.contexts[e];if(!i){i=this.__ngev.contexts[e]={nice:u.SYNC,ready:true,status:u.CONTEXT_ENABLED,serial:false,scopes:{}}}if(t.nice!==undefined){i.nice=Math.floor(t.nice)}if(t.status!==undefined){i.status=t.status}if(t.serial!==undefined){i.serial=!!t.serial}return i};u.prototype.getListenerContext=function(e){return this.__ngev.contexts[e]};u.getContextScope=function(e,t){var i=e.scopes[t];if(!i){i=e.scopes[t]={ready:true,queue:[]}}return i};u.prototype.disableListenerContext=function(e){if(!this.__ngev){u.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=u.CONTEXT_DISABLED;return this};u.prototype.enableListenerContext=function(e){if(!this.__ngev){u.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}var t=this.__ngev.contexts[e];t.status=u.CONTEXT_ENABLED;Object.values(t.scopes).forEach(e=>{if(e.queue.length>0){u.processScopeQueue(e,t.serial)}});return this};u.prototype.queueListenerContext=function(e){if(!this.__ngev){u.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=u.CONTEXT_QUEUED;return this};u.prototype.serializeListenerContext=function(e,t){if(!this.__ngev){u.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].serial=t===undefined?true:!!t;return this};u.prototype.setListenerContextNice=function(e,t){if(!this.__ngev){u.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].nice=Math.floor(t);return this};u.prototype.destroyListenerContext=function(e){var t,i,n,r,s,o=[];if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){u.init.call(this)}n=this.__ngev.contexts[e];if(!n){return}for(r in this.__ngev.listeners){s=null;i=this.__ngev.listeners[r].length;for(t=0;t<i;t++){if(this.__ngev.listeners[r][t].context===n){s=[];o.push(this.__ngev.listeners[r][t])}else if(s){s.push(this.__ngev.listeners[r][t])}}if(s){this.__ngev.listeners[r]=s}}delete this.__ngev.contexts[e];if(o.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",o)}return this};u.processScopeQueue=function(e,t,i){var n,r,s,o;if(i){e.ready=true}c.recursions++;while(e.ready&&e.queue.length){n=e.queue.shift();r=n.event;s=r.master||r;o=r.emitter;if(s.interrupt){continue}u.listenerWrapper(n.listener,r,e,t,n.nice)}c.recursions--};u.on=u.prototype.on;u.once=u.prototype.once;u.off=u.prototype.off;if(e.AsyncTryCatch){u.prototype.asyncTryCatchId=e.AsyncTryCatch.NextGenEvents.length;e.AsyncTryCatch.NextGenEvents.push(u);if(e.AsyncTryCatch.substituted){e.AsyncTryCatch.substitute()}}u.Proxy=n("./Proxy.js")}).call(this)}).call(this,n("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},n("timers").setImmediate)},{"../package.json":36,"./Proxy.js":34,_process:37,timers:74}],34:[function(e,t,i){"use strict";function n(){this.localServices={};this.remoteServices={};this.nextAckId=1}t.exports=n;var s=e("./NextGenEvents.js");var o="NextGenEvents/message";function r(){}n.create=(...e)=>new n(...e);n.prototype.addLocalService=function(e,t,i){this.localServices[e]=a.create(this,e,t,i);return this.localServices[e]};n.prototype.addRemoteService=function(e){this.remoteServices[e]=l.create(this,e);return this.remoteServices[e]};n.prototype.destroy=function(){Object.keys(this.localServices).forEach(e=>{this.localServices[e].destroy();delete this.localServices[e]});Object.keys(this.remoteServices).forEach(e=>{this.remoteServices[e].destroy();delete this.remoteServices[e]});this.receive=this.send=r};n.prototype.push=function(e){if(e.__type!==o||!e.service||typeof e.service!=="string"||!e.event||typeof e.event!=="string"||!e.method){return}switch(e.method){case"event":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveEvent(e);case"ackEmit":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveAckEmit(e);case"emit":return this.localServices[e.service]&&this.localServices[e.service].receiveEmit(e);case"listen":return this.localServices[e.service]&&this.localServices[e.service].receiveListen(e);case"ignore":return this.localServices[e.service]&&this.localServices[e.service].receiveIgnore(e);case"ackEvent":return this.localServices[e.service]&&this.localServices[e.service].receiveAckEvent(e);default:return}};n.prototype.receive=function(e){this.push(e)};n.prototype.send=function(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function a(e,t,i,n){return a.create(e,t,i,n)}n.LocalService=a;a.create=function(e,t,i,n){var r=Object.create(a.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:i,writable:true,enumerable:true},internalEvents:{value:Object.create(s.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!n.listen,writable:true,enumerable:true},canEmit:{value:!!n.emit,writable:true,enumerable:true},canAck:{value:!!n.ack,writable:true,enumerable:true},canRpc:{value:!!n.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return r};a.prototype.destroy=function(){Object.keys(this.events).forEach(e=>{this.emitter.off(e,this.events[e]);delete this.events[e]});this.emitter=null;this.destroyed=true};a.prototype.receiveEmit=function(t){if(this.destroyed||!this.canEmit||t.ack&&!this.canAck){return}var e={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){e.callback=e=>{this.proxy.send({__type:o,service:this.id,method:"ackEmit",ack:t.ack,event:t.event,interruption:e})}}s.emitEvent(e)};a.prototype.receiveListen=function(e){if(this.destroyed||!this.canListen||e.ack&&!this.canAck){return}if(e.ack){if(this.events[e.event]){if(this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=a.forwardWithAck.bind(this);this.events[e.event].ack=true;this.emitter.on(e.event,this.events[e.event],{eventObject:true,async:true})}else{if(this.events[e.event]){if(!this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=a.forward.bind(this);this.events[e.event].ack=false;this.emitter.on(e.event,this.events[e.event],{eventObject:true})}};a.prototype.receiveIgnore=function(e){if(this.destroyed||!this.canListen){return}if(!this.events[e.event]){return}this.emitter.off(e.event,this.events[e.event]);this.events[e.event]=null};a.prototype.receiveAckEvent=function(e){if(this.destroyed||!this.canListen||!this.canAck||!e.ack||!this.events[e.event]||!this.events[e.event].ack){return}this.internalEvents.emit("ack",e)};a.forward=function(e){if(this.destroyed){return}this.proxy.send({__type:o,service:this.id,method:"event",event:e.name,args:e.args})};a.forward.ack=false;a.forwardWithAck=function(e,t){if(this.destroyed){return}if(!e.callback){this.proxy.send({__type:o,service:this.id,method:"event",event:e.name,args:e.args});t();return}var i=false;var n=this.proxy.nextAckId++;var r=e=>{if(i||e.ack!==n){return}i=true;this.internalEvents.off("ack",r);t()};this.internalEvents.on("ack",r);this.proxy.send({__type:o,service:this.id,method:"event",event:e.name,ack:n,args:e.args})};a.forwardWithAck.ack=true;function l(e,t){return l.create(e,t)}n.RemoteService=l;var c=1;var u=2;l.create=function(e,t){var i=Object.create(l.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:Object.create(s.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(s.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return i};l.prototype.destroy=function(){this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(e=>{delete this.events[e]});this.destroyed=true};l.prototype.emit=function(e,...t){if(this.destroyed){return}var i,n,r;if(typeof e==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof t[t.length-1]!=="function"){this.proxy.send({__type:o,service:this.id,method:"emit",event:e,args:t});return}i=t.pop();n=this.proxy.nextAckId++;r=false;var s=e=>{if(r||e.ack!==n){return}r=true;this.internalEvents.off("ack",s);i(e.interruption)};this.internalEvents.on("ack",s);this.proxy.send({__type:o,service:this.id,method:"emit",ack:n,event:e,args:t})};l.prototype.addListener=function(e,t,i){if(this.destroyed){return}if(typeof t!=="function"){i=t;t=undefined}if(!i||typeof i!=="object"){i={}}i.fn=t||i.fn;this.emitter.addListener(e,i);if(!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length){return}if(i.async&&this.events[e]!==u){this.events[e]=u;this.proxy.send({__type:o,service:this.id,method:"listen",ack:true,event:e})}else if(!i.async&&!this.events[e]){this.events[e]=c;this.proxy.send({__type:o,service:this.id,method:"listen",event:e})}};l.prototype.on=l.prototype.addListener;l.prototype.once=s.prototype.once;l.prototype.removeListener=function(e,t){if(this.destroyed){return}this.emitter.removeListener(e,t);if((!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length)&&this.events[e]){this.events[e]=0;this.proxy.send({__type:o,service:this.id,method:"ignore",event:e})}};l.prototype.off=l.prototype.removeListener;l.prototype.receiveEvent=function(e){if(this.destroyed||!this.events[e.event]){return}var t={emitter:this.emitter,name:e.event,args:e.args||[]};if(e.ack){t.callback=()=>{this.proxy.send({__type:o,service:this.id,method:"ackEvent",ack:e.ack,event:e.event})}}s.emitEvent(t);var i=t.name;if(!this.emitter.__ngev.listeners[i]||!this.emitter.__ngev.listeners[i].length){this.events[i]=0;this.proxy.send({__type:o,service:this.id,method:"ignore",event:i})}};l.prototype.receiveAckEmit=function(e){if(this.destroyed||!e.ack||this.events[e.event]!==u){return}this.internalEvents.emit("ack",e)}},{"./NextGenEvents.js":33}],35:[function(t,i,e){(function(e){(function(){"use strict";if(typeof window.setImmediate!=="function"){window.setImmediate=e=>setTimeout(e,0)}if(!e.emitWarning){e.emitWarning=()=>undefined}i.exports=t("./NextGenEvents.js");i.exports.isBrowser=true}).call(this)}).call(this,t("_process"))},{"./NextGenEvents.js":33,_process:37}],36:[function(e,t,i){t.exports={name:"nextgen-events",version:"1.5.2",description:"The next generation of events handling for javascript! New: abstract away the network!",main:"lib/NextGenEvents.js",engines:{node:">=6.0.0"},directories:{test:"test",bench:"bench"},dependencies:{},devDependencies:{browserify:"^17.0.0","uglify-js-es6":"^2.8.9",ws:"^7.4.6"},scripts:{test:"tea-time -R dot"},repository:{type:"git",url:"https://github.com/cronvel/nextgen-events.git"},keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],author:"Cédric Ronvel",license:"MIT",bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2021],owner:"Cédric Ronvel"}}},{}],37:[function(e,t,i){var n=t.exports={};var r;var s;function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){r=setTimeout}else{r=o}}catch(e){r=o}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=a}}catch(e){s=a}})();function l(t){if(r===setTimeout){return setTimeout(t,0)}if((r===o||!r)&&setTimeout){r=setTimeout;return setTimeout(t,0)}try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}function c(t){if(s===clearTimeout){return clearTimeout(t)}if((s===a||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(t)}try{return s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}var u=[];var h=false;var f;var d=-1;function p(){if(!h||!f){return}h=false;if(f.length){u=f.concat(u)}else{d=-1}if(u.length){m()}}function m(){if(h){return}var e=l(p);h=true;var t=u.length;while(t){f=u;u=[];while(++d<t){if(f){f[d].run()}}d=-1;t=u.length}f=null;h=false;c(e)}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){t[i-1]=arguments[i]}}u.push(new g(e,t));if(u.length===1&&!h){l(m)}};function g(e,t){this.fun=e;this.array=t}g.prototype.run=function(){this.fun.apply(null,this.array)};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function y(){}n.on=y;n.addListener=y;n.once=y;n.off=y;n.removeListener=y;n.removeAllListeners=y;n.emit=y;n.prependListener=y;n.prependOnceListener=y;n.listeners=function(e){return[]};n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],38:[function(e,I,P){(function(G){(function(){(function(e){var t=typeof P=="object"&&P&&!P.nodeType&&P;var i=typeof I=="object"&&I&&!I.nodeType&&I;var n=typeof G=="object"&&G;if(n.global===n||n.window===n||n.self===n){e=n}var r,y=2147483647,v=36,b=1,x=26,s=38,o=700,w=72,_=128,S="-",a=/^xn--/,l=/[^\x20-\x7E]/,c=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},h=v-b,k=Math.floor,E=String.fromCharCode,f;function j(e){throw new RangeError(u[e])}function d(e,t){var i=e.length;var n=[];while(i--){n[i]=t(e[i])}return n}function p(e,t){var i=e.split("@");var n="";if(i.length>1){n=i[0]+"@";e=i[1]}e=e.replace(c,".");var r=e.split(".");var s=d(r,t).join(".");return n+s}function T(e){var t=[],i=0,n=e.length,r,s;while(i<n){r=e.charCodeAt(i++);if(r>=55296&&r<=56319&&i<n){s=e.charCodeAt(i++);if((s&64512)==56320){t.push(((r&1023)<<10)+(s&1023)+65536)}else{t.push(r);i--}}else{t.push(r)}}return t}function g(e){return d(e,function(e){var t="";if(e>65535){e-=65536;t+=E(e>>>10&1023|55296);e=56320|e&1023}t+=E(e);return t}).join("")}function C(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return v}function L(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function A(e,t,i){var n=0;e=i?k(e/o):e>>1;e+=k(e/t);for(;e>h*x>>1;n+=v){e=k(e/h)}return k(n+(h+1)*e/(e+s))}function m(e){var t=[],i=e.length,n,r=0,s=_,o=w,a,l,c,u,h,f,d,p,m;a=e.lastIndexOf(S);if(a<0){a=0}for(l=0;l<a;++l){if(e.charCodeAt(l)>=128){j("not-basic")}t.push(e.charCodeAt(l))}for(c=a>0?a+1:0;c<i;){for(u=r,h=1,f=v;;f+=v){if(c>=i){j("invalid-input")}d=C(e.charCodeAt(c++));if(d>=v||d>k((y-r)/h)){j("overflow")}r+=d*h;p=f<=o?b:f>=o+x?x:f-o;if(d<p){break}m=v-p;if(h>k(y/m)){j("overflow")}h*=m}n=t.length+1;o=A(r-u,n,u==0);if(k(r/n)>y-s){j("overflow")}s+=k(r/n);r%=n;t.splice(r++,0,s)}return g(t)}function M(e){var t,i,n,r,s,o,a,l,c,u,h,f=[],d,p,m,g;e=T(e);d=e.length;t=_;i=0;s=w;for(o=0;o<d;++o){h=e[o];if(h<128){f.push(E(h))}}n=r=f.length;if(r){f.push(S)}while(n<d){for(a=y,o=0;o<d;++o){h=e[o];if(h>=t&&h<a){a=h}}p=n+1;if(a-t>k((y-i)/p)){j("overflow")}i+=(a-t)*p;t=a;for(o=0;o<d;++o){h=e[o];if(h<t&&++i>y){j("overflow")}if(h==t){for(l=i,c=v;;c+=v){u=c<=s?b:c>=s+x?x:c-s;if(l<u){break}g=l-u;m=v-u;f.push(E(L(u+g%m,0)));l=k(g/m)}f.push(E(L(l,0)));s=A(i,p,n==r);i=0;++n}}++i;++t}return f.join("")}function O(e){return p(e,function(e){return a.test(e)?m(e.slice(4).toLowerCase()):e})}function $(e){return p(e,function(e){return l.test(e)?"xn--"+M(e):e})}r={version:"1.4.1",ucs2:{decode:T,encode:g},decode:m,encode:M,toASCII:$,toUnicode:O};if(typeof B=="function"&&typeof B.amd=="object"&&B.amd){B("punycode",function(){return r})}else if(t&&i){if(I.exports==t){i.exports=r}else{for(f in r){r.hasOwnProperty(f)&&(t[f]=r[f])}}}else{e.punycode=r}})(this)}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],39:[function(e,t,i){"use strict";function m(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,i,n){t=t||"&";i=i||"=";var r={};if(typeof e!=="string"||e.length===0){return r}var s=/\+/g;e=e.split(t);var o=1e3;if(n&&typeof n.maxKeys==="number"){o=n.maxKeys}var a=e.length;if(o>0&&a>o){a=o}for(var l=0;l<a;++l){var c=e[l].replace(s,"%20"),u=c.indexOf(i),h,f,d,p;if(u>=0){h=c.substr(0,u);f=c.substr(u+1)}else{h=c;f=""}d=decodeURIComponent(h);p=decodeURIComponent(f);if(!m(r,d)){r[d]=p}else if(g(r[d])){r[d].push(p)}else{r[d]=[r[d],p]}}return r};var g=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],40:[function(e,t,i){"use strict";var s=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(i,n,r,e){n=n||"&";r=r||"=";if(i===null){i=undefined}if(typeof i==="object"){return a(l(i),function(e){var t=encodeURIComponent(s(e))+r;if(o(i[e])){return a(i[e],function(e){return t+encodeURIComponent(s(e))}).join(n)}else{return t+encodeURIComponent(s(i[e]))}}).join(n)}if(!e)return"";return encodeURIComponent(s(e))+r+encodeURIComponent(s(i))};var o=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function a(e,t){if(e.map)return e.map(t);var i=[];for(var n=0;n<e.length;n++){i.push(t(e[n],n))}return i}var l=Object.keys||function(e){var t=[];for(var i in e){if(Object.prototype.hasOwnProperty.call(e,i))t.push(i)}return t}},{}],41:[function(e,t,i){"use strict";i.decode=i.parse=e("./decode");i.encode=i.stringify=e("./encode")},{"./decode":39,"./encode":40}],42:[function(e,t,i){(function(v,e){(function(){(function(i,n){"use strict";if(i.setImmediate){return}var r=1;var s={};var o=false;var a=i.document;var l;function e(e){if(typeof e!=="function"){e=new Function(""+e)}var t=new Array(arguments.length-1);for(var i=0;i<t.length;i++){t[i]=arguments[i+1]}var n={callback:e,args:t};s[r]=n;l(r);return r++}function c(e){delete s[e]}function u(e){var t=e.callback;var i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i);break}}function h(e){if(o){setTimeout(h,0,e)}else{var t=s[e];if(t){o=true;try{u(t)}finally{c(e);o=false}}}}function t(){l=function(e){v.nextTick(function(){h(e)})}}function f(){if(i.postMessage&&!i.importScripts){var e=true;var t=i.onmessage;i.onmessage=function(){e=false};i.postMessage("","*");i.onmessage=t;return e}}function d(){var t="setImmediate$"+Math.random()+"$";var e=function(e){if(e.source===i&&typeof e.data==="string"&&e.data.indexOf(t)===0){h(+e.data.slice(t.length))}};if(i.addEventListener){i.addEventListener("message",e,false)}else{i.attachEvent("onmessage",e)}l=function(e){i.postMessage(t+e,"*")}}function p(){var t=new MessageChannel;t.port1.onmessage=function(e){var t=e.data;h(t)};l=function(e){t.port2.postMessage(e)}}function m(){var i=a.documentElement;l=function(e){var t=a.createElement("script");t.onreadystatechange=function(){h(e);t.onreadystatechange=null;i.removeChild(t);t=null};i.appendChild(t)}}function g(){l=function(e){setTimeout(h,0,e)}}var y=Object.getPrototypeOf&&Object.getPrototypeOf(i);y=y&&y.setTimeout?y:i;if({}.toString.call(i.process)==="[object process]"){t()}else if(f()){d()}else if(i.MessageChannel){p()}else if(a&&"onreadystatechange"in a.createElement("script")){m()}else{g()}y.setImmediate=e;y.clearImmediate=c})(typeof self==="undefined"?typeof e==="undefined"?this:e:self)}).call(this)}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:37}],43:[function(e,t,i){"use strict";const r=e("./seventh.js");function n(e,t=4){this.jobRunner=e;this.jobs=new Map;this.pendingJobs=new Map;this.runningJobs=new Map;this.errorJobs=new Map;this.jobsDone=new Map;this.concurrency=+t||1;this.isQueueRunning=true;this.isLoopRunning=false;this.canLoopAgain=false;this.ready=r.resolved;this.startTime=null;this.endTime=null;this.drained=r.resolved;this.idle=r.resolved}r.Queue=n;function s(e,t=null,i=undefined){this.id=e;this.dependencies=t===null?null:[...t];this.data=i===undefined?e:i;this.error=null;this.startTime=null;this.endTime=null}n.Job=s;n.prototype.setConcurrency=function(e){this.concurrency=+e||1};n.prototype.stop=n.prototype.pause=function(){this.isQueueRunning=false};n.prototype.has=function(e){return this.jobs.has(e)};n.prototype.add=n.prototype.addJob=function(e,t,i=null){if(this.jobs.has(e)){return false}var n=new s(e,i,t);this.jobs.set(e,n);this.pendingJobs.set(e,n);this.canLoopAgain=true;if(this.isQueueRunning&&!this.isLoopRunning){this.run()}if(this.drained.isSettled()){this.drained=new r}return n};n.prototype.addBatch=n.prototype.addJobBatch=function(e){var t,i;for(t of e){if(this.jobs.has(t)){return false}i=new s(t);this.jobs.set(t,i);this.pendingJobs.set(t,i)}this.canLoopAgain=true;if(this.isQueueRunning&&!this.isLoopRunning){this.run()}if(this.drained.isSettled()){this.drained=new r}};n.prototype.run=n.prototype.resume=async function(){var e;this.isQueueRunning=true;if(this.isLoopRunning){return}this.isLoopRunning=true;if(!this.startTime){this.startTime=Date.now()}do{this.canLoopAgain=false;for(e of this.pendingJobs.values()){if(e.dependencies&&e.dependencies.some(e=>!this.jobsDone.has(e))){continue}if(this.idle.isSettled()){this.idle=new r}this.canLoopAgain=true;await this.ready;if(!this.isQueueRunning){this.finishRun();return}this.runJob(e)}}while(this.canLoopAgain);this.finishRun()};n.prototype.finishRun=function(){this.isLoopRunning=false;if(!this.pendingJobs.size){this.drained.resolve()}if(!this.runningJobs.size){this.endTime=Date.now();this.idle.resolve()}};n.prototype.runJob=async function(t){this.pendingJobs.delete(t.id);this.runningJobs.set(t.id,t);if(this.runningJobs.size>=this.concurrency){this.ready=new r}try{t.startTime=Date.now();await this.jobRunner(t.data);t.endTime=Date.now();this.jobsDone.set(t.id,t);this.canLoopAgain=true}catch(e){t.endTime=Date.now();t.error=e;this.errorJobs.set(t.id,t)}this.runningJobs.delete(t.id);if(this.runningJobs.size<this.concurrency){this.ready.resolve()}if(!this.isLoopRunning){if(this.isQueueRunning&&this.pendingJobs.size){this.run()}else{this.finishRun()}}};n.prototype.getJobTimes=function(){var e,t={};for(e of this.jobsDone.values()){t[e.id]=e.endTime-e.startTime}return t};n.prototype.getStats=function(){var e,t=0,i={pending:this.pendingJobs.size,running:this.runningJobs.size,failed:this.errorJobs.size,done:this.jobsDone.size,averageJobTime:null,queueTime:null};if(this.jobsDone.size){for(e of this.jobsDone.values()){t+=e.endTime-e.startTime}i.averageJobTime=t/this.jobsDone.size}if(this.endTime){i.queueTime=this.endTime-this.startTime}return i}},{"./seventh.js":50}],44:[function(e,t,i){"use strict";const o=e("./seventh.js");o.promisifyNodeApi=(n,r,s,e,t)=>{var i;r=r||"Async";s=s||"AsyncAll";e=e||(e=>e[0]!=="_"&&!e.endsWith("Sync"));if(t){i=[];for(let e in n){if(typeof n[e]==="function"){i.push(e)}}}else{i=Object.keys(n)}i.filter(t=>{if(typeof n[t]!=="function"){return false}for(let e in n[t].prototype){return false}return e(t,n)}).forEach(e=>{const t=e+r;const i=e+s;if(!n[t]){n[t]=o.promisify(n[e],n)}if(!n[i]){n[i]=o.promisifyAll(n[e],n)}})};o.promisifyAnyNodeApi=(e,t,i,n)=>{o.promisifyNodeApi(e,t,i,n,true)}},{"./seventh.js":50}],45:[function(e,t,i){"use strict";const p=e("./seventh.js");const u={};function h(){}p.all=e=>{var i=-1,n=false,r=0,s=Infinity,o,a=[],l=new p;for(o of e){if(n){break}i++;(()=>{const t=i;p.resolve(o).then(e=>{if(n){return}a[t]=e;r++;if(r>=s){n=true;l._resolveValue(a)}},e=>{if(n){return}n=true;l.reject(e)})})()}s=i+1;if(!s){l._resolveValue(a)}return l};p._allArray=e=>{var t=e.length;if(!t){p._resolveValue([])}var i,n={settled:false,count:0,length:t,values:[],allPromise:new p};for(i=0;!n.settled&&i<t;i++){p._allArrayOne(e[i],i,n)}return n.allPromise};p._allArrayOne=(e,t,i)=>{p._bareThen(e,e=>{if(i.settled){return}i.values[t]=e;i.count++;if(i.count>=i.length){i.settled=true;i.allPromise._resolveValue(i.values)}},e=>{if(i.settled){return}i.settled=true;i.allPromise.reject(e)})};p.every=p.map=(e,i)=>{var n=-1,r=false,s=0,o=Infinity,a,l=[],c=new p;for(a of e){if(r){break}n++;(()=>{const t=n;p.resolve(a).then(e=>{if(r){return}return i(e,t)}).then(e=>{if(r){return}l[t]=e;s++;if(s>=o){r=true;c._resolveValue(l)}},e=>{if(r){return}r=true;c.reject(e)})})()}o=n+1;if(!o){c._resolveValue(l)}return c};p.any=e=>{var i=-1,n=false,r=0,s=Infinity,o,a=[],l=new p;for(o of e){if(n){break}i++;(()=>{const t=i;p.resolve(o).then(e=>{if(n){return}n=true;l._resolveValue(e)},e=>{if(n){return}a[t]=e;r++;if(r>=s){n=true;l.reject(a)}})})()}s=i+1;if(!s){l.reject(new RangeError("Promise.any(): empty array"))}return l};p.some=(e,i)=>{var n=-1,r=false,s=0,o=Infinity,a,l=[],c=new p;for(a of e){if(r){break}n++;(()=>{const t=n;p.resolve(a).then(e=>{if(r){return}return i(e,t)}).then(e=>{if(r){return}r=true;c._resolveValue(e)},e=>{if(r){return}l[t]=e;s++;if(s>=o){r=true;c.reject(l)}})})()}o=n+1;if(!o){c.reject(new RangeError("Promise.any(): empty array"))}return c};p.filter=(e,i)=>{var n=-1,r=false,s=0,o=Infinity,a,l=[],c=new p;for(a of e){if(r){break}n++;(()=>{const t=n;p.resolve(a).then(e=>{if(r){return}l[t]=e;return i(e,t)}).then(e=>{if(r){return}s++;if(!e){l[t]=u}if(s>=o){r=true;l=l.filter(e=>e!==u);c._resolveValue(l)}},e=>{if(r){return}r=true;c.reject(e)})})()}o=n+1;if(!o){c._resolveValue(l)}else if(s>=o){r=true;l=l.filter(e=>e!==u);c._resolveValue(l)}return c};p.foreach=p.forEach=function(e,n,t){var r=-1,s=arguments.length>=3,o=e[Symbol.iterator](),a=new p,l=p.resolve(t);if(p.warnUnhandledRejection){p._handleAll(e)}var c=()=>{l.then(t=>{let{value:e,done:i}=o.next();r++;if(i){a.resolve(t)}else{l=p.resolve(e).then(s?e=>n(t,e,r):e=>n(e,r));c()}},e=>{a.reject(e);for(;;){let{value:e,done:t}=o.next();if(t){break}if(p.isThenable(e)){e.then(h,h)}}})};c();return a};p.reduce=(e,t,i)=>{return p.forEach(e,t,i)};p.mapObject=(e,i)=>{var n=false,r=0,t,s,o=Object.keys(e),a=o.length,l,c={},u=new p;for(t=0;!n&&t<a;t++){s=o[t];l=e[s];(()=>{const t=s;p.resolve(l).then(e=>{if(n){return}return i(e,t)}).then(e=>{if(n){return}c[t]=e;r++;if(r>=a){n=true;u._resolveValue(c)}},e=>{if(n){return}n=true;u.reject(e)})})()}if(!a){u._resolveValue(c)}return u};p.concurrent=(i,e,n)=>{var r=-1,s=false,o=0,a=0,l=Infinity,c,t=false,u=[],h=e[Symbol.iterator](),f=new p;if(p.warnUnhandledRejection){p._handleAll(e)}i=+i||1;const d=()=>{while(!t&&o<i){({value:c,done:t}=h.next());if(t){l=r+1;if(a>=l){s=true;f._resolveValue(u);return}break}if(s){break}r++;(()=>{const t=r;o++;p.resolve(c).then(e=>{if(s){return}return n(e,t)}).then(e=>{if(s){return}u[t]=e;a++;o--;if(a>=l){s=true;f._resolveValue(u);return}if(o<i){d();return}},e=>{if(s){return}s=true;f.reject(e)})})()}};d();if(r<0){f._resolveValue(u)}return f};p.race=e=>{var t=false,i,n=new p;for(i of e){if(t){break}p.resolve(i).then(e=>{if(t){return}t=true;n._resolveValue(e)},e=>{if(t){return}t=true;n.reject(e)})}return n}},{"./seventh.js":50}],46:[function(o,a,e){(function(t,i,s){(function(){"use strict";const e=i.Promise;var n;if(!t.browser){n=t.nextTick}else{o("setimmediate");n=s}function r(e){this.fn=e;this._then=r._dormantThen;this.value=null;this.thenHandlers=null;this.handledRejection=null;if(this.fn){this._exec()}}a.exports=r;r.Native=e;r.warnUnhandledRejection=true;r.prototype._exec=function(){this._then=r._pendingThen;try{this.fn(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};r.prototype.resolve=r.prototype.fulfill=function(e){if(this._then.settled){return this}if(r.isThenable(e)){this._execThenPromise(e);return this}return this._resolveValue(e)};r.prototype._resolveValue=function(e){this._then=r._fulfilledThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execFulfillHandlers()}return this};r.prototype._execThenPromise=function(e){try{e.then(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};r.prototype.reject=function(e){if(this._then.settled){return this}this._then=r._rejectedThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execRejectionHandlers()}else if(r.warnUnhandledRejection&&!this.handledRejection){this._unhandledRejection()}return this};r.prototype._execFulfillHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+1]){this._execOneFulfillHandler(this.thenHandlers[e],this.thenHandlers[e+1])}else{this.thenHandlers[e].resolve(this.value)}}};r.prototype._execOneFulfillHandler=function(t,e){try{t.resolve(e(this.value))}catch(e){t.reject(e)}};r.prototype._execRejectionHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+2]){this._execOneRejectHandler(this.thenHandlers[e],this.thenHandlers[e+2])}else{this.thenHandlers[e].reject(this.value)}}};r.prototype._execOneRejectHandler=function(t,e){try{t.resolve(e(this.value))}catch(e){t.reject(e)}};r.prototype.resolveTimeout=r.prototype.fulfillTimeout=function(e,t){setTimeout(()=>this.resolve(t),e)};r.prototype.rejectTimeout=function(e,t){setTimeout(()=>this.reject(t),e)};r._dormantThen=function(e,t){if(this.fn){this._exec();return this._then(e,t)}var i=new r;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};r._dormantThen.settled=false;r._pendingThen=function(e,t){var i=new r;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};r._pendingThen.settled=false;r._fulfilledThen=function(e){if(!e){return this}var t=new r;n(()=>{try{t.resolve(e(this.value))}catch(e){t.reject(e)}});return t};r._fulfilledThen.settled=true;r._rejectedThen=function(e,t){if(!t){return this}this.handledRejection=true;var i=new r;n(()=>{try{i.resolve(t(this.value))}catch(e){i.reject(e)}});return i};r._rejectedThen.settled=true;r.prototype.then=function(e,t){return this._then(e,t)};r.prototype.catch=function(e=()=>undefined){return this._then(undefined,e)};r.prototype.finally=function(e){return this._then(e,e)};r.prototype.tap=r.prototype.tapThen=function(e){this._then(e,undefined);return this};r.prototype.tapCatch=function(e){this._then(undefined,e);return this};r.prototype.tapFinally=function(e){this._then(e,e);return this};r.prototype.fatal=function(){this._then(undefined,e=>{n(()=>{throw e})})};r.prototype.done=function(e,t){this._then(e,t).fatal();return this};r.prototype.callback=function(t){this._then(e=>{t(undefined,e)},e=>{t(e)}).fatal();return this};r.prototype.callbackAll=function(t){this._then(e=>{if(Array.isArray(e)){t(undefined,...e)}else{t(undefined,e)}},e=>{t(e)}).fatal();return this};r.callback=function(e){return new r((i,n)=>{e((e,t)=>{if(e){n(e)}else{i(t)}})})};r.callbackAll=function(e){return new r((i,n)=>{e((e,...t)=>{if(e){n(e)}else{i(t)}})})};r.prototype.toPromise=r.prototype.propagate=function(t){this._then(e=>{t.resolve(e)},e=>{t.reject(e)});return this};r.propagate=function(e,t){e.then(e=>{t.resolve(e)},e=>{t.reject(e)});return e};r.finally=function(e,t){return e.then(t,t)};r.resolve=r.fulfill=function(e){if(r.isThenable(e)){return r.fromThenable(e)}return r._resolveValue(e)};r._resolveValue=function(e){var t=new r;t._then=r._fulfilledThen;t.value=e;return t};r.reject=function(e){var t=new r;t._then=r._rejectedThen;t.value=e;return t};r.resolveTimeout=r.fulfillTimeout=function(t,i){return new r(e=>setTimeout(()=>e(i),t))};r.rejectTimeout=function(i,n){return new r((e,t)=>setTimeout(()=>t(n),i))};r.resolveNextTick=r.fulfillNextTick=function(t){return new r(e=>n(()=>e(t)))};r.rejectNextTick=function(i){return new r((e,t)=>n(()=>t(i)))};r.dormant=function(e){var t=new r;t.fn=e;return t};r.try=function(e){try{return r.resolve(e())}catch(e){return r.reject(e)}};r.isThenable=function(e){return e&&typeof e==="object"&&typeof e.then==="function"};r.fromThenable=function(e){if(e instanceof r){return e}return new r((t,i)=>{e.then(e=>{t(e)},e=>{i(e)})})};r._bareThen=function(e,t,i){if(e&&typeof e==="object"){if(e instanceof r){if(e._then===r._fulfilledThen){t(e.value)}else if(e._then===r._rejectedThen){i(e.value)}else{e._then(t,i)}}else if(typeof e.then==="function"){e.then(t,i)}else{t(e)}}else{t(e)}};r._handleAll=function(e){var t;for(t of e){if(r.isThenable(t)){t.handledRejection=true}}};r.prototype._unhandledRejection=function(){this.handledRejection=false;const t=e=>setTimeout(e,0);if(this.value instanceof Error){t(()=>{if(this.handledRejection===false){this.value.message="Unhandled promise rejection: "+this.value.message;console.error(this.value)}})}else{let e=new Error("Unhandled promise rejection");t(()=>{if(this.handledRejection===false){console.error(e);console.error("Rejection reason:",this.value)}})}};r.prototype.isSettled=function(){return this._then.settled};r.prototype.getStatus=function(){switch(this._then){case r._dormantThen:return"dormant";case r._pendingThen:return"pending";case r._fulfilledThen:return"fulfilled";case r._rejectedThen:return"rejected"}};r.prototype.inspect=function(){switch(this._then){case r._dormantThen:return"Promise { <DORMANT> }";case r._pendingThen:return"Promise { <PENDING> }";case r._fulfilledThen:return"Promise { <FULFILLED> "+this.value+" }";case r._rejectedThen:return"Promise { <REJECTED> "+this.value+" }"}};r.resolved=r.dummy=r.resolve();if(t.browser){r.prototype.resolveAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.resolve(e))};r.prototype.rejectAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.reject(e))};r.resolveAtAnimationFrame=function(t){return new r(e=>window.requestAnimationFrame(()=>e(t)))};r.rejectAtAnimationFrame=function(i){return new r((e,t)=>window.requestAnimationFrame(()=>t(i)))}}}).call(this)}).call(this,o("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},o("timers").setImmediate)},{_process:37,setimmediate:42,timers:74}],47:[function(e,t,i){"use strict";const c=e("./seventh.js");c.promisifyAll=(t,r)=>{if(r){return(...e)=>{return new c((i,n)=>{t.call(r,...e,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}n(e)}else{i(t)}})})}}return function(...e){return new c((i,n)=>{t.call(this,...e,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}n(e)}else{i(t)}})})}};c.promisify=(t,r)=>{if(r){return(...e)=>{return new c((i,n)=>{t.call(r,...e,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}n(e)}else{i(t)}})})}}return function(...e){return new c((i,n)=>{t.call(this,...e,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}n(e)}else{i(t)}})})}};c.returnValueInterceptor=(i,n,r)=>{return function(...e){var t=n.call(r||this,...e);i(t);return t}};c.once=(t,i)=>{var n=false;var r;return function(...e){if(!n){n=true;r=t.call(i||this,...e)}return r}};c.serialize=(i,n)=>{var r=new c.resolve;return function(...e){var t=new c;r.finally(()=>{c.propagate(i.call(n||this,...e),t)});r=t;return t}};c.debounce=(t,i)=>{var n=null;const r=()=>{n=null};return function(...e){if(n){return n}n=t.call(i||this,...e);c.finally(n,r);return n}};c.debounceDelay=(e,t,i)=>{var n=null;const r=()=>{setTimeout(()=>n=null,e)};return function(...e){if(n){return n}n=t.call(i||this,...e);c.finally(n,r);return n}};c.debounceUpdate=(i,n)=>{var r=null;var s=null;var o=null;const a=()=>{var e,t;r=null;if(s){e=s;s=null;t=o;o=null;r=i.call(...e);c.propagate(r,t);c.finally(r,a);return r}};return function(...e){var t=n||this;if(r){if(!o){o=new c}s=[t,...e];return o}r=i.call(t,...e);c.finally(r,a);return r}};c.NO_DELAY={};c.BATCH_NO_DELAY={};c.debounceSync=(s,o)=>{var i=new Map;const a=e=>{var t=i.get(e);if(!t){t={inProgress:null,inProgressIsFull:null,last:null,lastTime:null,lastFullSync:null,lastFullSyncTime:null,nextFullSyncPromise:null,nextFullSyncWith:null,noDelayBatches:new Set};i.set(e,t)}return t};const l=(e,t)=>{var i,n,r,s=new Date;e.inProgress=null;if(t>=2){e.lastFullSyncTime=e.lastTime=s}else if(t>=1){e.lastTime=s}if(e.nextFullSyncWith){if(o.delay&&e.lastFullSyncTime&&(i=s-e.lastFullSyncTime-o.delay)<0){e.inProgress=c.resolveTimeout(-i+1);e.inProgress.finally(()=>l(e,0));return e.nextFullSyncPromise}n=e.nextFullSyncWith;e.nextFullSyncWith=null;r=e.nextFullSyncPromise;e.nextFullSyncPromise=null;e.lastFullSync=e.last=e.inProgress=o.fn.call(...n);c.propagate(e.inProgress,r);c.finally(e.inProgress,()=>l(e,2));return e.inProgress}};const e=function(e,...t){var i=false,n=s.thisBinding||this,r=a(e);if(t[0]===c.NO_DELAY){i=true;t.shift()}else if(t[0]===c.BATCH_NO_DELAY){t.shift();let e=t.shift();if(!r.noDelayBatches.has(e)){r.noDelayBatches.add(e);i=true}}if(r.inProgress){return r.inProgress}if(!i&&s.delay&&r.lastTime&&new Date-r.lastTime<s.delay){if(typeof s.onDebounce==="function"){s.onDebounce(e,...t)}return r.last}r.last=r.inProgress=s.fn.call(n,e,...t);r.inProgressIsFull=false;c.finally(r.inProgress,()=>l(r,1));return r.inProgress};const t=function(e,...t){var i,n=false,r=o.thisBinding||this,s=a(e);if(t[0]===c.NO_DELAY){n=true;t.shift()}else if(t[0]===c.BATCH_NO_DELAY){t.shift();let e=t.shift();if(!s.noDelayBatches.has(e)){s.noDelayBatches.add(e);n=true}}if(!s.inProgress&&!n&&o.delay&&s.lastFullSyncTime&&(i=new Date-s.lastFullSyncTime-o.delay)<0){s.inProgress=c.resolveTimeout(-i+1);c.finally(s.inProgress,()=>l(s,0))}if(s.inProgress){if(!s.nextFullSyncPromise){s.nextFullSyncPromise=new c}s.nextFullSyncWith=[r,e,...t];return s.nextFullSyncPromise}s.lastFullSync=s.last=s.inProgress=o.fn.call(r,e,...t);c.finally(s.inProgress,()=>l(s,2));return s.inProgress};return[e,t]};c.timeout=(i,n,r)=>{return function(...e){var t=n.call(r||this,...e);setTimeout(()=>t.reject(new Error("Timeout")),i);return t}};c.variableTimeout=(n,r)=>{return function(e,...t){var i=n.call(r||this,...t);setTimeout(()=>i.reject(new Error("Timeout")),e);return i}}},{"./seventh.js":50}],48:[function(e,t,i){(function(o){(function(){"use strict";const r=e("./seventh.js");var s=false;r.asyncExit=function(i,n){if(s){return}s=true;var e=o.listeners("asyncExit");if(!e.length){o.exit(i);return}if(n===undefined){n=1e3}const t=t=>{if(t.length<3){t(i,n);return r.dummy}return new r(e=>{t(i,n,()=>{e()})})};r.map(e,t).finally(()=>o.exit(i));setTimeout(()=>o.exit(i),n)};r.resolveSafeTimeout=function(t,i){return new r(e=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>e(i),0)},t/2)},t/2)},0)})}}).call(this)}).call(this,e("_process"))},{"./seventh.js":50,_process:37}],49:[function(e,t,i){"use strict";const n=e("./seventh.js");n.parasite=()=>{var e=["tap","tapCatch","finally","fatal","done","callback","callbackAll"];e.forEach(e=>n.Native.prototype[e]=n.prototype[e]);n.Native.prototype._then=n.Native.prototype.then}},{"./seventh.js":50}],50:[function(e,t,i){"use strict";const n=e("./core.js");t.exports=n;e("./batch.js");e("./wrapper.js");e("./decorators.js");e("./Queue.js");e("./api.js");e("./parasite.js");e("./misc.js")},{"./Queue.js":43,"./api.js":44,"./batch.js":45,"./core.js":46,"./decorators.js":47,"./misc.js":48,"./parasite.js":49,"./wrapper.js":51}],51:[function(e,t,i){"use strict";const c=e("./seventh.js");c.timeLimit=(i,n)=>{return new c((e,t)=>{if(typeof n==="function"){n=n()}c.resolve(n).then(e,t);setTimeout(()=>t(new Error("Timeout")),i)})};c.retry=(e,t)=>{var i=e.retries||1,n=e.coolDown||0,r=e.raiseFactor||1,s=e.maxCoolDown||Infinity,o=e.timeout||0,a=e.catch||null;const l=()=>{return(o?c.timeLimit(o,t):t()).catch(e=>{if(!i--){throw e}var t=n;n=Math.min(n*r,s);if(a){return c.resolve(a(e)).then(()=>c.resolveTimeout(t).then(l))}return c.resolveTimeout(t).then(l)})};return l()};c.onceEvent=(t,i)=>{return new c(e=>t.once(i,e))};c.onceEventAll=(e,i)=>{return new c(t=>e.once(i,(...e)=>t(e)))};c.onceEventOrError=(a,l,e,i=false)=>{return new c((t,n)=>{var r;var s=(...e)=>{a.removeListener("error",o);if(r){for(let e in r){a.removeListener(e,r[e])}}t(i?e:e[0])};var o=e=>{a.removeListener(l,s);if(r){for(let e in r){a.removeListener(e,r[e])}}n(e)};a.once(l,s);a.once("error",o);if(e){if(!Array.isArray(e)){e=[e]}r={};e.forEach(i=>{var e=(...e)=>{a.removeListener("error",o);a.removeListener(l,s);var t=new Error("Received an excluded event: "+i);t.event=i;t.eventArgs=e;n(t)};a.once(i,e);r[i]=e})}})};c.onceEventAllOrError=(e,t,i)=>{return c.onceEventOrError(e,t,i,true)}},{"./seventh.js":50}],52:[function(e,t,l){"use strict";const c=e("kung-fig-expression/lib/getNamedParameters.js");l["^°"]=(e,t,i=10)=>i*Math.pow(e/i,t);const u=2*Math.PI*(1-((1+Math.sqrt(5))/2-1));const h=["n","distance","x-offset","y-offset","order-by","farthest-angle-deg"];l["sunflower-spread"]=(...e)=>{var t=c(e,h,{n:0,distance:1,"x-offset":0,"y-offset":0,"order-by":null});var i,n,r,s,o=[];if(typeof t["farthest-angle-deg"]==="number"){s=t["farthest-angle-deg"]*Math.PI/180-(t.n-1)*u}else{s=Math.random()*2*Math.PI}i=t.distance;o.push({x:t["x-offset"]+i*Math.cos(s),y:t["y-offset"]+i*Math.sin(s)});for(r=1;r<t.n;r++){n=s+r*u;i=t.distance*Math.sqrt(r);o.push({x:t["x-offset"]+i*Math.cos(n),y:t["y-offset"]+i*Math.sin(n)})}if(!t["order-by"]){return o}var a=o[o.length-1];switch(t["order-by"]){case"distance-from-farthest":a.delta=0;for(r=o.length-2;r>=0;r--){o[r].delta=Math.sqrt((o[r].x-a.x)**2+(o[r].y-a.y)**2)}o.sort((e,t)=>t.delta-e.delta);break}return o};const i=Math.PI/2;function n(e,t){return 1-t(1-e)}function r(e,t){return e<.5?(1-t(1-2*e))/2:(1+t(2*e-1))/2}l["ease-linear"]=l["ease-linear"]=e=>e;l["ease-sine"]=l["ease-in-out-sine"]=e=>(1-Math.cos(Math.PI*e))/2;l["ease-in-sine"]=e=>1-Math.cos(i*e);l["ease-out-sine"]=e=>Math.sin(i*e);l["ease-quadratic"]=l["ease-in-quadratic"]=e=>e*e;l["ease-out-quadratic"]=e=>1-(1-e)*(1-e);l["ease-in-out-quadratic"]=e=>e<.5?2*e*e:1-2*(1-e)*(1-e);l["ease-cubic"]=l["ease-in-cubic"]=e=>e*e*e;l["ease-out-cubic"]=e=>1-(1-e)*(1-e)*(1-e);l["ease-in-out-cubic"]=e=>e<.5?4*e*e*e:1-4*(1-e)*(1-e)*(1-e);l["ease-quartic"]=l["ease-in-quartic"]=e=>e*e*e*e;l["ease-out-quartic"]=e=>1-(1-e)*(1-e)*(1-e)*(1-e);l["ease-in-out-quartic"]=e=>e<.5?8*e*e*e*e:1-8*(1-e)*(1-e)*(1-e)*(1-e);l["ease-quintic"]=l["ease-in-quintic"]=e=>e*e*e*e*e;l["ease-out-quintic"]=e=>1-(1-e)*(1-e)*(1-e)*(1-e)*(1-e);l["ease-in-out-quintic"]=e=>e<.5?16*e*e*e*e*e:1-16*(1-e)*(1-e)*(1-e)*(1-e)*(1-e);l["ease-in-circular"]=e=>1-Math.sqrt(1-e*e);l["ease-out-circular"]=e=>Math.sqrt(1-(1-e)*(1-e));l["ease-in-out-circular"]=e=>e<.5?1-Math.sqrt(1-4*e*e):-Math.sqrt(1-4*(1-e)*(1-e));const s=1.70158;const o=s*1.525;const a=s+1;l["ease-in-back"]=e=>a*e*e*e-s*e*e;l["ease-out-back"]=e=>1-(a*(1-e)*(1-e)*(1-e)-s*(1-e)*(1-e));l["ease-in-out-back"]=e=>e<.5?2*e*e*(2*(o+1)*e-o):1-2*(1-e)*(1-e)*(2*(o+1)*(1-e)-o);const f=2*Math.PI/3;const d=4*Math.PI/9;l["ease-in-elastic"]=e=>e<=0?0:e>=1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*f);l["ease-out-elastic"]=e=>e<=0?0:e>=1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*f)+1;l["ease-in-out-elastic"]=e=>e<=0?0:e>=1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*d))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*d)/2+1;const p=7.5625;const m=2.75;l["ease-out-bounce"]=e=>e<=0?0:e>=1?1:e<1/m?p*e*e:e<2/m?p*(e-1.5/m)*e-.75:e<2.5/m?p*(e-2.25/m)*e-1.3125:p*(e-2.625/m)*e-1.640625;l["ease-in-bounce"]=e=>n(e,l["ease-out-bounce"]);l["ease-in-out-bounce"]=e=>r(e,l["ease-out-bounce"]);l["parametric-invert"]=e=>1-e;l["parametric-round-trip"]=(e,t=.5)=>e<=t?e/t:1/(1-t)-e/(1-t);l["parametric-round-trip-switch"]=(e,t=.5,i,n)=>{var r;if(e<=t){e=e/t;r=l["ease-"+i];return r?r(e):e}e=1/(1-t)-e/(1-t);r=l["ease-"+n];return r?1-r(1-e):e};const g=1/3;l["parametric-round-trip-with-pauses"]=(e,t=0,i=g,n=g,r=g)=>{if(e<=t){return 0}e-=t;if(e<i){return e/i}e-=i;if(e<=n){return 1}e-=n;if(e<r){return 1-e/r}return 0};l["parametric-round-trip-with-pauses-switch"]=(e,t=0,i=g,n=g,r=g,s,o)=>{var a;if(e<=t){return 0}e-=t;if(e<i){e=e/i;a=l["ease-"+s];return a?a(e):e}e-=i;if(e<=n){return 1}e-=n;if(e<r){e=1-e/r;a=l["ease-"+o];return a?1-a(1-e):e}return 0};for(let e in l){if(!l[e].id){l[e].id=e}}},{"kung-fig-expression/lib/getNamedParameters.js":30}],53:[function(e,t,i){"use strict";function n(e,t=".",i=""){this.sign=1;this.digits=[];this.exposant=0;this.special=null;this.decimalSeparator=t;this.groupSeparator=i;this.set(e)}t.exports=n;n.prototype.set=function(e){var t,i,n,r,s,o,a,l,c;e=+e;if(!Number.isFinite(e)){this.special=e;return null}e=""+e;t=e.match(/(-)?([0-9]+)(?:.([0-9]+))?(?:e([+-][0-9]+))?/);if(!t){throw new Error("Unexpected error")}this.sign=t[1]?-1:1;this.exposant=t[2].length+(parseInt(t[4],10)||0);a=0;l=false;c=0;for(s=0,o=t[2].length;s<o;s++){r=+t[2][s];if(r!==0){l=true;this.digits[a]=r;a++;c=a}else if(l){this.digits[a]=r;a++}else{this.exposant--}}if(t[3]){for(s=0,o=t[3].length;s<o;s++){r=+t[3][s];if(r!==0){l=true;this.digits[a]=r;a++;c=a}else if(l){this.digits[a]=r;a++}else{this.exposant--}}}if(c!==a){this.digits.length=c}};n.prototype.toNumber=function(){if(this.special!==null){return this.special}return parseFloat((this.sign<0?"-":"")+"0."+this.digits.join("")+"e"+this.exposant)};n.prototype.toString=function(...e){if(this.special!==null){return""+this.special}if(this.exposant>20||this.exposant<-20){return this.toScientificString(...e)}return this.toNoExpString(...e)};n.prototype.toExponential=n.prototype.toExponentialString=function(){if(this.special!==null){return""+this.special}var e=this.sign<0?"-":"";if(!this.digits.length){return e+"0"}e+=this.digits[0];if(this.digits.length>1){e+=this.decimalSeparator+this.digits.join("").slice(1)}e+="e"+(this.exposant>0?"+":"")+(this.exposant-1);return e};const r=["⁰","¹","²","³","⁴","⁵","⁶","⁷","⁸","⁹"];const s="⁺";const o="⁻";const a="0".charCodeAt(0);n.prototype.toScientific=n.prototype.toScientificString=function(){if(this.special!==null){return""+this.special}var e=this.sign<0?"-":"";if(!this.digits.length){return e+"0"}e+=this.digits[0];if(this.digits.length>1){e+=this.decimalSeparator+this.digits.join("").slice(1)}var t=(this.exposant<=0?o:"")+(""+Math.abs(this.exposant-1)).split("").map(e=>r[e.charCodeAt(0)-a]).join("");e+=" × 10"+t;return e};n.prototype.toNoExp=n.prototype.toNoExpString=function(e=1,t=0,i=false,n=false,r=this.exposant){if(this.special!==null){return""+this.special}var s=[],o=[],a=this.sign<0?"-":n?"+":"";if(!this.digits.length){h(s,0,e);if(t&&!i){h(o,0,t)}}else if(r<=0){h(s,0,e);h(o,0,-r);f(o,this.digits);if(t&&this.digits.length-r<t){h(o,0,t-this.digits.length+r)}}else if(r>=this.digits.length){if(r<e){h(s,0,e-r)}f(s,this.digits);h(s,0,r-this.digits.length);if(t&&!i){h(o,0,t)}}else{if(r<e){h(s,0,e-r)}f(s,this.digits,0,r);f(o,this.digits,r);if(t&&this.digits.length-r<t&&(!i||this.digits.length-r>0)){h(o,0,t-this.digits.length+r)}}a+=this.groupSeparator?this.groupDigits(s,this.groupSeparator):s.join("");if(o.length){a+=this.decimalSeparator+(this.decimalGroupSeparator?this.groupDigits(o,this.decimalGroupSeparator):o.join(""))}return a};const l=["","k","M","G","T","P","E","Z","Y"];const c=["","m","µ","n","p","f","a","z","y"];n.prototype.toMetric=n.prototype.toMetricString=function(e=1,t=0,i=false,n=false){if(this.special!==null){return""+this.special}if(!this.digits.length){return this.sign>0?"0":"-0"}var r="",s;if(this.exposant>0){s=1+(this.exposant-1)%3;r=l[Math.floor((this.exposant-1)/3)];if(r===undefined){return this.toScientificString()}}else{s=3- -this.exposant%3;r=c[1+Math.floor(-this.exposant/3)];if(r===undefined){return this.toScientificString()}}return this.toNoExpString(e,t,i,n,s)+r};n.prototype.precision=function(i){if(this.special!==null||i>=this.digits.length){return this}if(i<0){this.digits.length=0;return this}if(this.digits[i]>=5){let e=i-1,t=false;for(;e>=0;e--){if(this.digits[e]<9){this.digits[e]++;t=true;break}else{this.digits[e]=0}}if(!t){this.exposant++;this.digits[0]=1;this.digits.length=1}else{this.digits.length=e+1}}else{this.digits.length=i;this.removeTrailingZero()}return this};n.prototype.round=function(e=0){var t=this.exposant+e;return this.precision(t)};n.prototype.removeTrailingZero=function(){var e=this.digits.length-1;while(e>=0&&this.digits[e]===0){e--}this.digits.length=e+1};const u=3;n.prototype.groupDigits=function(e,t,i=false){var n="",r=i?0:u-e.length%u,s=0,o=e.length;for(;s<o;s++){n+=s&&(s+r)%u===0?t+e[s]:e[s]}return n};function h(e,t,i){while(i--){e[e.length]=t}return e}function f(t,i,n=0,r=i.length){for(let e=n;e<r;e++){t[t.length]=i[e]}return t}},{}],54:[function(e,t,i){"use strict";const n={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",inverse:"[7m",defaultColor:"[39m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",grey:"[90m",gray:"[90m",brightBlack:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m",defaultBgColor:"[49m",bgBlack:"[40m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m",bgGrey:"[100m",bgGray:"[100m",bgBrightBlack:"[100m",bgBrightRed:"[101m",bgBrightGreen:"[102m",bgBrightYellow:"[103m",bgBrightBlue:"[104m",bgBrightMagenta:"[105m",bgBrightCyan:"[106m",bgBrightWhite:"[107m"};t.exports=n;n.fgColor={defaultColor:n.defaultColor,black:n.black,red:n.red,green:n.green,yellow:n.yellow,blue:n.blue,magenta:n.magenta,cyan:n.cyan,white:n.white,grey:n.grey,gray:n.gray,brightBlack:n.brightBlack,brightRed:n.brightRed,brightGreen:n.brightGreen,brightYellow:n.brightYellow,brightBlue:n.brightBlue,brightMagenta:n.brightMagenta,brightCyan:n.brightCyan,brightWhite:n.brightWhite};n.bgColor={defaultColor:n.defaultBgColor,black:n.bgBlack,red:n.bgRed,green:n.bgGreen,yellow:n.bgYellow,blue:n.bgBlue,magenta:n.bgMagenta,cyan:n.bgCyan,white:n.bgWhite,grey:n.bgGrey,gray:n.bgGray,brightBlack:n.bgBrightBlack,brightRed:n.bgBrightRed,brightGreen:n.bgBrightGreen,brightYellow:n.bgBrightYellow,brightBlue:n.bgBrightBlue,brightMagenta:n.bgBrightMagenta,brightCyan:n.bgBrightCyan,brightWhite:n.bgBrightWhite};n.trueColor=(t,i,n)=>{if(i===undefined&&typeof t==="string"){let e=t;if(e[0]==="#"){e=e.slice(1)}if(e.length===3){e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}t=parseInt(e.slice(0,2),16)||0;i=parseInt(e.slice(2,4),16)||0;n=parseInt(e.slice(4,6),16)||0}return"[38;2;"+t+";"+i+";"+n+"m"};n.bgTrueColor=(t,i,n)=>{if(i===undefined&&typeof t==="string"){let e=t;if(e[0]==="#"){e=e.slice(1)}if(e.length===3){e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}t=parseInt(e.slice(0,2),16)||0;i=parseInt(e.slice(2,4),16)||0;n=parseInt(e.slice(4,6),16)||0}return"[48;2;"+t+";"+i+";"+n+"m"};const o={0:null,1:{bold:true},2:{dim:true},22:{bold:false,dim:false},3:{italic:true},23:{italic:false},4:{underline:true},24:{underline:false},5:{blink:true},25:{blink:false},7:{inverse:true},27:{inverse:false},8:{hidden:true},28:{hidden:false},9:{strike:true},29:{strike:false},30:{color:0},31:{color:1},32:{color:2},33:{color:3},34:{color:4},35:{color:5},36:{color:6},37:{color:7},39:{color:"default"},90:{color:8},91:{color:9},92:{color:10},93:{color:11},94:{color:12},95:{color:13},96:{color:14},97:{color:15},40:{bgColor:0},41:{bgColor:1},42:{bgColor:2},43:{bgColor:3},44:{bgColor:4},45:{bgColor:5},46:{bgColor:6},47:{bgColor:7},49:{bgColor:"default"},100:{bgColor:8},101:{bgColor:9},102:{bgColor:10},103:{bgColor:11},104:{bgColor:12},105:{bgColor:13},106:{bgColor:14},107:{bgColor:15}};n.parse=e=>{var t,i,n,r,s=[];for([,t,i]of e.matchAll(/\x1b\[([0-9;]+)m|(.[^\x1b]*)/g)){if(i){if(s.length){s[s.length-1].text+=i}else{s.push({text:i})}}else{t.split(";").forEach(e=>{r=o[e];if(r===undefined){return}if(!s.length||s[s.length-1].text){if(!r){n={text:""}}else{n=Object.assign({},n,r);n.text=""}s.push(n)}else{if(!r){s[s.length-1]={text:""}}else{Object.assign(n,r)}}})}}return s}},{}],55:[function(e,t,i){"use strict";i.regExp=i.regExpPattern=e=>e.replace(/([.*+?^${}()|[\]/\\])/g,"\\$1");i.regExpReplacement=e=>e.replace(/\$/g,"$$$$");i.format=e=>e.replace(/%/g,"%%");i.jsSingleQuote=e=>i.control(e).replace(/'/g,"\\'");i.jsDoubleQuote=e=>i.control(e).replace(/"/g,'\\"');i.shellArg=e=>"'"+e.replace(/'/g,"'\\''")+"'";var n={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};i.control=(e,i=false)=>e.replace(/[\x00-\x1f\x7f]/g,e=>{if(i&&(e==="\n"||e==="\t")){return e}if(n[e]!==undefined){return n[e]}var t=e.charCodeAt(0).toString(16);if(t.length%2){t="0"+t}return"\\x"+t});var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};i.html=e=>e.replace(/[&<>]/g,e=>r[e]);i.htmlAttr=e=>e.replace(/[&<>"]/g,e=>r[e]);i.htmlSpecialChars=e=>e.replace(/[&<>"']/g,e=>r[e]);i.unicodePercentEncode=e=>e.replace(/[\x00-\x1f\u0100-\uffff\x7f%]/g,e=>{try{return encodeURI(e)}catch(e){return""}});i.httpHeaderValue=e=>i.unicodePercentEncode(e)},{}],56:[function(T,e,C){(function(j){(function(){"use strict";const f=T("./inspect.js").inspect;const d=T("./inspect.js").inspectError;const t=T("./escape.js");const r=T("./ansi.js");const s=T("./unicode.js");const n=T("./naturalSort.js");const o=T("./StringNumber.js");C.formatMethod=function(...m){var g,e=m[0],y=1,v=m.length;if(typeof e!=="string"){if(!e){e=""}else if(typeof e.toString==="function"){e=e.toString()}else{e=""}}var b={hasMarkup:false,shift:null,markupStack:[]};if(this.markupReset&&this.startingMarkupReset){e=(typeof this.markupReset==="function"?this.markupReset(b.markupStack):this.markupReset)+e}e=e.replace(/\^\[([^\]]*)]?|\^(.)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/g,(e,t,i,n,r,s,o,a)=>{var l,c,u,h,f,d,p=[];if(n){return"%"}if(t){i=t}if(i){if(this.noMarkup){return"^"+i}return x.call(this,b,e,i)}if(s){s=parseInt(s,10);if(r){if(r==="+"){s=y+s}else if(r==="-"){s=y-s}}}else{s=y}y++;if(s>=v||s<1){g=undefined}else{g=m[s]}if(w[a]){l=w[a](g,o,this);if(this.argumentSanitizer&&!w[a].noSanitize){l=this.argumentSanitizer(l)}if(o&&!w[a].noCommonModeArg){l=_(l,o)}return l}if(a==="F"){y--;if(o===undefined){return""}u=o.split(":");h=u[0];f=u[1];if(!h){return""}if(f&&(d=f.match(/%([+-]?)([0-9]*)[a-zA-Z]/g))){for(c=0;c<d.length;c++){r=d[c][1];s=d[c][2];if(s){s=parseInt(s,10);if(r){if(r==="+"){s=y+s}else if(r==="-"){s=y-s}}}else{s=y}y++;if(s>=v||s<1){p[c]=undefined}else{p[c]=m[s]}}}if(!this||!this.fn||typeof this.fn[h]!=="function"){return""}return this.fn[h].apply(this,p)}return""});if(b.hasMarkup&&this.markupReset&&this.endingMarkupReset){e+=typeof this.markupReset==="function"?this.markupReset(b.markupStack):this.markupReset}if(this.extraArguments){for(;y<v;y++){g=m[y];if(g===null||g===undefined){continue}else if(typeof g==="string"){e+=g}else if(typeof g==="number"){e+=g}else if(typeof g.toString==="function"){e+=g.toString()}}}return e};C.markupMethod=function(l){if(typeof l!=="string"){if(!l){l=""}else if(typeof l.toString==="function"){l=l.toString()}else{l=""}}var c={hasMarkup:false,shift:null,markupStack:[]};if(this.parse){let e,t,i,n,r,s,o,a=[];for([i,n,r,s]of l.matchAll(/\^\[([^\]]*)]?|\^(.)|([^^]+)/g)){if(s){if(a.length){a[a.length-1].text+=s}else{a.push({text:s})}continue}if(n){r=n}e=x.call(this,c,i,r);if(!Array.isArray(e)){e=[e]}for(t of e){o=a.length?a[a.length-1]:null;if(typeof t==="string"){if(o){o.text+=t}else{a.push({text:t})}}else if(!t){if(o&&o.text.length&&Object.keys(o).length>1){a.push({text:""})}}else{if(o&&o.text.length){a.push(Object.assign({text:""},...c.markupStack))}else{if(o){Object.assign(o,t)}else{a.push(Object.assign({text:""},t))}}}}}return a}if(this.markupReset&&this.startingMarkupReset){l=(typeof this.markupReset==="function"?this.markupReset(c.markupStack):this.markupReset)+l}l=l.replace(/\^\[([^\]]*)]?|\^(.)/g,(e,t,i)=>x.call(this,c,e,t||i));if(c.hasMarkup&&this.markupReset&&this.endingMarkupReset){l+=typeof this.markupReset==="function"?this.markupReset(c.markupStack):this.markupReset}return l};function x(e,t,i){var n,r,s,o,a;if(i==="^"){return"^"}if(this.shiftMarkup&&this.shiftMarkup[i]){e.shift=this.shiftMarkup[i];return""}if(i.length>1&&this.dataMarkup&&(a=i.indexOf(":"))!==-1){r=i.slice(0,a);n=this.dataMarkup[r];if(n===undefined){if(this.markupCatchAll===undefined){return""}n=this.markupCatchAll}e.hasMarkup=true;s=i.slice(a+1);if(typeof n==="function"){o=n(e.markupStack,r,s)}else{o={[n]:s};l(e,o)}return o}if(e.shift){n=this.shiftedMarkup?.[e.shift]?.[i];e.shift=null}else{n=this.markup?.[i]}if(n===undefined){if(this.markupCatchAll===undefined){return""}n=this.markupCatchAll}e.hasMarkup=true;if(typeof n==="function"){o=n(e.markupStack,i)}else{o=n;l(e,o)}return o}function l(t,i){if(Array.isArray(i)){for(let e of i){if(e===null){t.markupStack.length=0}else{t.markupStack.push(e)}}}else{if(i===null){t.markupStack.length=0}else{t.markupStack.push(i)}}}C.stripMarkup=e=>e.replace(/\^\[[^\]]*]?|\^./g,e=>e==="^^"?"^":e==="^ "?" ":"");const i={argumentSanitizer:e=>t.control(e,true),extraArguments:true,color:false,noMarkup:false,endingMarkupReset:true,startingMarkupReset:false,markupReset:r.reset,shiftMarkup:{"#":"background"},markup:{":":r.reset," ":r.reset+" ","-":r.dim,"+":r.bold,_:r.underline,"/":r.italic,"!":r.inverse,b:r.blue,B:r.brightBlue,c:r.cyan,C:r.brightCyan,g:r.green,G:r.brightGreen,k:r.black,K:r.brightBlack,m:r.magenta,M:r.brightMagenta,r:r.red,R:r.brightRed,w:r.white,W:r.brightWhite,y:r.yellow,Y:r.brightYellow},shiftedMarkup:{background:{":":r.reset," ":r.reset+" ",b:r.bgBlue,B:r.bgBrightBlue,c:r.bgCyan,C:r.bgBrightCyan,g:r.bgGreen,G:r.bgBrightGreen,k:r.bgBlack,K:r.bgBrightBlack,m:r.bgMagenta,M:r.bgBrightMagenta,r:r.bgRed,R:r.bgBrightRed,w:r.bgWhite,W:r.bgBrightWhite,y:r.bgYellow,Y:r.bgBrightYellow}},dataMarkup:{fg:(e,t,i)=>{var n=r.fgColor[i]||r.trueColor(i);e.push(n);return n},bg:(e,t,i)=>{var n=r.bgColor[i]||r.bgTrueColor(i);e.push(n);return n}},markupCatchAll:(e,t,i)=>{var n="";if(i===undefined){if(t[0]==="#"){n=r.trueColor(t)}else if(typeof r[t]==="string"){n=r[t]}}e.push(n);return n}};i.dataMarkup.color=i.dataMarkup.c=i.dataMarkup.fgColor=i.dataMarkup.fg;i.dataMarkup.bgColor=i.dataMarkup.bg;C.createFormatter=e=>C.formatMethod.bind(Object.assign({},i,e));C.format=C.formatMethod.bind(i);C.format.default=i;C.createMarkup=e=>C.markupMethod.bind(Object.assign({},i,e));C.markup=C.markupMethod.bind(i);C.format.count=function(e,t=false){var i,n,r,s=1,o=0;if(typeof e!=="string"){return 0}var a=t?/%([+-]?)([0-9]*)(?:\[[^\]]*\])?[a-zA-EG-Z]/g:/%([+-]?)([0-9]*)(?:\[[^\]]*\])?[a-zA-EG-Z]|(\^\[[^\]]*]?|\^.)/g;for([,r,n,i]of e.matchAll(a)){if(i){continue}if(n){n=parseInt(n,10);if(r){if(r==="+"){n=s+n}else if(r==="-"){n=s-n}}}else{n=s}s++;if(o<n){o=n}}return o};C.format.hasFormatting=function(e){if(e.search(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/)!==-1){return true}return false};const w={};C.format.modes=w;w.s=e=>{if(typeof e==="string"){return e}if(e===null||e===undefined||e===true||e===false){return"("+e+")"}if(typeof e==="number"){return""+e}if(typeof e.toString==="function"){return e.toString()}return"("+e+")"};w.r=e=>w.s(e);w.r.noSanitize=true;w.S=(e,t,i)=>{var n=e=>C.markupMethod.call(i,i.argumentSanitizer?i.argumentSanitizer(e):e);if(typeof e==="string"){return n(e)}if(e===null||e===undefined||e===true||e===false){return"("+e+")"}if(typeof e==="number"){return""+e}if(typeof e.toString==="function"){return n(e.toString())}return n("("+e+")")};w.S.noSanitize=true;w.S.noCommonModeArg=true;w.N=(e,t)=>{if(typeof e==="string"){return e}if(e===null||e===undefined||e===true||e===false){return""+e}if(typeof e==="number"){return w.f(e,".3g ")}if(Array.isArray(e)){e=e.map(e=>w.N(e,true));if(t){return"["+e.join(",")+"]"}return e.join(", ")}if(j.isBuffer(e)){e=[...e].map(e=>{e=e.toString(16);if(e.length===1){e="0"+e}return e});return"<"+e.join(" ")+">"}var i=Object.getPrototypeOf(e);if(i===null||i===Object.prototype){e=Object.entries(e).sort(n).map(e=>e[0]+": "+w.N(e[1],true));if(t){return"{"+e.join(", ")+"}"}return e.join(", ")}if(typeof e.inspect==="function"){return e.inspect()}if(typeof e.toString==="function"){return e.toString()}return"("+e+")"};w.n=e=>w.N(e,true);w.f=(e,t)=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){e=0}var i=y(t),n=new o(e,".",i.groupSeparator);if(i.rounding!==null){n.round(i.rounding)}if(i.precision){n.precision(i.precision)}return n.toString(i.leftPadding,i.rightPadding,i.rightPaddingOnlyIfDecimal)};w.f.noSanitize=true;w.P=(e,t)=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){e=0}e*=100;var i=y(t),n=new o(e,".",i.groupSeparator);if(i.rounding!==null||!i.precision){n.round(i.rounding||0)}if(i.precision){n.precision(i.precision)}return n.toNoExpString(i.leftPadding,i.rightPadding,i.rightPaddingOnlyIfDecimal)+"%"};w.P.noSanitize=true;w.p=(e,t)=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){e=0}e=(e-1)*100;var i=y(t),n=new o(e,".",i.groupSeparator);if(i.rounding!==null||!i.precision){n.round(i.rounding||0)}if(i.precision){n.precision(i.precision)}return n.toNoExpString(i.leftPadding,i.rightPadding,i.rightPaddingOnlyIfDecimal,true)+"%"};w.p.noSanitize=true;w.k=(e,t)=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"0"}var i=y(t),n=new o(e,".",i.groupSeparator);if(i.rounding!==null){n.round(i.rounding)}if(i.precision||i.rounding===null){n.precision(i.precision||3)}return n.toMetricString(i.leftPadding,i.rightPadding,i.rightPaddingOnlyIfDecimal)};w.k.noSanitize=true;w.e=(e,t)=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){e=0}var i=y(t),n=new o(e,".",i.groupSeparator);if(i.rounding!==null){n.round(i.rounding)}if(i.precision){n.precision(i.precision)}return n.toExponential()};w.e.noSanitize=true;w.K=(e,t)=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){e=0}var i=y(t),n=new o(e,".",i.groupSeparator);if(i.rounding!==null){n.round(i.rounding)}if(i.precision){n.precision(i.precision)}return n.toScientific()};w.K.noSanitize=true;w.d=w.i=e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.floor(e)}return"0"};w.i.noSanitize=true;w.u=e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0)}return"0"};w.u.noSanitize=true;w.U=e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),1)}return"1"};w.U.noSanitize=true;w.m=e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"(NaN)"}var t="";if(e<0){t="-";e=-e}var i=E(e),n=e-i;if(!n){return t+i+"°"}var r=E(n*60),s=E(n*3600-r*60);if(s){return t+i+"°"+(""+r).padStart(2,"0")+"′"+(""+s).padStart(2,"0")+"″"}return t+i+"°"+(""+r).padStart(2,"0")+"′"};w.m.noSanitize=true;w.t=e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"(NaN)"}var t=Math.floor(e/1e3);if(t<60){return t+"s"}var i=Math.floor(t/60);t=t%60;if(i<60){return i+"min"+(""+t).padStart(2,"0")+"s"}var n=Math.floor(i/60);i=i%60;return n+"h"+(""+i).padStart(2,"0")+"min"+(""+t).padStart(2,"0")+"s"};w.t.noSanitize=true;w.h=e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(16)}return"0"};w.h.noSanitize=true;w.x=e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"00"}var t=""+Math.max(Math.floor(e),0).toString(16);if(t.length%2){t="0"+t}return t};w.x.noSanitize=true;w.o=e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(8)}return"0"};w.o.noSanitize=true;w.b=e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(2)}return"0"};w.b.noSanitize=true;w.X=e=>{if(typeof e==="string"){e=j.from(e)}else if(!j.isBuffer(e)){return""}return e.toString("hex")};w.X.noSanitize=true;w.z=e=>{if(typeof e==="string"){e=j.from(e)}else if(!j.isBuffer(e)){return""}return e.toString("base64")};w.Z=e=>{if(typeof e==="string"){e=j.from(e)}else if(!j.isBuffer(e)){return""}return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]{1,2}$/g,"")};const a={};w.I=(e,t,i)=>v(e,t,i,a);w.I.noSanitize=true;const c={noFunc:true,enumOnly:true,noDescriptor:true,useInspect:true,useInspectPropertyBlackList:true};w.Y=(e,t,i)=>v(e,t,i,c);w.Y.noSanitize=true;const u={minimal:true,noIndex:true};w.O=(e,t,i)=>v(e,t,i,u);w.O.noSanitize=true;const h={};w.E=(e,t,i)=>v(e,t,i,h,true);w.E.noSanitize=true;w.J=e=>e===undefined?"null":JSON.stringify(e);w.D=()=>"";w.D.noSanitize=true;const p=/([a-zA-Z])(.[^a-zA-Z]*)/g;const m=/([a-zA-Z]|^)(.[^a-zA-Z]*)/g;function _(t,e){var i,n,r;p.lastIndex=0;while(i=p.exec(e)){[,n,r]=i;if(n==="L"){let e=s.width(t);r=+r||1;if(e>r){t=s.truncateWidth(t,r-1).trim()+"…";e=s.width(t)}if(e<r){t=" ".repeat(r-e)+t}}else if(n==="R"){let e=s.width(t);r=+r||1;if(e>r){t=s.truncateWidth(t,r-1).trim()+"…";e=s.width(t)}if(e<r){t=t+" ".repeat(r-e)}}}return t}const g={leftPadding:1,rightPadding:0,rightPaddingOnlyIfDecimal:false,rounding:null,precision:null,groupSeparator:""};function y(e){var t,i,n,r;g.leftPadding=1;g.rightPadding=0;g.rightPaddingOnlyIfDecimal=false;g.rounding=null;g.precision=null;g.groupSeparator="";if(e){m.lastIndex=0;while(t=m.exec(e)){[,i,n]=t;if(i==="z"){g.leftPadding=+n}else if(i==="g"){g.groupSeparator=n||" "}else if(!i){if(n==="g"){g.groupSeparator=" "}else if(n[0]==="."){r=n[n.length-1];if(r==="!"){g.rounding=g.rightPadding=parseInt(n.slice(1,-1),10)||0}else if(r==="?"){g.rounding=g.rightPadding=parseInt(n.slice(1,-1),10)||0;g.rightPaddingOnlyIfDecimal=true}else{g.rounding=parseInt(n.slice(1),10)||0}}else if(n[n.length-1]==="."){g.rounding=-parseInt(n.slice(0,-1),10)||0}else{g.precision=parseInt(n,10)||null}}}}return g}function v(e,t,i,n,r=false){var s,o,a,l,c,u=3,h=i&&i.color?"color":"none";if(t){m.lastIndex=0;while(s=m.exec(t)){[,o,a]=s;if(o==="c"){if(a==="+"){h="color"}else if(a==="-"){h="none"}}else if(o==="l"){l=parseInt(a,10)||undefined}else if(o==="s"){c=parseInt(a,10)||undefined}else if(!o){u=parseInt(a,10)||1}}}if(r){return d(Object.assign({depth:u,style:h,outputMaxLength:l,maxLength:c},n),e)}return f(Object.assign({depth:u,style:h,outputMaxLength:l,maxLength:c},n),e)}const b=1e-10;const S=Math.round(1/b);function k(e){return Math.round(e*S)/S}function E(e){return Math.floor(e+b)}function e(e,t){return k(t*Math.round(e*(1/t)))}}).call(this)}).call(this,T("buffer").Buffer)},{"./StringNumber.js":53,"./ansi.js":54,"./escape.js":55,"./inspect.js":57,"./naturalSort.js":58,"./unicode.js":59,buffer:23}],57:[function(t,e,i){(function(C,h){(function(){"use strict";const _=t("./escape.js");const r=t("./ansi.js");const S={};const k=new Set([Object,Array]);function o(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}var i={depth:0,ancestors:[]};if(!e.style){e.style=u.none}else if(typeof e.style==="string"){e.style=u[e.style]}if(e.depth===undefined){e.depth=3}if(e.maxLength===undefined){e.maxLength=250}if(e.outputMaxLength===undefined){e.outputMaxLength=5e3}if(e.nofunc){e.noFunc=true}if(e.minimal){e.noFunc=true;e.noDescriptor=true;e.noType=true;e.noArrayProperty=true;e.enumOnly=true;e.proto=false;e.funcDetails=false}if(e.minimalPlusConstructor){e.noFunc=true;e.noDescriptor=true;e.noTypeButConstructor=true;e.noArrayProperty=true;e.enumOnly=true;e.proto=false;e.funcDetails=false}var n=E(i,e,t);if(n.length>e.outputMaxLength){n=e.style.truncate(n,e.outputMaxLength)}return n}i.inspect=o;function E(t,i,e){var n,r,s,o,a,l,c,u,h,f,d,p,m,g,y="",v="",b="",x,w;h=typeof e;d=(i.tab??i.style.tab).repeat(t.depth);if(h==="function"&&i.noFunc){return""}if(t.key!==undefined){if(t.descriptor){b=[];if(!t.descriptor.configurable){b.push("-conf")}if(!t.descriptor.enumerable){b.push("-enum")}if(!t.descriptor.writable){b.push("-w")}if(b.length){b=b.join(" ")}else{b=""}}if(t.keyIsProperty){if(j(t.key)){v='"'+i.style.key(t.key)+'": '}else{v=i.style.key(t.key)+": "}}else if(!i.noIndex){v=i.style.index(t.key)}if(b){b=" "+i.style.type(b)}}f=t.noPre?"":d+v;if(e===undefined){y+=f+i.style.constant("undefined")+b+i.style.newline}else if(e===S){y+=f+i.style.constant("[empty]")+b+i.style.newline}else if(e===null){y+=f+i.style.constant("null")+b+i.style.newline}else if(e===false){y+=f+i.style.constant("false")+b+i.style.newline}else if(e===true){y+=f+i.style.constant("true")+b+i.style.newline}else if(h==="number"){y+=f+i.style.number(e.toString())+(i.noType||i.noTypeButConstructor?"":" "+i.style.type("number"))+b+i.style.newline}else if(h==="string"){if(e.length>i.maxLength){y+=f+'"'+i.style.string(_.control(e.slice(0,i.maxLength-1)))+'…"'+(i.noType||i.noTypeButConstructor?"":" "+i.style.type("string")+i.style.length("("+e.length+" - TRUNCATED)"))+b+i.style.newline}else{y+=f+'"'+i.style.string(_.control(e))+'"'+(i.noType||i.noTypeButConstructor?"":" "+i.style.type("string")+i.style.length("("+e.length+")"))+b+i.style.newline}}else if(C.isBuffer(e)){y+=f+i.style.inspect(e.inspect())+(i.noType?"":" "+i.style.type("Buffer")+i.style.length("("+e.length+")"))+b+i.style.newline}else if(h==="object"||h==="function"){r=s="";m=false;if(h==="function"){m=true;r=" "+i.style.funcName(e.name?e.name:"(anonymous)");s=i.style.length("("+e.length+")")}p=false;if(Array.isArray(e)){p=true;s=i.style.length("("+e.length+")")}if(!e.constructor){c="(no constructor)"}else if(!e.constructor.name){c="(anonymous)"}else{c=e.constructor.name}l=!e.constructor||k.has(e.constructor);c=i.style.constructorName(c);o=Object.getPrototypeOf(e);y+=f;if(!i.noType&&(!i.noTypeButConstructor||!l)){if(t.forceType&&!i.noType&&!i.noTypeButConstructor){y+=i.style.type(t.forceType)}else if(i.noTypeButConstructor){y+=c}else{y+=c+r+s+" "+i.style.type(h)+b}if(!m||i.funcDetails){y+=" "}}if(p&&i.noArrayProperty){a=[...Array(e.length).keys()]}else{a=Object.getOwnPropertyNames(e)}if(i.sort){a.sort()}g=T(e,t,i);if(i.protoBlackList&&i.protoBlackList.has(o)){y+=i.style.limit("[skip]")+i.style.newline}else if(g!==undefined){if(typeof g==="string"){y+="=> "+g+i.style.newline}else{y+="=> "+E({depth:t.depth,ancestors:t.ancestors,noPre:true},i,g)}}else if(m&&!i.funcDetails){y+=i.style.newline}else if(!a.length&&!i.proto){y+=(p?"[]":"{}")+i.style.newline}else if(t.depth>=i.depth){y+=i.style.limit("[depth limit]")+i.style.newline}else if(t.ancestors.indexOf(e)!==-1){y+=i.style.limit("[circular]")+i.style.newline}else{y+=(p?"[":"{")+i.style.newline;w=t.ancestors.slice();w.push(e);for(n=0;n<a.length&&y.length<i.outputMaxLength;n++){if(!p&&(i.propertyBlackList&&i.propertyBlackList.has(a[n])||i.useInspectPropertyBlackList&&e.inspectPropertyBlackList instanceof Set&&e.inspectPropertyBlackList.has(a[n]))){continue}if(p&&i.noArrayProperty&&!(a[n]in e)){y+=E({depth:t.depth+1,ancestors:w,key:a[n],keyIsProperty:false},i,S)}else{try{x=Object.getOwnPropertyDescriptor(e,a[n]);if(!x.enumerable&&i.enumOnly){continue}u=!p||!x.enumerable||isNaN(a[n]);if(!i.noDescriptor&&x&&(x.get||x.set)){y+=E({depth:t.depth+1,ancestors:w,key:a[n],keyIsProperty:u,descriptor:x,forceType:"getter/setter"},i,{get:x.get,set:x.set})}else{y+=E({depth:t.depth+1,ancestors:w,key:a[n],keyIsProperty:u,descriptor:i.noDescriptor?undefined:x},i,e[a[n]])}}catch(e){y+=E({depth:t.depth+1,ancestors:w,key:a[n],keyIsProperty:u,descriptor:i.noDescriptor?undefined:x},i,e)}}if(n<a.length-1){y+=i.style.comma}}if(i.proto){y+=E({depth:t.depth+1,ancestors:w,key:"__proto__",keyIsProperty:true},i,o)}y+=d+(p?"]":"}");y+=i.style.newline}}if(t.depth===0){if(i.style.trim){y=y.trim()}if(i.style==="html"){y=_.html(y)}}return y}function j(e){if(!e.length){return true}return false}var a=["pending","fulfilled","rejected"];function T(n,r,s){if(typeof n.constructor!=="function"){return}if(n instanceof String){return n.toString()}if(n instanceof RegExp){return n.toString()}if(n instanceof Date){return n.toString()+" ["+n.getTime()+"]"}if(typeof Set==="function"&&n instanceof Set){return Array.from(n)}if(typeof Map==="function"&&n instanceof Map){return Array.from(n)}if(n instanceof Promise){if(h&&h.binding&&h.binding("util")&&h.binding("util").getPromiseDetails){let e=h.binding("util").getPromiseDetails(n);let t=a[e[0]];let i="Promise <"+t+">";if(t==="fulfilled"){i+=" "+E({depth:r.depth,ancestors:r.ancestors,noPre:true},s,e[1])}else if(t==="rejected"){if(e[1]instanceof Error){i+=" "+l({style:s.style,noErrorStack:true},e[1])}else{i+=" "+E({depth:r.depth,ancestors:r.ancestors,noPre:true},s,e[1])}}return i}}if(n._bsontype){return n.toString()}if(s.useInspect&&typeof n.inspect==="function"){return n.inspect()}return}function l(e,t){var i="",n,r,s;if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!(t instanceof Error)){return"inspectError(): it's not an error, using regular variable inspection: "+o(e,t)}if(!e.style){e.style=u.none}else if(typeof e.style==="string"){e.style=u[e.style]}if(t.stack&&!e.noErrorStack){n=c(e,t.stack)}r=t.type||t.constructor.name;s=t.code||t.name||t.errno||t.number;i+=e.style.errorType(r)+(s?" ["+e.style.errorType(s)+"]":"")+": ";i+=e.style.errorMessage(t.message)+"\n";if(n){i+=e.style.errorStack(n)+"\n"}if(t.from){i+=e.style.newline+e.style.errorFromMessage("From error:")+e.style.newline+l(e,t.from)}return i}i.inspectError=l;function c(l,e){if(arguments.length<2){e=l;l={}}else if(!l||typeof l!=="object"){l={}}if(!l.style){l.style=u.none}else if(typeof l.style==="string"){l.style=u[l.style]}if(!e){return}if((l.browser||h.browser)&&e.indexOf("@")!==-1){e=e.replace(/[</]*(?=@)/g,"").replace(/^\s*([^@]*)\s*@\s*([^\n]*)(?::([0-9]+):([0-9]+))?$/gm,(e,t,i,n,r)=>{return l.style.errorStack("    at ")+(t?l.style.errorStackMethod(t)+" ":"")+l.style.errorStack("(")+(i?l.style.errorStackFile(i):l.style.errorStack("unknown"))+(n?l.style.errorStack(":")+l.style.errorStackLine(n):"")+(r?l.style.errorStack(":")+l.style.errorStackColumn(r):"")+l.style.errorStack(")")})}else{e=e.replace(/^[^\n]*\n/,"");e=e.replace(/^\s*(at)\s+(?:(?:(async|new)\s+)?([^\s:()[\]\n]+(?:\([^)]+\))?)\s)?(?:\[as ([^\s:()[\]\n]+)\]\s)?(?:\(?([^:()[\]\n]+):([0-9]+):([0-9]+)\)?)?$/gm,(e,t,i,n,r,s,o,a)=>{return l.style.errorStack("    at ")+(i?l.style.errorStackKeyword(i)+" ":"")+(n?l.style.errorStackMethod(n)+" ":"")+(r?l.style.errorStack("[as ")+l.style.errorStackMethodAs(r)+l.style.errorStack("] "):"")+l.style.errorStack("(")+(s?l.style.errorStackFile(s):l.style.errorStack("unknown"))+(o?l.style.errorStack(":")+l.style.errorStackLine(o):"")+(a?l.style.errorStack(":")+l.style.errorStackColumn(a):"")+l.style.errorStack(")")})}return e}i.inspectStack=c;var u={};var e=e=>e;u.none={trim:false,tab:"    ",newline:"\n",comma:"",limit:e,type:e=>"<"+e+">",constant:e,funcName:e,constructorName:e=>"<"+e+">",length:e,key:e,index:e=>"["+e+"] ",number:e,inspect:e,string:e,errorType:e,errorMessage:e,errorStack:e,errorStackKeyword:e,errorStackMethod:e,errorStackMethodAs:e,errorStackFile:e,errorStackLine:e,errorStackColumn:e,errorFromMessage:e,truncate:(e,t)=>e.slice(0,t-1)+"…"};u.inline=Object.assign({},u.none,{trim:true,tab:"",newline:" ",comma:", ",length:()=>"",index:()=>""});u.color=Object.assign({},u.none,{limit:e=>r.bold+r.brightRed+e+r.reset,type:e=>r.italic+r.brightBlack+e+r.reset,constant:e=>r.cyan+e+r.reset,funcName:e=>r.italic+r.magenta+e+r.reset,constructorName:e=>r.magenta+e+r.reset,length:e=>r.italic+r.brightBlack+e+r.reset,key:e=>r.green+e+r.reset,index:e=>r.blue+"["+e+"]"+r.reset+" ",number:e=>r.cyan+e+r.reset,inspect:e=>r.cyan+e+r.reset,string:e=>r.blue+e+r.reset,errorType:e=>r.red+r.bold+e+r.reset,errorMessage:e=>r.red+r.italic+e+r.reset,errorStack:e=>r.brightBlack+e+r.reset,errorStackKeyword:e=>r.italic+r.bold+e+r.reset,errorStackMethod:e=>r.brightYellow+e+r.reset,errorStackMethodAs:e=>r.yellow+e+r.reset,errorStackFile:e=>r.brightCyan+e+r.reset,errorStackLine:e=>r.blue+e+r.reset,errorStackColumn:e=>r.magenta+e+r.reset,errorFromMessage:e=>r.yellow+r.underline+e+r.reset,truncate:(e,t)=>{var i=r.gray+"…"+r.reset;e=e.slice(0,t-i.length);var n=e.lastIndexOf("");if(n>=e.length-6){e=e.slice(0,n)}return e+i}});u.html=Object.assign({},u.none,{tab:"&nbsp;&nbsp;&nbsp;&nbsp;",newline:"<br />",limit:e=>'<span style="color:red">'+e+"</span>",type:e=>'<i style="color:gray">'+e+"</i>",constant:e=>'<span style="color:cyan">'+e+"</span>",funcName:e=>'<i style="color:magenta">'+e+"</i>",constructorName:e=>'<span style="color:magenta">'+e+"</span>",length:e=>'<i style="color:gray">'+e+"</i>",key:e=>'<span style="color:green">'+e+"</span>",index:e=>'<span style="color:blue">['+e+"]</span> ",number:e=>'<span style="color:cyan">'+e+"</span>",inspect:e=>'<span style="color:cyan">'+e+"</span>",string:e=>'<span style="color:blue">'+e+"</span>",errorType:e=>'<span style="color:red">'+e+"</span>",errorMessage:e=>'<span style="color:red">'+e+"</span>",errorStack:e=>'<span style="color:gray">'+e+"</span>",errorStackKeyword:e=>"<i>"+e+"</i>",errorStackMethod:e=>'<span style="color:yellow">'+e+"</span>",errorStackMethodAs:e=>'<span style="color:yellow">'+e+"</span>",errorStackFile:e=>'<span style="color:cyan">'+e+"</span>",errorStackLine:e=>'<span style="color:blue">'+e+"</span>",errorStackColumn:e=>'<span style="color:gray">'+e+"</span>",errorFromMessage:e=>'<span style="color:yellow">'+e+"</span>"})}).call(this)}).call(this,{isBuffer:t("../../is-buffer/index.js")},t("_process"))},{"../../is-buffer/index.js":26,"./ansi.js":54,"./escape.js":55,_process:37}],58:[function(e,t,i){"use strict";const w=1;const _=2;const S=3;const k=4;const E=5;function j(e,t){if(T(t)){return _}if(t<=31||t===127){return w}if(C(t)){return k}if(e.toUpperCase()!==e.toLowerCase()){return S}return E}function T(e){if(e===32||e===9||e===160||e===45||e===95){return true}return false}function C(e){if(e>=48&&e<=57){return true}return false}function n(e,t){e=""+e;t=""+t;var i,n,r,s,o,a,l,c=e.trim(),u=c.length,h,f,d,p,m,g,y,v=t.trim(),b=v.length,x=0;for(i=h=0;i<u&&h<b;i++,h++){r=c[i];d=v[h];s=c.charCodeAt(i);p=v.charCodeAt(h);o=j(r,s);m=j(d,p);if(o!==m){return o-m}switch(o){case _:while(T(c.charCodeAt(i+1))){i++}while(T(v.charCodeAt(h+1))){h++}break;case w:case E:if(s!==p){return s-p}break;case S:a=r.toLowerCase();g=d.toLowerCase();if(a!==g){return a>g?1:-1}if(!x&&r!==d){x=r!==a?-1:1}break;case k:n=i+1;while(C(c.charCodeAt(n))){n++}l=parseFloat(c.slice(i,n));f=h+1;while(C(v.charCodeAt(f))){f++}y=parseFloat(v.slice(h,f));if(l!==y){return l-y}if(!x&&n-i!==f-h){x=n-i-(f-h)}i=n-1;h=f-1;break}}if(x){return x}return u-i-(b-h)||u-b||e.length-t.length}t.exports=n},{}],59:[function(e,t,i){"use strict";const u={};t.exports=u;u.encode=e=>String.fromCodePoint(...e);u.decode=e=>Array.from(e,e=>e.codePointAt(0));u.firstCodePoint=e=>e.codePointAt(0);u.firstChar=e=>e.length?String.fromCodePoint(e.codePointAt(0)):undefined;u.toArray=e=>Array.from(e);u.toCells=(e,t,i=4,n=0,...r)=>{var s,o,a,l,c=[];for(s of t){o=s.codePointAt(0);if(o===10){n=0}else if(o===9){a=i-n%i-1;c.push(new e("\t",1,...r));n+=1+a;while(a--){c.push(new e(" ",-2,...r))}}else{l=u.codePointWidth(o),c.push(new e(s,l,...r));n+=l;while(--l>0){c.push(new e(" ",-1,...r))}}}return c};u.fromCells=e=>{var t,i="";for(t of e){if(!t.filler){i+=t.char}}return i};u.length=e=>{var t,i=0;for(t of e){i++}return i};u.width=e=>{var t,i=0;for(t of e){i+=u.codePointWidth(t.codePointAt(0))}return i};u.arrayWidth=(e,t)=>{var i,n=0;if(t===undefined){t=e.length}for(i=0;i<t;i++){n+=u.isFullWidth(e[i])?2:1}return n};var s=0;u.getLastTruncateWidth=()=>s;u.widthLimit=u.truncateWidth=(e,t)=>{var i,n,r=0;s=0;for(i of e){n=u.codePointWidth(i.codePointAt(0));if(s+n>t){return e.slice(0,r)}s+=n;r+=i.length}return e};u.surrogatePair=e=>{var t=e.charCodeAt(0);if(t<55296||t>=57344){return 0}else if(t<56320){return 1}return-1};u.isFullWidth=e=>u.isFullWidthCodePoint(e.codePointAt(0));u.charWidth=e=>u.codePointWidth(e.codePointAt(0));u.codePointWidth=e=>{if(u.isEmojiCodePoint(e)){return 2}if(e>=4352&&(e<=4447||e===9001||e===9002||11904<=e&&e<=12871&&e!==12351||12880<=e&&e<=19903||19968<=e&&e<=42182||43360<=e&&e<=43388||44032<=e&&e<=55203||63744<=e&&e<=64255||65040<=e&&e<=65049||65072<=e&&e<=65131||65281<=e&&e<=65376||65504<=e&&e<=65510||110592<=e&&e<=110593||127488<=e&&e<=127569||131072<=e&&e<=262141)){return 2}return 1};u.isFullWidthCodePoint=e=>u.codePointWidth(e)===2;u.toFullWidth=e=>{return String.fromCodePoint(...Array.from(e,e=>{var t=e.codePointAt(0);return t>=33&&t<=126?65280+t-32:t}))};u.isEmoji=e=>u.isEmojiCodePoint(e.codePointAt(0));u.isEmojiCodePoint=e=>9728<=e&&e<=9983||9984<=e&&e<=10175||126976<=e&&e<=127487||127744<=e&&e<=127994||128e3<=e&&e<=129791;u.isEmojiModifier=e=>u.isEmojiModifierCodePoint(e.codePointAt(0));u.isEmojiModifierCodePoint=e=>127995<=e&&e<=127999},{}],60:[function(e,t,i){"use strict";const n=e("./svg-kit.js");const r=e("./VGContainer.js");var s=0;function o(e){r.call(this,e);this.id=e&&e.id||"vg_"+s++;this.viewBox={x:0,y:0,width:100,height:100};this.css=[];this.invertY=false;if(e){this.set(e)}}t.exports=o;o.prototype=Object.create(r.prototype);o.prototype.constructor=o;o.prototype.__prototypeUID__="svg-kit/VG";o.prototype.__prototypeVersion__=e("../package.json").version;o.prototype.svgTag="svg";o.prototype.svgAttributes=function(e=this){var t={xmlns:"http://www.w3.org/2000/svg",viewBox:this.viewBox.x+" "+(e.invertY?-this.viewBox.y-this.viewBox.height:this.viewBox.y)+" "+this.viewBox.width+" "+this.viewBox.height};return t};o.prototype.set=function(t){r.prototype.set.call(this,t);if(t.viewBox&&typeof t.viewBox==="object"){if(t.viewBox.x!==undefined){this.viewBox.x=t.viewBox.x}if(t.viewBox.y!==undefined){this.viewBox.y=t.viewBox.y}if(t.viewBox.width!==undefined){this.viewBox.width=t.viewBox.width}if(t.viewBox.height!==undefined){this.viewBox.height=t.viewBox.height}}if(t.css&&Array.isArray(t.css)){this.css.length=0;for(let e of t.css){this.addCssRule(e)}}if(t.invertY!==undefined){this.invertY=!!t.invertY}};o.prototype.addCssRule=function(e){if(!e||typeof e!=="object"||!e.select||!e.style||typeof e.style!=="object"){return}this.css.push(e)}},{"../package.json":73,"./VGContainer.js":61,"./svg-kit.js":69}],61:[function(e,t,i){"use strict";const n=e("./svg-kit.js");const r=e("./VGEntity.js");function s(e){r.call(this,e);this.entities=[]}t.exports=s;s.prototype=Object.create(r.prototype);s.prototype.constructor=s;s.prototype.__prototypeUID__="svg-kit/VGContainer";s.prototype.__prototypeVersion__=e("../package.json").version;s.prototype.isContainer=true;s.prototype.set=function(t){r.prototype.set.call(this,t);if(t.entities&&Array.isArray(t.entities)){for(let e of t.entities){this.entities.push(n.objectToVG(e))}}};s.prototype.exportMorphLog=function(){var n=false,r={};this.entities.forEach((e,t)=>{var i=e.exportMorphLog();if(i){r[t]=i;n=true}});if(!n&&!this.morphLog.length){return null}var e={};if(this.morphLog.length){e.l=[...this.morphLog]}if(n){e.i=r}this.morphLog.length=0;return e};s.prototype.importMorphLog=function(e){var t,i;if(!e){this.morphLog.length=0;return}if(!e.l||!e.l.length){this.morphLog.length=0}else{this.morphLog=e.l}if(e.i){for(t in e.i){i=+t;if(this.entities[i]){this.entities[i].importMorphLog(e.i[t])}}}};s.prototype.morphDom=function(t=this){this.entities.forEach(e=>e.morphDom(t));this.morphLog.forEach(e=>this.morphOneEntryDom(e,t));this.morphLog.length=0;return this.$element}},{"../package.json":73,"./VGEntity.js":63,"./svg-kit.js":69}],62:[function(e,t,i){"use strict";const n=e("./VGEntity.js");function r(e){n.call(this,e);this.x=0;this.y=0;this.rx=0;this.ry=0;if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGEllipse";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="ellipse";r.prototype.svgAttributes=function(e=this){var t={cx:this.x,cy:e.invertY?-this.y:this.y,rx:this.rx,ry:this.ry};return t};r.prototype.set=function(e){n.prototype.set.call(this,e);if(e.cx!==undefined){this.x=e.cx}if(e.cy!==undefined){this.y=e.cy}if(e.x!==undefined){this.x=e.x}if(e.y!==undefined){this.y=e.y}if(e.r!==undefined){this.rx=this.ry=e.r}if(e.rx!==undefined){this.rx=e.rx}if(e.ry!==undefined){this.ry=e.ry}}},{"../package.json":73,"./VGEntity.js":63}],63:[function(e,t,i){"use strict";const o=e("string-kit/lib/camel");const n=e("string-kit/lib/escape");function r(e){this.id=null;this.class=new Set;this.style={};this.data=null;this.button=null;this.hint=null;this.area=null;this.morphLog=[];this.$element=null;this.$style=null}t.exports=r;r.prototype.__prototypeUID__="svg-kit/VGEntity";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.isContainer=false;r.prototype.svgTag="none";r.prototype.svgAttributes=()=>({});r.prototype.toJSON=function(){var e=Object.assign({},this);e._type=this.__prototypeUID__;if(this.class.size){e.class=[...this.class]}else{delete e.class}if(!e.id){delete e.id}if(!e.data){delete e.data}if(!e.button){delete e.button}if(!e.hint){delete e.hint}if(!e.area){delete e.area}delete e.morphLog;delete e.$element;delete e.$style;return e};r.prototype.set=function(t){if(t.id!==undefined){this.id=t.id||null}if(t.class){if(typeof t.class==="string"){this.class.clear();this.class.add(t.class)}else if(Array.isArray(t.class)||t.class instanceof Set){this.class.clear();for(let e of t.class){this.class.add(e)}}else if(typeof t.class==="object"){for(let e in t.class){if(t.class[e]){this.class.add(e)}else{this.class.delete(e)}}}}if(t.style){for(let e in t.style){this.style[this.toCamelCase(e)]=t.style[e]===null?"":t.style[e]}}if(t.data!==undefined){if(!t.data){this.data=null}else{if(!this.data){this.data={}}Object.assign(this.data,t.data)}}if(t.button!==undefined){this.button=t.button||null}if(t.hint!==undefined){this.hint=t.hint||null}if(t.area!==undefined){this.area=t.area||null}};var s=0;r.prototype.morph=function(e){var t=Object.assign({},e);t._v=s++;this.morphLog.push(t);this.set(e)};r.prototype.exportMorphLog=function(){if(!this.morphLog.length){return null}var e={l:[...this.morphLog]};this.morphLog.length=0;return e};r.prototype.importMorphLog=function(e){if(!e||!e.l||!e.l.length){this.morphLog.length=0}else{this.morphLog=e.l}};r.prototype.toCamelCase=e=>o.toCamelCase(e,true);r.prototype.escape=function(e){if(typeof e==="object"){return null}if(typeof e!=="string"){return e}return n.htmlAttr(e)};r.prototype.renderText=function(t=this){var e,i,n="",r="",s=this.svgAttributes(t);n+="<"+this.svgTag;if(this.id){n+=' id="'+this.escape(this.id)+'"'}if(this.button){n+=' button="'+this.escape(this.button)+'"'}if(this.hint){n+=' hint="'+this.escape(this.hint)+'"'}if(this.area){n+=' area="'+this.escape(this.area)+'"'}if(this.class.size){n+=' class="';let t=true;for(let e of this.class){if(!t){n+=" "}n+=this.escape(e);t=false}n+='"'}for(e in s){n+=" "+e+'="'+this.escape(s[e])+'"'}if(this.data){for(e in this.data){n+=" data-"+this.escape(e)+'="'+this.escape(this.data[e])+'"'}}for(e in this.style){r+=this.escape(o.camelCaseToDash(e))+":"+this.escape(this.style[e])+";"}if(r){n+=' style="'+r+'"'}if(this.svgTextNode){n+=this.svgTextNode()}if(!this.isContainer){n+=" />";return n}n+=">";if(this.css&&this.css.length){n+="<style>\n";for(i of this.css){n+=i.select+" {\n";for(e in i.style){n+="    "+this.escape(o.camelCaseToDash(e))+": "+this.escape(i.style[e])+";\n"}n+="}\n"}n+="</style>"}if(this.entities){for(let e of this.entities){n+=e.renderText(t)}}n+="</"+this.svgTag+">";return n};r.prototype.renderDom=function(e={},t=this){var i,n,r,s=this.svgAttributes(t);this.$element=document.createElementNS("http://www.w3.org/2000/svg",e.overrideTag||this.svgTag);if(this.id){this.$element.setAttribute("id",this.id)}if(this.button){this.$element.setAttribute("button",this.button)}if(this.hint){this.$element.setAttribute("hint",this.hint)}if(this.area){this.$element.setAttribute("area",this.area)}if(this.class.size){this.class.forEach(e=>this.$element.classList.add(e))}for(i in s){this.$element.setAttribute(i,s[i])}if(this.data){for(i in this.data){this.$element.setAttribute("data-"+i,this.data[i])}}for(i in this.style){this.$element.style[i]=this.style[i]}if(this.svgTextNode){this.$element.appendChild(document.createTextNode(this.svgTextNode()))}if(!this.isContainer){return this.$element}if(this.css&&this.css.length){this.$style=document.createElementNS("http://www.w3.org/2000/svg","style");r="";for(n of this.css){r+=n.select+" {\n";for(i in n.style){r+=this.escape(o.camelCaseToDash(i))+": "+this.escape(n.style[i])+";\n"}r+="}\n"}this.$style.appendChild(document.createTextNode(r));this.$element.appendChild(this.$style)}if(this.entities){for(let e of this.entities){this.$element.appendChild(e.renderDom(undefined,t))}}return this.$element};r.prototype.morphDom=function(t=this){this.morphLog.forEach(e=>this.morphOneEntryDom(e,t));this.morphLog.length=0;return this.$element};r.prototype.morphOneEntryDom=function(t,e=this){var i;if(t.button){this.$element.setAttribute("button",t.button)}if(t.hint){this.$element.setAttribute("hint",t.hint)}if(t.area){this.$element.setAttribute("area",t.area)}if(t.class){if(Array.isArray(t.class)){this.$element.setAttribute("class",t.class.join(" "))}else if(t.class instanceof Set){this.$element.setAttribute("class",[...t.class].join(" "))}else if(typeof t.class==="object"){for(let e in t.class){if(t.class[e]){this.$element.classList.add(e)}else{this.$element.classList.remove(e)}}}}if(t.attr){for(i in t.attr){this.$element.setAttribute(i,t.attr[i])}}if(t.data){for(i in t.data){this.$element.setAttribute("data-"+i,t.data[i])}}if(t.style){for(i in t.style){this.$element.style[i]=t.style[i]===null?"":t.style[i]}}}},{"../package.json":73,"string-kit/lib/camel":71,"string-kit/lib/escape":72}],64:[function(e,t,i){"use strict";const n=e("./svg-kit.js");const r=e("./VGContainer.js");function s(e){r.call(this,e);if(e){this.set(e)}}t.exports=s;s.prototype=Object.create(r.prototype);s.prototype.constructor=s;s.prototype.__prototypeUID__="svg-kit/VGGroup";s.prototype.__prototypeVersion__=e("../package.json").version;s.prototype.svgTag="g";s.prototype.set=function(e){r.prototype.set.call(this,e)}},{"../package.json":73,"./VGContainer.js":61,"./svg-kit.js":69}],65:[function(e,t,i){"use strict";const n=e("./VGEntity.js");function r(e){n.call(this,e);this.commands=[];if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGPath";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="path";r.prototype.svgAttributes=function(e=this){var t={d:this.toD(e)};return t};r.prototype.set=function(e){n.prototype.set.call(this,e);if(Array.isArray(e.commands)){this.commands=e.commands}};r.prototype.toD=function(e=this){var i={root:e,d:"",pu:false,cx:0,cy:0,ca:e.invertY?-Math.PI/2:Math.PI/2};this.commands.forEach((e,t)=>{if(t){i.d+=" "}o[e.type](e,i)});return i.d};const d=e=>e*Math.PI/180;const s=e=>e*180/Math.PI;const o={};o.close=(e,t)=>{t.d+="z"};o.move=(e,t)=>{var i=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="m "+e.x+" "+i;t.cx+=e.x;t.cy+=i}else{t.d+="M "+e.x+" "+i;t.cx=e.x;t.cy=i}};o.line=(e,t)=>{var i=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="l "+e.x+" "+i;t.cx+=e.x;t.cy+=i}else{t.d+="L "+e.x+" "+i;t.cx=e.x;t.cy=i}};o.curve=(e,t)=>{var i=t.root.invertY?-e.cy1:e.cy1,n=t.root.invertY?-e.cy2:e.cy2,r=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="c "+e.cx1+" "+i+" "+e.cx2+" "+n+" "+e.x+" "+r;t.cx+=e.x;t.cy+=r}else{t.d+="C "+e.cx1+" "+i+" "+e.cx2+" "+n+" "+e.x+" "+r;t.cx=e.x;t.cy=r}};o.smoothCurve=(e,t)=>{var i=t.root.invertY?-e.cy:e.cy,n=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="s "+e.cx+" "+i+" "+e.x+" "+n;t.cx+=e.x;t.cy+=n}else{t.d+="S "+e.cx+" "+i+" "+e.x+" "+n;t.cx=e.x;t.cy=n}};o.qCurve=(e,t)=>{var i=t.root.invertY?-e.cy:e.cy,n=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="q "+e.cx+" "+i+" "+e.x+" "+n;t.cx+=e.x;t.cy+=n}else{t.d+="Q "+e.cx+" "+i+" "+e.x+" "+n;t.cx=e.x;t.cy=n}};o.smoothQCurve=(e,t)=>{var i=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="t "+e.x+" "+i;t.cx+=e.x;t.cy+=i}else{t.d+="T "+e.x+" "+i;t.cx=e.x;t.cy=i}};o.arc=(e,t)=>{var i=t.root.invertY?-e.ra:e.ra,n=t.root.invertY?!e.pr:e.pr,r=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="a "+e.rx+" "+e.ry+" "+i+" "+ +e.la+" "+ +n+" "+e.x+" "+r;t.cx+=e.x;t.cy+=r}else{t.d+="A "+e.rx+" "+e.ry+" "+i+" "+ +e.la+" "+ +n+" "+e.x+" "+r;t.cx=e.x;t.cy=r}};function a(e){if(!e){return 0}var t=d(e);var i=Math.cos(t/2),n=Math.sin(t/2),r=(4-i)/3,s=(1-i)*(3-i)/(3*n);return Math.sqrt((i-r)**2+(n-s)**2)}o.centerArc=(e,t)=>{var{x:i,y:n,cx:r,cy:s}=e;if(e.rel){i+=t.cx;n+=t.cy;r+=t.cx;s+=t.cy}var o=Math.atan2(t.cy-s,t.cx-r),a=Math.atan2(n-s,i-r);t.cx=i;t.cy=n};o.pen=(e,t)=>{t.pu=e.u};o.forward=(e,t)=>{var i=e.l*Math.cos(t.ca),n=e.l*Math.sin(t.ca);if(t.pu){t.d+="m "+i+" "+n}else{t.d+="l "+i+" "+n}t.cx+=i;t.cy+=n};o.turn=(e,t)=>{var i=t.root.invertY?-e.a:e.a;if(e.rel){t.ca+=d(i)}else{t.ca=d(i)}};o.forwardTurn=(e,t)=>{var i=t.root.invertY?-e.a:e.a;var n=d(i),r=n>=0?1:-1,s=Math.abs(n),o=e.l/s,a=o*Math.cos(s),l=o*Math.sin(s),c=Math.sqrt((o-a)**2+l**2),u=Math.atan2(o-a,l);var h=c*Math.cos(t.ca+r*u),f=c*Math.sin(t.ca+r*u);if(t.pu){t.d+="m "+h+" "+f}else{t.d+="a "+o+" "+o+" 0 "+(s>Math.PI?1:0)+" "+(n>=0?1:0)+" "+h+" "+f}t.cx+=h;t.cy+=f;t.ca+=n};r.prototype.close=function(){this.commands.push({type:"close"})};r.prototype.move=function(e){this.commands.push({type:"move",rel:true,x:e.x||0,y:e.y||0})};r.prototype.moveTo=function(e){this.commands.push({type:"move",x:e.x||0,y:e.y||0})};r.prototype.line=function(e){this.commands.push({type:"line",rel:true,x:e.x||0,y:e.y||0})};r.prototype.lineTo=function(e){this.commands.push({type:"line",x:e.x||0,y:e.y||0})};r.prototype.curve=function(e){this.commands.push({type:"curve",rel:true,cx1:e.cx1||0,cy1:e.cy1||0,cx2:e.cx2||0,cy2:e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.curveTo=function(e){this.commands.push({type:"curve",cx1:e.cx1||0,cy1:e.cy1||0,cx2:e.cx2||0,cy2:e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.smoothCurve=function(e){this.commands.push({type:"smoothCurve",rel:true,cx:e.cx||e.cx2||0,cy:e.cy||e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.smoothCurveTo=function(e){this.commands.push({type:"smoothCurve",cx:e.cx||e.cx2||0,cy:e.cy||e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.qCurve=function(e){this.commands.push({type:"qCurve",rel:true,cx:e.cx||e.cx1||0,cy:e.cy||e.cy1||0,x:e.x||0,y:e.y||0})};r.prototype.qCurveTo=function(e){this.commands.push({type:"qCurve",cx:e.cx||e.cx1||0,cy:e.cy||e.cy1||0,x:e.x||0,y:e.y||0})};r.prototype.smoothQCurve=function(e){this.commands.push({type:"smoothQCurve",rel:true,x:e.x||0,y:e.y||0})};r.prototype.smoothQCurveTo=function(e){this.commands.push({type:"smoothQCurve",x:e.x||0,y:e.y||0})};r.prototype.arc=function(e){this.commands.push({type:"arc",rel:true,rx:e.rx||0,ry:e.ry||0,ra:e.ra||e.a||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true,x:e.x||0,y:e.y||0})};r.prototype.arcTo=function(e){this.commands.push({type:"arc",rx:e.rx||0,ry:e.ry||0,ra:e.ra||e.a||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true,x:e.x||0,y:e.y||0})};r.prototype.negativeArc=function(e){this.commands.push({type:"arc",rel:true,rx:e.rx||0,ry:e.ry||0,ra:-(e.ra||e.a||0),la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:!(e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true),x:e.x||0,y:e.y||0})};r.prototype.negativeArcTo=function(e){this.commands.push({type:"arc",rx:e.rx||0,ry:e.ry||0,ra:-(e.ra||e.a||0),la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:!(e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true),x:e.x||0,y:e.y||0})};r.prototype.centerArc=function(e){this.commands.push({type:"centerArc",rel:true,cx:e.cx||0,cy:e.cy||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,x:e.x||0,y:e.y||0})};r.prototype.centerArcTo=function(e){this.commands.push({type:"centerArc",cx:e.cx||0,cy:e.cy||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,x:e.x||0,y:e.y||0})};r.prototype.penUp=function(e){this.commands.push({type:"pen",u:true})};r.prototype.penDown=function(e){this.commands.push({type:"pen",u:false})};r.prototype.forward=function(e){this.commands.push({type:"forward",l:typeof e==="number"?e:e.length||e.l||0})};r.prototype.backward=function(e){this.commands.push({type:"forward",l:-(typeof e==="number"?e:e.length||e.l||0)})};r.prototype.turn=function(e){this.commands.push({type:"turn",rel:true,a:typeof e==="number"?e:e.angle||e.a||0})};r.prototype.turnTo=function(e){this.commands.push({type:"turn",a:typeof e==="number"?e:e.angle||e.a||0})};r.prototype.negativeTurn=function(e){this.commands.push({type:"turn",rel:true,a:-(typeof e==="number"?e:e.angle||e.a||0)})};r.prototype.negativeTurnTo=function(e){this.commands.push({type:"turn",a:90-(typeof e==="number"?e:e.angle||e.a||0)})};r.prototype.forwardTurn=function(e){this.commands.push({type:"forwardTurn",l:e.length||e.l||0,a:e.angle||e.a||0})};r.prototype.forwardNegativeTurn=function(e){this.commands.push({type:"forwardTurn",l:e.length||e.l||0,a:-(e.angle||e.a||0)})}},{"../package.json":73,"./VGEntity.js":63}],66:[function(e,t,i){"use strict";const n=e("./VGEntity.js");function r(e){n.call(this,e);this.x=0;this.y=0;this.width=0;this.height=0;this.rx=0;this.ry=0;if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGRect";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="rect";r.prototype.svgAttributes=function(e=this){var t={x:this.x,y:e.invertY?-this.y:this.y,width:this.width,height:this.height,rx:this.rx,ry:this.ry};return t};r.prototype.set=function(e){n.prototype.set.call(this,e);if(e.x!==undefined){this.x=e.x}if(e.y!==undefined){this.y=e.y}if(e.width!==undefined){this.width=e.width}if(e.height!==undefined){this.height=e.height}if(e.r!==undefined){this.rx=this.ry=e.r}if(e.rx!==undefined){this.rx=e.rx}if(e.ry!==undefined){this.ry=e.ry}}},{"../package.json":73,"./VGEntity.js":63}],67:[function(e,t,i){"use strict";const n=e("./VGEntity.js");function r(e){n.call(this,e);this.x=0;this.y=0;this.text="";this.anchor=null;this.length=null;this.adjustGlyph=false;if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGText";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="text";r.prototype.svgAttributes=function(e=this){var t={x:this.x,y:e.invertY?-this.y:this.y,"text-anchor":this.anchor||"middle"};if(this.length!==null){t.textLength=this.length}if(this.adjustGlyph!==null){t.lengthAdjust="spacingAndGlyphs"}return t};r.prototype.svgTextNode=function(){return this.text};r.prototype.set=function(e){n.prototype.set.call(this,e);if(e.x!==undefined){this.x=e.x}if(e.y!==undefined){this.y=e.y}if(e.text!==undefined){this.text=e.text}if(e.textAnchor!==undefined){this.anchor=e.textAnchor}if(e.anchor!==undefined){this.anchor=e.anchor}if(e.textLength!==undefined){this.length=e.textLength}if(e.length!==undefined){this.length=e.length}if(e.lengthAdjust==="spacingAndGlyphs"){this.adjustGlyph=true}else if(e.lengthAdjust==="spacing"){this.adjustGlyph=false}if(e.adjustGlyph!==undefined){this.adjustGlyph=!!e.adjustGlyph}}},{"../package.json":73,"./VGEntity.js":63}],68:[function(e,t,i){"use strict";const n={};t.exports=n;n.dFromPoints=(e,t)=>{var i=t?-1:1,n="M";e.forEach(e=>{n+=" "+e.x+","+e.y*i});return n}},{}],69:[function(t,u,e){(function(c){(function(){"use strict";const s=t("fs").promises;const o=t("dom-kit");const n=t("seventh");const r=t("string-kit/lib/escape.js");function e(){}const a={};u.exports=a;a.path=t("./path.js");a.VG=t("./VG.js");a.VGEntity=t("./VGEntity.js");a.VGContainer=t("./VGContainer.js");a.VGGroup=t("./VGGroup.js");a.VGRect=t("./VGRect.js");a.VGEllipse=t("./VGEllipse.js");a.VGPath=t("./VGPath.js");a.VGText=t("./VGText.js");a.load=async function(e,t={}){var i,n,r;if(!c.browser){if(e.substring(0,7)==="file://"){e=e.slice(7)}i=await s.readFile(e,"utf8");n=o.fromXml(i)}else{n=await a.ajax(e)}if(t.removeComments){o.removeComments(n);delete t.removeComments}r=n.documentElement;a.inject(r,t);return r};a.loadFromString=async function(e,t={}){var i=o.fromXml(e);if(t.removeComments){o.removeComments(i);delete t.removeComments}var n=i.documentElement;a.inject(n,t);return n};a.ajax=function(e){var t=new n,i=new XMLHttpRequest;i.responseType="document";i.onreadystatechange=()=>{try{if(i.readyState===4){if(i.status===200){t.resolve(i.responseXML)}else if(i.status===0&&i.responseXML){t.resolve(i.responseXML)}else if(i.status){t.reject(i.status)}else{t.reject(new Error("[svg-kit] ajaxStatus(): Error with falsy status"))}}}catch(e){t.reject(e)}};i.open("GET",e);i.send();return t};a.inject=function(e,t){a.patch(e,t);if(t.into){t.into.appendChild(e)}if(t.as){o.moveAttributes(e,t.as);o.moveChildrenInto(e,t.as)}};a.patch=function(e,t){var i,n,r;a.lightCleanup(e);if(t.id!==undefined){if(typeof t.id==="string"){e.setAttribute("id",t.id)}else if(!t.id){e.removeAttribute("id")}}if(t.class){if(typeof t.class==="string"){e.classList.add(t.class)}else if(typeof t.class==="object"){o.class(e,t.class)}}if(t.hidden){e.style.visibility="hidden"}if(t.prefixIds){o.prefixIds(e,t.prefixIds)}if(t.removeIds){o.removeAllAttributes(e,"id")}if(t.removeSvgStyle){e.removeAttribute("style")}if(t.removeDefaultStyles){a.removeDefaultStyles(e)}if(t.removeComments){o.removeComments(e)}if(t.removeExoticNamespaces){o.filterByNamespace(e,{primary:"svg",whitelist:[]})}if(t.removeSize){n=e.getAttribute("width")||e.style.width;r=e.getAttribute("height")||e.style.height;e.removeAttribute("height");e.removeAttribute("width");e.style.width=null;e.style.height=null;if(!e.getAttribute("viewBox")&&n&&r){i="0 0 "+n+" "+r;e.setAttribute("viewBox",i)}}if(t.css){o.css(e,t.css)}if(t.colorClass){a.colorClass(e)}if(t.removeWhiteSpaces){o.removeWhiteSpaces(e)}else if(t.removeWhiteLines){o.removeWhiteSpaces(e,true)}};a.patchDocument=function(e,t){var i=t.removeWhiteSpaces,n=t.removeWhiteLines,r=t.removeComments;delete t.removeWhiteSpaces;delete t.removeWhiteLines;delete t.removeComments;if(r){o.removeComments(e)}a.patch(e.documentElement,t);if(i){o.removeWhiteSpaces(e)}else if(n){o.removeWhiteSpaces(e,true)}};a.lightCleanup=function(e){o.removeAllTags(e,"metadata");o.removeAllTags(e,"script");o.removeAllTags(e,"defs",true)};const i=["path","circle","ellipse","line","rect","polyline","polygone","text","textPath"];const l=[["font-style","normal"],["font-weight","normal"],["font-variant","normal"],["font-stretch","normal"],["font-size","medium"],["line-height","normal"],["font-variant-ligatures","normal"],["font-variant-position","normal"],["font-variant-caps","normal"],["font-variant-numeric","normal"],["font-variant-alternates","normal"],["font-variant-east-asian","normal"],["font-feature-settings","normal"],["text-indent","0"],["text-align","start"],["text-decoration","none"],["text-decoration-line","none"],["text-decoration-style","solid"],["text-decoration-color","#000000"],["letter-spacing","normal"],["word-spacing","normal"],["text-transform","none"],["writing-mode","lr-tb"],["direction","ltr"],["text-orientation","mixed"],["dominant-baseline","auto"],["baseline-shift","baseline"],["text-anchor","start"],["white-space","normal"],["shape-padding","0"],["display","inline"],["visibility","visible"],["overflow","visible"],["opacity","1"],["isolation","auto"],["mix-blend-mode","normal"],["color-interpolation","sRGB"],["color-interpolation-filters","linearRGB"],["solid-color","#000000"],["solid-opacity","1"],["vector-effect","none"],["fill-rule","nonzero"],["clip-rule","nonzero"],["color-rendering","auto"],["image-rendering","auto"],["shape-rendering","auto"],["text-rendering","auto"],["enable-background","accumulate"],["stroke-dasharray","none"],["stroke-dashoffset","0"],["paint-order","normal"],["paint-order","fill stroke markers"]];a.colorClass=function(t){i.forEach(e=>{Array.from(t.getElementsByTagName(e)).forEach(e=>{if(!e.getAttribute("class")){e.classList.add("primary")}o.styleToAttribute(e,"fill",["none"]);o.styleToAttribute(e,"stroke",["none"])})})};a.removeDefaultStyles=function(t){i.forEach(e=>{Array.from(t.getElementsByTagName(e)).forEach(e=>{var n=e.getAttribute("style");l.forEach(e=>{var t=e[0];var i=e[1];n=n.replace(new RegExp("(^|;) *"+r.regExp(t)+" *: *"+r.regExp(i)+" *(?:;|$)"),(e,t)=>t)});e.setAttribute("style",n)})})};a.getViewBox=function(e){var t=e.getAttribute("viewBox");if(!t){return null}var i=t.split(/ +/);return{x:parseFloat(i[0],10),y:parseFloat(i[1],10),width:parseFloat(i[2],10),height:parseFloat(i[3],10)}};a.setViewBox=function(e,t){e.setAttribute("viewBox",t.x+" "+t.y+" "+t.width+" "+t.height)};a.toAreaArray=function(e){if(e.min&&e.max){return[e.min.x,e.min.y,e.max.x-e.min.x,e.max.y-e.min.y]}else if(e.xmin!==undefined&&e.xmax!==undefined&&e.ymin!==undefined&&e.ymax!==undefined){return[e.xmin,e.ymin,e.xmax-e.xmin,e.ymax-e.ymin]}else if(e.x!==undefined&&e.y!==undefined&&e.width!==undefined&&e.height!==undefined){return[e.x,e.y,e.width,e.height]}return[0,0,100,100]};a.standalone=function(e,t){var i='<?xml version="1.0" encoding="UTF-8"?>\n';if(!Array.isArray(t)){t=a.toAreaArray(t)}i+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="'+t.join(" ")+'">\n';i+=e;i+="\n</svg>\n";return i};a.unserializeVG=e=>a.objectToVG(JSON.parse(e));a.objectToVG=function(e){if(!e._type||!e._type.startsWith("svg-kit/")){return e}var t=e._type.slice(8);if(!a[t]){return e}return new a[t](e)}}).call(this)}).call(this,t("_process"))},{"./VG.js":60,"./VGContainer.js":61,"./VGEllipse.js":62,"./VGEntity.js":63,"./VGGroup.js":64,"./VGPath.js":65,"./VGRect.js":66,"./VGText.js":67,"./path.js":68,_process:37,"dom-kit":70,fs:23,seventh:50,"string-kit/lib/escape.js":72}],70:[function(r,s,e){(function(n){(function(){"use strict";var t,i;if(n.browser){t=new DOMParser;i=new XMLSerializer}else{var e=r("@cronvel/xmldom");t=new e.DOMParser;i=new e.XMLSerializer}var a={};s.exports=a;a.ready=function(t){document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,false);t()},false)};a.fromXml=function(e){return t.parseFromString(e,"application/xml")};a.toXml=function(e){return i.serializeToString(e)};a.fromHtml=function(e){var t,i,n;n=document.createDocumentFragment();i=document.createElement("div");i.insertAdjacentHTML("beforeend",e);for(t=0;t<i.children.length;t++){n.appendChild(i.children[t])}return n};a.appendJs=function(e){var t=document.createElement("script");t.setAttribute("src",e);document.body.appendChild(t)};a.batch=function(e,t,...i){var n;if(t instanceof Element){e(t,...i)}else if(Array.isArray(t)){for(n=0;n<t.length;n++){e(t[n],...i)}}else if(t instanceof NodeList||t instanceof NamedNodeMap){for(n=0;n<t.length;n++){e(t[n],...i)}}};a.css=function(e,t){var i;for(i in t){e.style[i]=t[i]}};a.attr=function(e,t,i){var n;i=i||"";for(n in t){if(t[n]===null){e.removeAttribute(i+n)}else{e.setAttribute(i+n,t[n])}}};a.class=function(e,t,i){var n;i=i||"";for(n in t){if(t[n]){e.classList.add(i+n)}else{e.classList.remove(i+n)}}};a.remove=function(e){e.parentNode.removeChild(e)};a.empty=function(e){while(e.firstChild){e.removeChild(e.firstChild)}};a.cloneInto=function(e,t){a.empty(t);t.appendChild(e.cloneNode(true))};a.insertInto=function(e,t){a.empty(t);t.appendChild(e)};a.moveChildrenInto=function(e,t){a.empty(t);while(e.firstChild){t.appendChild(e.firstChild)}};a.moveAttributes=function(n,r){Array.from(n.attributes).forEach(e=>{var t=e.name;var i=e.value;n.removeAttribute(t);if(t!=="xmlns"&&t.indexOf(":")===-1&&i){r.setAttribute(t,i)}})};a.styleToAttribute=function(e,t,i){if(e.style[t]&&(!i||i.indexOf(e.style[t])===-1)){e.setAttribute(t,e.style[t]);e.style[t]=null}};a.prefixIds=function(e,t){var i,n={};i=e.querySelectorAll("*");a.batch(a.prefixIds.idAttributePass,i,t,n);a.batch(a.prefixIds.otherAttributesPass,i,n)};a.prefixIds.idAttributePass=function(e,t,i){i[e.id]=t+"."+e.id;e.id=i[e.id]};a.prefixIds.otherAttributesPass=function(e,t){a.batch(a.prefixIds.oneAttributeSubPass,e.attributes,t)};a.prefixIds.oneAttributeSubPass=function(e,i){e.value=e.value.replace(/url\(#([^)]+)\)/g,(e,t)=>{if(!i[t]){return e}return"url(#"+i[t]+")"})};a.removeAllTags=function(e,t,i){Array.from(e.getElementsByTagName(t)).forEach(e=>{if(!i||!e.firstChild){e.parentNode.removeChild(e)}})};a.removeAllAttributes=function(e,t){e.removeAttribute(t);Array.from(e.querySelectorAll("["+t+"]")).forEach(e=>{e.removeAttribute(t)})};a.preload=function(e){if(!Array.isArray(e)){e=[e]}e.forEach(e=>{if(a.preload.preloaded[e]){return}a.preload.preloaded[e]=new Image;a.preload.preloaded[e].src=e})};a.preload.preloaded={};a.filterByNamespace=function(e,t){var i,n,r,s,o;if(!t||typeof t!=="object"){return}a.filterAttributesByNamespace(e,t);for(i=e.childNodes.length-1;i>=0;i--){n=e.childNodes[i];if(n.nodeType===1){if(n.tagName.indexOf(":")!==-1){o=n.tagName.split(":");r=o[0];s=o[1];if(r===t.primary){n.tagName=s;a.filterByNamespace(n,t)}else if(t.whitelist){if(t.whitelist.indexOf(r)!==-1){a.filterByNamespace(n,t)}else{e.removeChild(n)}}else if(t.blacklist){if(t.blacklist.indexOf(r)!==-1){e.removeChild(n)}else{a.filterByNamespace(n,t)}}else{a.filterByNamespace(n,t)}}else{a.filterByNamespace(n,t)}}}};a.filterAttributesByNamespace=function(e,t){var i,n,r,s,o,a;if(!t||typeof t!=="object"){return}for(i=e.attributes.length-1;i>=0;i--){n=e.attributes[i];if(n.name.indexOf(":")!==-1){a=n.name.split(":");r=a[0];s=a[1];o=n.value;if(r===t.primary){e.removeAttributeNode(n);e.setAttribute(s,o)}else if(t.whitelist){if(t.whitelist.indexOf(r)===-1){e.removeAttributeNode(n)}}else if(t.blacklist){if(t.blacklist.indexOf(r)!==-1){e.removeAttributeNode(n)}}}}};a.removeComments=function(e){var t,i;for(t=e.childNodes.length-1;t>=0;t--){i=e.childNodes[t];if(i.nodeType===8){e.removeChild(i)}else if(i.nodeType===1){a.removeComments(i)}}};a.removeWhiteSpaces=function(e,t){var i,n,r=null;for(i=e.childNodes.length-1;i>=0;i--){n=e.childNodes[i];if(n.nodeType===3){if(t){if(r){r.nodeValue=(n.nodeValue+r.nodeValue).replace(/^\s*(\n[\t ]*)$/,"$1");e.removeChild(n)}else{n.nodeValue=n.nodeValue.replace(/^\s*(\n[\t ]*)$/,"$1");r=n}}else if(!/\S/.test(n.nodeValue)){e.removeChild(n)}}else if(n.nodeType===1){r=null;a.removeWhiteSpaces(n,t)}else{r=null}}};a.parseMatrix=function(e){var t=e.match(/(matrix|matrix3d)\(([0-9., -]+)\)/);if(!t){return null}return t[2].trim().split(/ ?, ?/).map(e=>{return parseFloat(e)})};a.decomposeMatrix=function(e){if(e.length===6){return a.decomposeMatrix2d(e)}if(e.length===16){return a.decomposeMatrix3d(e)}return null};a.decomposeMatrix2d=function(e){var t=Math.atan2(e[1],e[0]),i=e[0]*e[0]+e[1]*e[1],n=Math.sqrt(i),r=(e[0]*e[3]-e[2]*e[1])/n,s=Math.atan2(e[0]*e[2]+e[1]*e[3],i);return{rotate:180*t/Math.PI,scaleX:n,scaleY:r,skewX:180*s/Math.PI,skewY:0,translateX:e[4],translateY:e[5]}};a.decomposeMatrix3d=function(e){var t=Math.PI/180;var i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=Math.sqrt(e[4]*e[4]+e[5]*e[5]+e[6]*e[6]),r=Math.sqrt(e[8]*e[8]+e[9]*e[9]+e[10]*e[10]);var s=Math.atan2(-e[9]/r,e[10]/r)/t,o=Math.asin(e[8]/r)/t,a=Math.atan2(-e[4]/n,e[0]/i)/t;if(e[4]===1||e[4]===-1){s=0;o=e[4]*-Math.PI/2;a=e[4]*Math.atan2(e[6]/n,e[5]/n)/t}var l=e[12]/i,c=e[13]/i,u=e[14]/i;return{translateX:l,translateY:c,translateZ:u,rotateX:s,rotateY:o,rotateZ:a,scaleX:i,scaleY:n,scaleZ:r}};a.stringifyTransform=function(e){var t=[];if(e.translateX){t.push("translateX("+e.translateX+"px)")}if(e.translateY){t.push("translateY("+e.translateY+"px)")}if(e.translateZ){t.push("translateZ("+e.translateZ+"px)")}if(e.rotate){t.push("rotate("+e.rotate+"deg)")}else{if(e.rotateX){t.push("rotateX("+e.rotateX+"deg)")}if(e.rotateY){t.push("rotateY("+e.rotateY+"deg)")}if(e.rotateZ){t.push("rotateZ("+e.rotateZ+"deg)")}}if(e.scale){t.push("scale("+e.scale+")")}else{if(e.scaleX){t.push("scaleX("+e.scaleX+")")}if(e.scaleY){t.push("scaleY("+e.scaleY+")")}if(e.scaleZ){t.push("scaleZ("+e.scaleZ+")")}}if(e.skewX){t.push("skewX("+e.skewX+"deg)")}if(e.skewY){t.push("skewY("+e.skewY+"deg)")}return t.join(" ")};a.transform=function(e,t){e.style.transform=a.stringifyTransform(t)};a.id=function(e,t){e.id=t};a.text=function(e,t){e.textContent=t};a.html=function(e,t){e.innerHTML=t}}).call(this)}).call(this,r("_process"))},{"@cronvel/xmldom":23,_process:37}],71:[function(e,t,i){"use strict";var n={};t.exports=n;n.toCamelCase=function(e,r=false){if(!e||typeof e!=="string"){return""}return e.replace(/^[\s_-]*([^\s_-]+)|[\s_-]+([^\s_-]?)([^\s_-]*)/g,(e,t,i,n)=>{if(r){if(t){return t}if(!i){return""}return i.toUpperCase()+n}if(t){return t.toLowerCase()}if(!i){return""}return i.toUpperCase()+n.toLowerCase()})};n.camelCaseToSeparated=function(e,n=" "){if(!e||typeof e!=="string"){return""}return e.replace(/^([A-Z])|([A-Z])/g,(e,t,i)=>{if(t){return t.toLowerCase()}return n+i.toLowerCase()})};n.camelCaseToDash=n.camelCaseToDashed=e=>n.camelCaseToSeparated(e,"-")},{}],72:[function(e,t,i){"use strict";i.regExp=i.regExpPattern=e=>e.replace(/([.*+?^${}()|[\]/\\])/g,"\\$1");i.regExpReplacement=e=>e.replace(/\$/g,"$$$$");i.format=e=>e.replace(/%/g,"%%");i.jsSingleQuote=e=>i.control(e).replace(/'/g,"\\'");i.jsDoubleQuote=e=>i.control(e).replace(/"/g,'\\"');i.shellArg=e=>"'"+e.replace(/'/g,"'\\''")+"'";var n={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};i.control=(e,i=false)=>e.replace(/[\x00-\x1f\x7f]/g,e=>{if(i&&(e==="\n"||e==="\t")){return e}if(n[e]!==undefined){return n[e]}var t=e.charCodeAt(0).toString(16);if(t.length%2){t="0"+t}return"\\x"+t});var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};i.html=e=>e.replace(/[&<>]/g,e=>r[e]);i.htmlAttr=e=>e.replace(/[&<>"]/g,e=>r[e]);i.htmlSpecialChars=e=>e.replace(/[&<>"']/g,e=>r[e]);i.unicodePercentEncode=e=>e.replace(/[\x00-\x1f\u0100-\uffff\x7f%]/g,e=>{try{return encodeURI(e)}catch(e){return""}});i.httpHeaderValue=e=>i.unicodePercentEncode(e)},{}],73:[function(e,t,i){t.exports={_from:"svg-kit@^0.3.0",_id:"svg-kit@0.3.0",_inBundle:false,_integrity:"sha512-+lqQ8WQp8UD1BlNBeVOawBKpXCBCqdwnEfRiWxG7vI3NBmZ9CBPN/eMmMt2OpJRU8UcZUOrarAjiZV3dZsqWtA==",_location:"/svg-kit",_phantomChildren:{"@cronvel/xmldom":"0.1.31"},_requested:{type:"range",registry:true,raw:"svg-kit@^0.3.0",name:"svg-kit",escapedName:"svg-kit",rawSpec:"^0.3.0",saveSpec:null,fetchSpec:"^0.3.0"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/svg-kit/-/svg-kit-0.3.0.tgz",_shasum:"a53aadb7152cf7374e2a791b9d45b7cc6d0fe25d",_spec:"svg-kit@^0.3.0",_where:"/home/cedric/inside/github/spellcast-ext-web-client",author:{name:"Cédric Ronvel"},bin:{svgkit:"bin/svgkit"},bugs:{url:"https://github.com/cronvel/svg-kit/issues"},bundleDependencies:false,copyright:{title:"SVG Kit",years:[2017,2019],owner:"Cédric Ronvel"},dependencies:{"@cronvel/xmldom":"^0.1.31","dom-kit":"^0.3.14",minimist:"^1.2.0",seventh:"^0.7.30","string-kit":"^0.10.1","terminal-kit":"^1.31.4"},deprecated:false,description:"A small SVG toolkit.",devDependencies:{},directories:{test:"test"},homepage:"https://github.com/cronvel/svg-kit#readme",keywords:["svg"],license:"MIT",main:"lib/svg-kit.js",name:"svg-kit",repository:{type:"git",url:"git+https://github.com/cronvel/svg-kit.git"},scripts:{test:"tea-time -R dot"},version:"0.3.0"}},{}],74:[function(l,e,c){(function(n,a){(function(){var e=l("process/browser.js").nextTick;var t=Function.prototype.apply;var r=Array.prototype.slice;var s={};var o=0;c.setTimeout=function(){return new i(t.call(setTimeout,window,arguments),clearTimeout)};c.setInterval=function(){return new i(t.call(setInterval,window,arguments),clearInterval)};c.clearTimeout=c.clearInterval=function(e){e.close()};function i(e,t){this._id=e;this._clearFn=t}i.prototype.unref=i.prototype.ref=function(){};i.prototype.close=function(){this._clearFn.call(window,this._id)};c.enroll=function(e,t){clearTimeout(e._idleTimeoutId);e._idleTimeout=t};c.unenroll=function(e){clearTimeout(e._idleTimeoutId);e._idleTimeout=-1};c._unrefActive=c.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;if(e>=0){t._idleTimeoutId=setTimeout(function e(){if(t._onTimeout)t._onTimeout()},e)}};c.setImmediate=typeof n==="function"?n:function(t){var i=o++;var n=arguments.length<2?false:r.call(arguments,1);s[i]=true;e(function e(){if(s[i]){if(n){t.apply(null,n)}else{t.call(null)}c.clearImmediate(i)}});return i};c.clearImmediate=typeof a==="function"?a:function(e){delete s[e]}}).call(this)}).call(this,l("timers").setImmediate,l("timers").clearImmediate)},{"process/browser.js":37,timers:74}],75:[function(e,t,i){"use strict";var G=e("punycode");var I=e("./util");i.parse=o;i.resolve=l;i.resolveObject=c;i.format=a;i.Url=T;function T(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var P=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,B=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,r=["<",">",'"',"`"," ","\r","\n","\t"],s=["{","}","|","\\","^","`"].concat(r),N=["'"].concat(s),R=["%","/","?",";","#"].concat(N),D=["/","?","#"],F=255,U=/^[+a-z0-9A-Z_-]{0,63}$/,V=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Y={javascript:true,"javascript:":true},W={javascript:true,"javascript:":true},q={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},H=e("querystring");function o(e,t,i){if(e&&I.isObject(e)&&e instanceof T)return e;var n=new T;n.parse(e,t,i);return n}T.prototype.parse=function(e,t,i){if(!I.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var n=e.indexOf("?"),r=n!==-1&&n<e.indexOf("#")?"?":"#",s=e.split(r),o=/\\/g;s[0]=s[0].replace(o,"/");e=s.join(r);var a=e;a=a.trim();if(!i&&e.split("#").length===1){var l=B.exec(a);if(l){this.path=a;this.href=a;this.pathname=l[1];if(l[2]){this.search=l[2];if(t){this.query=H.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var c=P.exec(a);if(c){c=c[0];var u=c.toLowerCase();this.protocol=u;a=a.substr(c.length)}if(i||c||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var h=a.substr(0,2)==="//";if(h&&!(c&&W[c])){a=a.substr(2);this.slashes=true}}if(!W[c]&&(h||c&&!q[c])){var f=-1;for(var d=0;d<D.length;d++){var p=a.indexOf(D[d]);if(p!==-1&&(f===-1||p<f))f=p}var m,g;if(f===-1){g=a.lastIndexOf("@")}else{g=a.lastIndexOf("@",f)}if(g!==-1){m=a.slice(0,g);a=a.slice(g+1);this.auth=decodeURIComponent(m)}f=-1;for(var d=0;d<R.length;d++){var p=a.indexOf(R[d]);if(p!==-1&&(f===-1||p<f))f=p}if(f===-1)f=a.length;this.host=a.slice(0,f);a=a.slice(f);this.parseHost();this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y){var v=this.hostname.split(/\./);for(var d=0,b=v.length;d<b;d++){var x=v[d];if(!x)continue;if(!x.match(U)){var w="";for(var _=0,S=x.length;_<S;_++){if(x.charCodeAt(_)>127){w+="x"}else{w+=x[_]}}if(!w.match(U)){var k=v.slice(0,d);var E=v.slice(d+1);var j=x.match(V);if(j){k.push(j[1]);E.unshift(j[2])}if(E.length){a="/"+E.join(".")+a}this.hostname=k.join(".");break}}}}if(this.hostname.length>F){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!y){this.hostname=G.toASCII(this.hostname)}var T=this.port?":"+this.port:"";var C=this.hostname||"";this.host=C+T;this.href+=this.host;if(y){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(a[0]!=="/"){a="/"+a}}}if(!Y[u]){for(var d=0,b=N.length;d<b;d++){var L=N[d];if(a.indexOf(L)===-1)continue;var A=encodeURIComponent(L);if(A===L){A=escape(L)}a=a.split(L).join(A)}}var M=a.indexOf("#");if(M!==-1){this.hash=a.substr(M);a=a.slice(0,M)}var O=a.indexOf("?");if(O!==-1){this.search=a.substr(O);this.query=a.substr(O+1);if(t){this.query=H.parse(this.query)}a=a.slice(0,O)}else if(t){this.search="";this.query={}}if(a)this.pathname=a;if(q[u]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var T=this.pathname||"";var $=this.search||"";this.path=T+$}this.href=this.format();return this};function a(e){if(I.isString(e))e=o(e);if(!(e instanceof T))return T.prototype.format.call(e);return e.format()}T.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",i=this.pathname||"",n=this.hash||"",r=false,s="";if(this.host){r=e+this.host}else if(this.hostname){r=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){r+=":"+this.port}}if(this.query&&I.isObject(this.query)&&Object.keys(this.query).length){s=H.stringify(this.query)}var o=this.search||s&&"?"+s||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||q[t])&&r!==false){r="//"+(r||"");if(i&&i.charAt(0)!=="/")i="/"+i}else if(!r){r=""}if(n&&n.charAt(0)!=="#")n="#"+n;if(o&&o.charAt(0)!=="?")o="?"+o;i=i.replace(/[?#]/g,function(e){return encodeURIComponent(e)});o=o.replace("#","%23");return t+r+i+o+n};function l(e,t){return o(e,false,true).resolve(t)}T.prototype.resolve=function(e){return this.resolveObject(o(e,false,true)).format()};function c(e,t){if(!e)return t;return o(e,false,true).resolveObject(t)}T.prototype.resolveObject=function(e){if(I.isString(e)){var t=new T;t.parse(e,false,true);e=t}var i=new T;var n=Object.keys(this);for(var r=0;r<n.length;r++){var s=n[r];i[s]=this[s]}i.hash=e.hash;if(e.href===""){i.href=i.format();return i}if(e.slashes&&!e.protocol){var o=Object.keys(e);for(var a=0;a<o.length;a++){var l=o[a];if(l!=="protocol")i[l]=e[l]}if(q[i.protocol]&&i.hostname&&!i.pathname){i.path=i.pathname="/"}i.href=i.format();return i}if(e.protocol&&e.protocol!==i.protocol){if(!q[e.protocol]){var c=Object.keys(e);for(var u=0;u<c.length;u++){var h=c[u];i[h]=e[h]}i.href=i.format();return i}i.protocol=e.protocol;if(!e.host&&!W[e.protocol]){var f=(e.pathname||"").split("/");while(f.length&&!(e.host=f.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(f[0]!=="")f.unshift("");if(f.length<2)f.unshift("");i.pathname=f.join("/")}else{i.pathname=e.pathname}i.search=e.search;i.query=e.query;i.host=e.host||"";i.auth=e.auth;i.hostname=e.hostname||e.host;i.port=e.port;if(i.pathname||i.search){var d=i.pathname||"";var p=i.search||"";i.path=d+p}i.slashes=i.slashes||e.slashes;i.href=i.format();return i}var m=i.pathname&&i.pathname.charAt(0)==="/",g=e.host||e.pathname&&e.pathname.charAt(0)==="/",y=g||m||i.host&&e.pathname,v=y,b=i.pathname&&i.pathname.split("/")||[],f=e.pathname&&e.pathname.split("/")||[],x=i.protocol&&!q[i.protocol];if(x){i.hostname="";i.port=null;if(i.host){if(b[0]==="")b[0]=i.host;else b.unshift(i.host)}i.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(f[0]==="")f[0]=e.host;else f.unshift(e.host)}e.host=null}y=y&&(f[0]===""||b[0]==="")}if(g){i.host=e.host||e.host===""?e.host:i.host;i.hostname=e.hostname||e.hostname===""?e.hostname:i.hostname;i.search=e.search;i.query=e.query;b=f}else if(f.length){if(!b)b=[];b.pop();b=b.concat(f);i.search=e.search;i.query=e.query}else if(!I.isNullOrUndefined(e.search)){if(x){i.hostname=i.host=b.shift();var w=i.host&&i.host.indexOf("@")>0?i.host.split("@"):false;if(w){i.auth=w.shift();i.host=i.hostname=w.shift()}}i.search=e.search;i.query=e.query;if(!I.isNull(i.pathname)||!I.isNull(i.search)){i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")}i.href=i.format();return i}if(!b.length){i.pathname=null;if(i.search){i.path="/"+i.search}else{i.path=null}i.href=i.format();return i}var _=b.slice(-1)[0];var S=(i.host||e.host||b.length>1)&&(_==="."||_==="..")||_==="";var k=0;for(var E=b.length;E>=0;E--){_=b[E];if(_==="."){b.splice(E,1)}else if(_===".."){b.splice(E,1);k++}else if(k){b.splice(E,1);k--}}if(!y&&!v){for(;k--;k){b.unshift("..")}}if(y&&b[0]!==""&&(!b[0]||b[0].charAt(0)!=="/")){b.unshift("")}if(S&&b.join("/").substr(-1)!=="/"){b.push("")}var j=b[0]===""||b[0]&&b[0].charAt(0)==="/";if(x){i.hostname=i.host=j?"":b.length?b.shift():"";var w=i.host&&i.host.indexOf("@")>0?i.host.split("@"):false;if(w){i.auth=w.shift();i.host=i.hostname=w.shift()}}y=y||i.host&&b.length;if(y&&!j){b.unshift("")}if(!b.length){i.pathname=null;i.path=null}else{i.pathname=b.join("/")}if(!I.isNull(i.pathname)||!I.isNull(i.search)){i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")}i.auth=e.auth||i.auth;i.slashes=i.slashes||e.slashes;i.href=i.format();return i};T.prototype.parseHost=function(){var e=this.host;var t=n.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":76,punycode:38,querystring:41}],76:[function(e,t,i){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}]},{},[8])(8)});